<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Jone Blog</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://qiufanghua.github.io/"/>
  <updated>2017-01-08T03:52:02.000Z</updated>
  <id>https://qiufanghua.github.io/</id>
  
  <author>
    <name>Jone</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>RocketMQ-Broker</title>
    <link href="https://qiufanghua.github.io/2017/01/07/RocketMQ-Broker/"/>
    <id>https://qiufanghua.github.io/2017/01/07/RocketMQ-Broker/</id>
    <published>2017-01-07T00:17:41.000Z</published>
    <updated>2017-01-08T03:52:02.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;Broker&quot;&gt;&lt;a href=&quot;#Broker&quot; class=&quot;headerlink&quot; title=&quot;Broker&quot;&gt;&lt;/a&gt;Broker&lt;/h2&gt;&lt;p&gt;&amp;#x6D88;&amp;#x606F;&amp;#x7684;&amp;#x4E2D;&amp;#x8F6C;&amp;#x8005;&amp;#xFF0C;&amp;#x8D1F;&amp;#x8D23;&amp;#x5B58;&amp;#x50A8;&amp;#x548C;&amp;#x8F6C;&amp;#x53D1;&amp;#x6D88;&amp;#x606F;&amp;#x3002;&amp;#x53EF;&amp;#x4EE5;&amp;#x7406;&amp;#x89E3;&amp;#x4E3A;&amp;#x6D88;&amp;#x606F;&amp;#x961F;&amp;#x5217;&amp;#x670D;&amp;#x52A1;&amp;#x5668;&amp;#xFF0C;&amp;#x63D0;&amp;#x4F9B;&amp;#x4E86;&amp;#x6D88;&amp;#x606F;&amp;#x7684;&amp;#x63A5;&amp;#x6536;&amp;#x3001;&amp;#x5B58;&amp;#x50A8;&amp;#x3001;pull&amp;#x670D;&amp;#x52A1;&amp;#x3002;&amp;#x4E3A;&amp;#x4FDD;&amp;#x8BC1;Broker&amp;#x9AD8;&amp;#x53EF;&amp;#x7528;&amp;#xFF0C;Broker&amp;#x5206;&amp;#x4E3A;Master&amp;#x4E0E;Slave&amp;#xFF0C;&amp;#x4E00;&amp;#x4E2A;Master&amp;#x53EF;&amp;#x4EE5;&amp;#x5BF9;&amp;#x5E94;&amp;#x591A;&amp;#x4E2A;Slaves&amp;#xFF0C;Master&amp;#x4E0E;Slave&amp;#x6570;&amp;#x636E;&amp;#x540C;&amp;#x6B65;&amp;#x53EF;&amp;#x4EE5;&amp;#x662F;&amp;#x540C;&amp;#x6B65;&amp;#x4E0E;&amp;#x5F02;&amp;#x6B65;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;Broker&amp;#x4E3B;&amp;#x8981;&amp;#x7C7B;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;a href=&quot;#Broker&amp;#x4E3B;&amp;#x8981;&amp;#x7C7B;&amp;#x5206;&amp;#x6790;&quot; class=&quot;headerlink&quot; title=&quot;Broker&amp;#x4E3B;&amp;#x8981;&amp;#x7C7B;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;/a&gt;Broker&amp;#x4E3B;&amp;#x8981;&amp;#x7C7B;&amp;#x5206;&amp;#x6790;&lt;/h2&gt;&lt;h4 id=&quot;BrokerController&quot;&gt;&lt;a href=&quot;#BrokerController&quot; class=&quot;headerlink&quot; title=&quot;BrokerController&quot;&gt;&lt;/a&gt;BrokerController&lt;/h4&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;113&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;BrokerController{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Properties{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        BrokerConifg, NettyServerConfig, NettyClientConfig, MessageStoreConifg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ConsumerOffsetManager, ConsumerManager, ProducerManager&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ClientHousekeepingService , PullMessageProcessor, PullRequestHoldService&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        MessageArrivingListener, Broker2Client, SubscriptionGroupManager&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ConsumerIdsChanngeListener, RebalanceLockManager&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        SlaveSynchronize, MessageStore&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        BlockingQueue&amp;lt;Runnable&amp;gt; sendThreadPollQueue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        FilterServerManager&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        TopicConfigManager&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    initialize(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; topicConfigManager.load(); consumerOffsetManager.load(); subscriptionGroupManager.load();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; messageStore = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DefaultMessageStore(messageStoreConfig,brokerStatsManager,messageArrivingListener,brokerConfig)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; messageStore.load()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; NettyRemotingServer remotingServer&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; NettyRemotingServer fastRemotingServer&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; sendMessageExecutor &lt;span class=&quot;comment&quot;&gt;// sendMessageThreadPoolNums = 16 + Runtime.getRuntime().availableProcessors() * 4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; pullMessageExecutor &lt;span class=&quot;comment&quot;&gt;// pullMessageThreadPoolNums = 16 + Runtime.getRuntime().availableProcessors() * 2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; adminBrokerExecutor &lt;span class=&quot;comment&quot;&gt;// adminBrokerThreadPoolNums = 16&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; clientManageExecutor&lt;span class=&quot;comment&quot;&gt;// 16&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; registerProcessor(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; SendMessageProcessor, QueryMessageProcessor&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; ClientManageProcessor, AdminBrokerProcessor&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; schedule{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; consumerOffsetManager.persist()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; consumerOffsetManager.scanUnsubscribedTopic()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; namesrvAddr != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; brokerOuterAPI.updateNameServerAddressList(namesrvAddr){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; NettyRemotingClient.updateNameServerAddressList(lst){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                -&amp;gt; namesrvAddrList.set(addrs)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        } &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; brokerOuterAPI.fetchNameServerAddr&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; slave{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; messageStoreConfig.getHaMasterAddress()!=&lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                messageStore.updateHaMasterAdress(haMasterAddress)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.updateMasterHAServerAddrPeriodically = &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                updateMasterHAServerAddrPeriodically = &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; schedule.slaveSynchronize.syncAll()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        } &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            schedule.printMasterAndSlaveDiff()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    start(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        messageStore.start()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        remotingServer.start()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        brokerOuterAPI.start()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        pullRequestHoldService.start&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        clientHousekeepingService.start()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        filterServerManager.&lt;span class=&quot;function&quot;&gt;start&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;title&quot;&gt;registerBrokerAll&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        schedule.&lt;span class=&quot;title&quot;&gt;registerBrokerAll&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        schedule.messageStore.cleanUnusedTopic&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;synchronized&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;registerBrokerAll&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(brokerClusterName,brokerAddr,brokerName,brokerId&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        haServerAddr,topicConfigWrapper,List&amp;lt;String&amp;gt; filterServerList,&lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; oneway)&lt;/span&gt;&lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        TopicConfigSerializeWrapper topicConfigWrapper = &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.getTopicConfigManager().buildTopicConfigSerializeWrapper();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        brokerOuterAPI,registerBrokerAll(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; List&amp;lt;String&amp;gt; nameServerAddressList = remotingClient.getNameServerAddressList()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; forEach(nameServerAddressList){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                -&amp;gt; reisterBroker(namesrvAddr,clusterName,brokerAddr,brokerName,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    brokerId,hasServerAddr,topicConfigWrapper,filterServerList,oneway){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        -&amp;gt; RegisterBrokerRequestHeader&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        -&amp;gt; RemotingCommand RequestCode.register_broker&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        -&amp;gt; request.body topic,filterServerList&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(updateMasterHAServerAddrPeriodically &amp;amp;&amp;amp; registerBrokerResult.getHaServerAddr != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; messageStore.updateHaMasterAddress(haServerAddr)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; slaveSynchronize.setMasterAddr(masterAddr)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;namesrv.DefaultRequestProcessor{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    registerBrokerWithFilerServer(ChannelHandlerContext ctx, request){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; namesrvController.getRouteInoManager().registerBroker(clusterName,brokerAddr,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            brokerName,brokerId,haServerAddr,topicConfigSerializeWrapper,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            filterServerList&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        )&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; &amp;#x83B7;&amp;#x53D6;&amp;#x987A;&amp;#x5E8F;&amp;#x6D88;&amp;#x606F;topic&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; kvConfigManager().getKVListByNamespace(NaesrvUtil.namespace_order_topic_config)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CosumerOffsetManager{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ConcurrentHashMap&amp;lt;String&lt;span class=&quot;comment&quot;&gt;//topic@group, ConcurrentHashMap&amp;lt;Integer//queueId,Long&amp;gt;&amp;gt; offsetTable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SubscriptionGroupManager{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ConcurrentHashMap&amp;lt;String&lt;span class=&quot;comment&quot;&gt;//groupName,SubscriptionGroupConfig&amp;gt; subscriptionGroupTable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    init(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; put.tools_consumer_group,filtersrv_consumer_group,self_test_consumer_group,ons_http_proxy_group(CID_ONS-HTTP-PROXY)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SubscriptionGroupConfig{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String groupName&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; consumeEnable, consumeFromMinEnable, consumeBroadcastEnable&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; retryQueueNums, retryMaxTimes&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; brokerId = Master_id=&lt;span class=&quot;number&quot;&gt;0L&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; whichBrokerWhenConsumerSlowly = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NotifyMessageArrivingListener impl MessageArrivingListener{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;PullRequestHoldServcie pullRequestHoldService&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title&quot;&gt;arriving&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String topic, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; queueId, &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; logicOffset)&lt;/span&gt;&lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; pullRequestHoldService.notifyMessageArriving(...)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;TopicConfigManger&quot;&gt;&lt;a href=&quot;#TopicConfigManger&quot; class=&quot;headerlink&quot; title=&quot;TopicConfigManger&quot;&gt;&lt;/a&gt;TopicConfigManger&lt;/h4&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;TopicConfigManger{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;Lock lockTopicConfigTable&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ConcurrentHashMap&amp;lt;String,TopicConfig&amp;gt; topicConfigTable&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Set&amp;lt;String&amp;gt; systemTopicList&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title&quot;&gt;TopicConfigManger&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; initicate topicConifgTable.put, self_test_topic, default_topic(TBW102),BenchmarkTest(&lt;span class=&quot;number&quot;&gt;1024&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1024&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;function&quot;&gt;put &lt;span class=&quot;title&quot;&gt;brokerClusterName&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(DefaultCluster)&lt;/span&gt;, put brokerName&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            put &lt;span class=&quot;title&quot;&gt;offset_move_event&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// rootDir/config/topics.json&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;TopicConfig&lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    topicName&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; readQueueNums, writeQueueNums &lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; order&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; topicSysFlag&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ToicFilterType.SINGLE_TAG&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; perm = PermName.prem_read | PermName.prem_write&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;Broker&amp;#x542F;&amp;#x52A8;&amp;#x6D41;&amp;#x7A0B;&quot;&gt;&lt;a href=&quot;#Broker&amp;#x542F;&amp;#x52A8;&amp;#x6D41;&amp;#x7A0B;&quot; class=&quot;headerlink&quot; title=&quot;Broker&amp;#x542F;&amp;#x52A8;&amp;#x6D41;&amp;#x7A0B;&quot;&gt;&lt;/a&gt;Broker&amp;#x542F;&amp;#x52A8;&amp;#x6D41;&amp;#x7A0B;&lt;/h2&gt;&lt;h4 id=&quot;&amp;#x542F;&amp;#x52A8;&amp;#x6D41;&amp;#x7A0B;&amp;#x56FE;&quot;&gt;&lt;a href=&quot;#&amp;#x542F;&amp;#x52A8;&amp;#x6D41;&amp;#x7A0B;&amp;#x56FE;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x542F;&amp;#x52A8;&amp;#x6D41;&amp;#x7A0B;&amp;#x56FE;&quot;&gt;&lt;/a&gt;&amp;#x542F;&amp;#x52A8;&amp;#x6D41;&amp;#x7A0B;&amp;#x56FE;&lt;/h4&gt;&lt;p&gt;&lt;img src=&quot;/2017/01/07/RocketMQ-Broker/Broker-start.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h4 id=&quot;&amp;#x6D41;&amp;#x7A0B;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;a href=&quot;#&amp;#x6D41;&amp;#x7A0B;&amp;#x5206;&amp;#x6790;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x6D41;&amp;#x7A0B;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;/a&gt;&amp;#x6D41;&amp;#x7A0B;&amp;#x5206;&amp;#x6790;&lt;/h4&gt;&lt;p&gt;&amp;#x7565;&lt;/p&gt;
&lt;h4 id=&quot;Broker-Namserver&amp;#x6D41;&amp;#x7A0B;&amp;#x56FE;&quot;&gt;&lt;a href=&quot;#Broker-Namserver&amp;#x6D41;&amp;#x7A0B;&amp;#x56FE;&quot; class=&quot;headerlink&quot; title=&quot;Broker-Namserver&amp;#x6D41;&amp;#x7A0B;&amp;#x56FE;&quot;&gt;&lt;/a&gt;Broker-Namserver&amp;#x6D41;&amp;#x7A0B;&amp;#x56FE;&lt;/h4&gt;&lt;p&gt;&lt;img src=&quot;/2017/01/07/RocketMQ-Broker/Broker-Namersrv.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Broker&quot;&gt;&lt;a href=&quot;#Broker&quot; class=&quot;headerlink&quot; title=&quot;Broker&quot;&gt;&lt;/a&gt;Broker&lt;/h2&gt;&lt;p&gt;&amp;#x6D88;&amp;#x606F;&amp;#x7684;&amp;#x4E2D;&amp;#x8F6C;&amp;#x8005;&amp;#xFF0
    
    </summary>
    
      <category term="Java" scheme="https://qiufanghua.github.io/categories/Java/"/>
    
      <category term="RocketMQ" scheme="https://qiufanghua.github.io/categories/Java/RocketMQ/"/>
    
    
      <category term="RocketMQ" scheme="https://qiufanghua.github.io/tags/RocketMQ/"/>
    
  </entry>
  
  <entry>
    <title>RocketMQ-Namersrv</title>
    <link href="https://qiufanghua.github.io/2017/01/07/RocketMQ-Namersrv/"/>
    <id>https://qiufanghua.github.io/2017/01/07/RocketMQ-Namersrv/</id>
    <published>2017-01-07T00:17:19.000Z</published>
    <updated>2017-01-08T04:36:26.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;NameServer&quot;&gt;&lt;a href=&quot;#NameServer&quot; class=&quot;headerlink&quot; title=&quot;NameServer&quot;&gt;&lt;/a&gt;NameServer&lt;/h2&gt;&lt;p&gt;Namesrv&amp;#xFF0C;&amp;#x540D;&amp;#x79F0;&amp;#x670D;&amp;#x52A1;&amp;#xFF0C;&amp;#x65E0;&amp;#x72B6;&amp;#x6001;&amp;#xFF0C;&amp;#x65E0;&amp;#x5355;&amp;#x70B9;&amp;#xFF0C;&amp;#x53EF;&amp;#x6A2A;&amp;#x5411;&amp;#x6269;&amp;#x5C55;&amp;#xFF0C;&amp;#x53EF;&amp;#x90E8;&amp;#x7F72;&amp;#x591A;&amp;#x4E2A;&amp;#xFF0C;&amp;#x4E00;&amp;#x822C;&amp;#x90E8;&amp;#x7F72;3&amp;#x53F0;&amp;#xFF0C;&amp;#x8282;&amp;#x70B9;&amp;#x4E4B;&amp;#x95F4;&amp;#x65E0;&amp;#x4EFB;&amp;#x4F55;&amp;#x4FE1;&amp;#x606F;&amp;#x540C;&amp;#x6B65;&amp;#xFF0C;&amp;#x4E3A;&amp;#x5BF9;&amp;#x7B49;&amp;#x8282;&amp;#x70B9;&amp;#x3002;&amp;#x4E3B;&amp;#x8981;&amp;#x6709;&amp;#x4E24;&amp;#x4E2A;&amp;#x529F;&amp;#x80FD;&amp;#x3002;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&amp;#x63A5;&amp;#x6536;Broker&amp;#x8BF7;&amp;#x6C42;&amp;#xFF0C;&amp;#x6CE8;&amp;#x518C;Broker&amp;#x8DEF;&amp;#x7531;&amp;#x4FE1;&amp;#x606F;&lt;/li&gt;
&lt;li&gt;&amp;#x63A5;&amp;#x6536;Client&amp;#xFF08;Producer&amp;#xFF0C;Consumer&amp;#xFF09;&amp;#x8BF7;&amp;#x6C42;&amp;#xFF0C;&amp;#x6839;&amp;#x636E;Topic&amp;#x83B7;&amp;#x53D6;&amp;#x5230;Brokers&amp;#x7684;&amp;#x8DEF;&amp;#x7531;&amp;#x4FE1;&amp;#x606F;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;NameServer&amp;#x4E3B;&amp;#x8981;&amp;#x7C7B;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;a href=&quot;#NameServer&amp;#x4E3B;&amp;#x8981;&amp;#x7C7B;&amp;#x5206;&amp;#x6790;&quot; class=&quot;headerlink&quot; title=&quot;NameServer&amp;#x4E3B;&amp;#x8981;&amp;#x7C7B;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;/a&gt;NameServer&amp;#x4E3B;&amp;#x8981;&amp;#x7C7B;&amp;#x5206;&amp;#x6790;&lt;/h2&gt;&lt;h4 id=&quot;NamesrvStartup&quot;&gt;&lt;a href=&quot;#NamesrvStartup&quot; class=&quot;headerlink&quot; title=&quot;NamesrvStartup&quot;&gt;&lt;/a&gt;NamesrvStartup&lt;/h4&gt;&lt;p&gt;Namesrv&amp;#x542F;&amp;#x52A8;&amp;#x7C7B;&amp;#xFF0C;&amp;#x8BFB;&amp;#x53D6;&amp;#x914D;&amp;#x7F6E;&amp;#x751F;&amp;#x6210;NamesrvConfig&amp;#x3001;NettyServerConfig&amp;#xFF08;&amp;#x9ED8;&amp;#x8BA4;&amp;#x76D1;&amp;#x542C;&amp;#x7AEF;&amp;#x53E3;&amp;#x53F7;9876&amp;#xFF09;&amp;#x3001;&amp;#x6839;&amp;#x636E;&amp;#x914D;&amp;#x7F6E;&amp;#x4FE1;&amp;#x606F;&amp;#x521B;&amp;#x5EFA;NamesrvController&amp;#x5E76;&amp;#x542F;&amp;#x52A8;controller&amp;#x3002;&lt;/p&gt;
&lt;h4 id=&quot;NamesrvController&quot;&gt;&lt;a href=&quot;#NamesrvController&quot; class=&quot;headerlink&quot; title=&quot;NamesrvController&quot;&gt;&lt;/a&gt;NamesrvController&lt;/h4&gt;&lt;p&gt;&amp;#x6709;&amp;#x70B9;&amp;#x7C7B;&amp;#x4F3C;&amp;#x4E8E;&amp;#x6211;&amp;#x4EEC;MVC&amp;#x4E2D;&amp;#x5E95;Controller&amp;#xFF0C;&amp;#x6240;&amp;#x6709;&amp;#x7684;&amp;#x4F9D;&amp;#x8D56;&amp;#x90FD;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;&amp;#x4ED6;&amp;#x6765;&amp;#x83B7;&amp;#x53D6;&amp;#xFF0C;NameServer&amp;#x4E2D;&amp;#x5176;&amp;#x4ED6;&amp;#x7684;&amp;#x7EC4;&amp;#x4EF6;&amp;#x90FD;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;&amp;#x4ED6;&amp;#x6765;&amp;#x83B7;&amp;#x53D6;&amp;#x8981;&amp;#x8BBF;&amp;#x95EE;&amp;#x7684;&amp;#x5176;&amp;#x4ED6;&amp;#x5BF9;&amp;#x8C61;&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;NamesvController{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Properties{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        RouteInfoManager routeInfoManager&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        RemotingServer remotingServer&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        BrokerHousekeepingService brokerHousekeepingService&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    -&amp;gt; initialize(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; &lt;span class=&quot;function&quot;&gt;create &lt;span class=&quot;title&quot;&gt;NettyRemotingServer&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(brokerHousekeepingService)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; &lt;span class=&quot;title&quot;&gt;registerProcessor&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; remotingServer.registerDefaultProcessor(&lt;span class=&quot;function&quot;&gt;create &lt;span class=&quot;title&quot;&gt;DefaultRequestProcessor&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;, remotingExecutor)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; scheduleAtFixRate routeInfoManager.scanNotActiveBroker&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    -&amp;gt; &lt;span class=&quot;title&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; remotingServer.start()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ol&gt;
&lt;li&gt;&amp;#x6253;&amp;#x5F00;NameServer&amp;#xFF0C;&amp;#x7ED1;&amp;#x5B9A;&amp;#x76D1;&amp;#x542C;&amp;#x7AEF;&amp;#x53E3;&amp;#xFF0C;&amp;#x63A5;&amp;#x53D7;Broker&amp;#x4E0E;&amp;#x5BA2;&amp;#x670D;&amp;#x7AEF;&amp;#x670D;&amp;#x52A1;&lt;/li&gt;
&lt;li&gt;&amp;#x521B;&amp;#x5EFA;RoteInfoManger&amp;#x5B9E;&amp;#x4F8B;&amp;#xFF0C;&amp;#x63A5;&amp;#x53D7;Broker&amp;#x6CE8;&amp;#x518C;&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x6784;&amp;#x5EFA;&amp;#x8DEF;&amp;#x7531;&amp;#x4FE1;&amp;#x606F;&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&quot;RouteInfoManager&quot;&gt;&lt;a href=&quot;#RouteInfoManager&quot; class=&quot;headerlink&quot; title=&quot;RouteInfoManager&quot;&gt;&lt;/a&gt;RouteInfoManager&lt;/h4&gt;&lt;p&gt;&amp;#x7EF4;&amp;#x62A4;&amp;#x6240;&amp;#x6709;&amp;#x7684;Broker&amp;#x8DEF;&amp;#x7531;&amp;#x4FE1;&amp;#x606F;&amp;#x3001;&amp;#x96C6;&amp;#x6210;&amp;#x4FE1;&amp;#x606F;&amp;#x3001;Topic&amp;#x4FE1;&amp;#x606F;&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// &amp;#x8FD0;&amp;#x884C;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x8DEF;&amp;#x7531;&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x5185;&amp;#x5B58;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;broker&amp;#x5B9A;&amp;#x671F;&amp;#x63A8;&amp;#x9001;&amp;#x6570;&amp;#x636E;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RouteInfoManager{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ReadWriteLock lock&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    HashMap&amp;lt;String&lt;span class=&quot;comment&quot;&gt;//topic,List&amp;lt;QueueData&amp;gt;&amp;gt; topicQueueTable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    HashMap&amp;lt;String&lt;span class=&quot;comment&quot;&gt;//brokerName,BrokerData&amp;gt; brokerAddrTable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    HashMap&amp;lt;String&lt;span class=&quot;comment&quot;&gt;//clusterName,Set&amp;lt;String//brokerName&amp;gt;&amp;gt; culsterAddrTable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    HashMap&amp;lt;String&lt;span class=&quot;comment&quot;&gt;//brokerAddr,BrokerLiveInfo&amp;gt; brokerLiveTable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    HashMap&amp;lt;String&lt;span class=&quot;comment&quot;&gt;//brokerAddr,List&amp;lt;String&amp;gt;//filter server&amp;gt; filterServerTable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;RegisterBrokerResult &lt;span class=&quot;title&quot;&gt;regsiterBroker&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; lock&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; Set&amp;lt;String&amp;gt; brokerNames = clusterAddrTable.get(clusterName);brokerNames.add&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// &amp;#x66F4;&amp;#x65B0;&amp;#x96C6;&amp;#x6210;&amp;#x4FE1;&amp;#x606F;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; BrokerData brokerData = brokerAddrTable.get(brokerName)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; brokerData == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;{&lt;span class=&quot;comment&quot;&gt;//&amp;#x66F4;&amp;#x65B0;&amp;#x4E3B;&amp;#x5907;&amp;#x4FE1;&amp;#x606F;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; registerFirst = &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; brokerData = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; BrokerData()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; brokerData.setBrokerAddrs(HashMap&amp;lt;Long&lt;span class=&quot;comment&quot;&gt;//brokerId,String//broker address&amp;gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        String oldAddr = brokerData.getBrokerAddrs().put(brokerId,brokerAddr)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#xFF0D;&amp;gt; &amp;#x66F4;&amp;#x65B0;Topic&amp;#x4FE1;&amp;#x606F;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#xFF0D;&amp;gt; topicConfigWrapper != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; master_id == brokerId{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; isBrokerTopicConfigChanged(String brokerAddr, DataVersion dataVersion){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// brokerLiveTable.get(brokerAddr) == null || !dataVersion&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                -&amp;gt; ConcurrentHashMap&amp;lt;String,TopicConfig&amp;gt; tcTable=topicConfigWrapper.getTopicConfigTable()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                -&amp;gt; tcTable.forEach{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    -&amp;gt; createAndUpdateQueueData(brokerName, TopicConfig){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        -&amp;gt; QueueData queueData&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        -&amp;gt; queueData.setBrokerName(brokerName)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        -&amp;gt; queueData.setWriteQueueNums,setReadQueueNums,setPerm,setTopicSynFlag&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        -&amp;gt; List&amp;lt;QueueData&amp;gt; queueDataList = topciQueueTable.get(topicName)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        -&amp;gt; createOrUpdate queueDataList&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; brokerLiveTable.put(brokerAddr,&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; BrokerLiveInfo())&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; filterServerTable&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; brokerId != master_id then setHaServerAddr, setMasterAddr&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    routeInfoManager().pickupTopicRouteData(topic){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; TopciRouteData create&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; lock&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; List&amp;lt;QueueData&amp;gt; queueDataList = topicQueueTable.get(topic),brokerAddrTable,filterServerTable&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;QueueData{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String brokerName&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; readQueueNums&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; writeQueuNums&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; perm&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; topicSynFlag&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;BrokerData{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String brokerName&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    HashMap&amp;lt;Long&lt;span class=&quot;comment&quot;&gt;//brokerId,String//broker address&amp;gt; brokerAddrs&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RouterInfoManager.BrokerLiveInfo{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; lastUpdateTimestamp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    DataVersion dataVersion&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Channel channel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String haServerAddr&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&quot;Broker&amp;#x914D;&amp;#x7F6E;&amp;#x4FE1;&amp;#x606F;&quot;&gt;&lt;a href=&quot;#Broker&amp;#x914D;&amp;#x7F6E;&amp;#x4FE1;&amp;#x606F;&quot; class=&quot;headerlink&quot; title=&quot;Broker&amp;#x914D;&amp;#x7F6E;&amp;#x4FE1;&amp;#x606F;&quot;&gt;&lt;/a&gt;Broker&amp;#x914D;&amp;#x7F6E;&amp;#x4FE1;&amp;#x606F;&lt;/h5&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;brokerClusterName=DefaultCluster&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;brokerName=broker-a&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;brokerId=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;deleteWhen=04&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;fileReservedTime=48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;brokerRole=ASYNC_MASTER&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;flushDiskType=ASYNC_FLUSH&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;NettyRemotingServer-Client&quot;&gt;&lt;a href=&quot;#NettyRemotingServer-Client&quot; class=&quot;headerlink&quot; title=&quot;NettyRemotingServer/Client&quot;&gt;&lt;/a&gt;NettyRemotingServer/Client&lt;/h4&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;115&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;116&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;117&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;118&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;119&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;120&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;121&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;122&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;123&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;124&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;125&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;126&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;127&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;129&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;130&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;131&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;132&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;133&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;134&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;135&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;136&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;137&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;138&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;139&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;140&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;141&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;142&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;143&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;144&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;145&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;146&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;147&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;148&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;149&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;150&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;151&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;152&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;NettyRemotingClient extends NettyRemotingAbstract{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; LockTimeoutMills=&lt;span class=&quot;number&quot;&gt;3000&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NettyClientConfig&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Bootstrap&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    EventLoopGroup&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    DefaultEventExecutorGroup&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Lock lockChannelTables&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ConcurrentHashMap&amp;lt;String&lt;span class=&quot;comment&quot;&gt;//addr, ChannelWrapper&amp;gt; channelTables&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Timer&lt;span class=&quot;comment&quot;&gt;// clientHuseKeepingService&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//name server&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    AtomicReference&amp;lt;List&amp;lt;String&amp;gt;&amp;gt; namesrvAddrList&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    AtomicReference&amp;lt;String&amp;gt; namesrvAddrChoosed&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    AtomicInteger namesrvIndex&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Lock lockNamesrvChannel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// &amp;#x5904;&amp;#x7406;callback response&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ExecutorService publicExecutor&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NettyRemotingServer extends NettyRemotingAbstract{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Properties{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ServerBootstrap serverBootstrap&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        EventLoopGroup eventLoopGroupSelector, eventLoopGroupBoss&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        DefaultEventExecutorGroup defaultEventExecutorGroup&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ExecutorService publicExecutor&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ChannelEventListener channelEventListener&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NettyRemotingServer(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; eventLoopGroupSelector = EpollEventLoopGroup() &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; linux&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    start(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; defaultEventExecutorGroup = DefaultEventExecutorGroup()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; ServerBootstrap childHandler.childHander(NettyConnectManagerHandler, NettyServerHandler)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; serverBootstrap.bind()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; &lt;span class=&quot;function&quot;&gt;scheduleAtFixedRate &lt;span class=&quot;title&quot;&gt;scanResponseTable&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NettyConnectManageHandler&lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        channelActive(ChannelHandlerContext ctx){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            channelEventListener != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                nettyEventExecuter.putNettyEvent&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NettyServerHandler&amp;lt;RemotingCommand&amp;gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// remoting command NettyDecoder decode&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        channelRead0(ChannelHandlerContext ctx, RemotingCommand msg){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; processMessageReceived(ctx, msg)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NettyRemotingAbstract{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Properties{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        NettyEventExecuter nettyEventExecuter&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Semaphore semaphoreOnewary, semaphoreAysnc&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ConcurrentHashMap&amp;lt;Integer&lt;span class=&quot;comment&quot;&gt;// opaque, ResposeFuture&amp;gt; responseTable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Pair&amp;lt;NettyRequestProcessor, ExecutorService&amp;gt; defaultRequestProcessor&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        HashMap&amp;lt;Integer&lt;span class=&quot;comment&quot;&gt;// request code,Pair&amp;lt;NettyRequestProcesor,ExecutorService&amp;gt;&amp;gt; processorTable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NettyEventExecuer{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Proerties{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            LinkedBlockingQueue&amp;lt;NettyEvent&amp;gt; eventQueue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; maxSize = &lt;span class=&quot;number&quot;&gt;10000&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    processMessageReceived(ChannelHandlerContext ctx, RemotingCommand msg){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; requestCmd procesRequestCommand&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; responseCmd processResponseCommand&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    processRequestCommand(ChannelHandlerContext ctx, RemotingCommand msg) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; Pair&amp;lt;NettyRequestProcessor, ExecutorService&amp;gt; pair = processorTable.get(cmd.getCode)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; RemotingCommand response = pair.getObject1().processRequest(ctx, cmd)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; !cmd.isOnewayRPC(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; response.setOpaque(cmd.getOpaque);ctx.writeAndFlush&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        } &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; {&lt;span class=&quot;comment&quot;&gt;// nothing}&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    processResponseCommand(ChannelHandlerContext ctx, RemotingCommand cmd){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; responseFuture = responsTable.get(cmd.getOpaque)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; responseFuture.setResponseCommand(cmd); responseFuture.release&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; executor.submit  responseFuture.executeInvokeCallback&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    invokeOneway(Channel channel, RemotingCommand request, &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; timeoutMillis) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; request.markOnewayRPC();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; semaphoreOneway.tryAcquire(timeoutMillis)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; acquired{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; SemaphoreReleaseOnlyOnce once = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; SemaphoreRelease(semaphoreOneway)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; channel.writeAndFlush(request).addListener(){operationComplete(){once.release}}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    invokeAsynImpl(Channel channel, RemotingCommand request, &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; timeouMills, InvokeCallback callback){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; acquired = seamphoreAsync.tryAcquire()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; SeamphoreReleaseOnlyOnce once = SeamphoreReleaeOnlyOnce(seamphoreAsync);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; ResponseFuture(request.getOpaque, timeoutMills, invokeCallback, once) responseFuture&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; responseTable.put(request.getOpaque, responseFuture)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; channel.writeAndFlush(request).addListener(ChannelFutureListener f){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; f.isSuccess responseFutrue.setSendRequestOk(&lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; responsFuture.executeInvokeCallback()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; responsFuture.release()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; responseTable.remove()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    scanResponseTable(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; forEntry.reponsTable{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; ResponseFuture rep&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; rep.getBeginTimestamp() + rep.getTimoutMills() + &lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt; &amp;lt;= currentTimeMillis {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                -&amp;gt; expired;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ReponseFuture{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Properties{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;volatile&lt;/span&gt; RemotingCommand responseCommand;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; sendRequestsOk = &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; opaque&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; timeoutMills&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        CountDownLatch countDownLatch&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        SemaphoreReleaseOnlyOnce once&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        AtomicBoolean executeCallbackOnlyOnce;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    executeInvokeCallback(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; executeCallbackOnlyOnce.campreAndSet(&lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;) invokeCallback.operationComplete(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;RemotingCommand &lt;span class=&quot;title&quot;&gt;waitResponse&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; timeoutMills)&lt;/span&gt;&lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; countDownLatch.awit(timeoutMills)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; responseCommand&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    putResponse(RemotingCommand responseCommand){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; countDownLatch.countDown()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SemaphoreReleaseOnlyOnce{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;atomicBoolean released&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Semaphore semaphore&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title&quot;&gt;SemaphoreReleaseOnlyOnce&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Semaphore semaphore)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title&quot;&gt;release&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        released.compareAndSet(&lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;) semaphore.release()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;BrokerHousekeepingService&quot;&gt;&lt;a href=&quot;#BrokerHousekeepingService&quot; class=&quot;headerlink&quot; title=&quot;BrokerHousekeepingService&quot;&gt;&lt;/a&gt;BrokerHousekeepingService&lt;/h4&gt;&lt;p&gt;&amp;#x76D1;&amp;#x542C;Broker&amp;#x4E0E;NameServer&amp;#x7684;&amp;#x8FDE;&amp;#x63A5;&amp;#xFF0C;&amp;#x5B9E;&amp;#x65F6;&amp;#x7684;&amp;#x66F4;&amp;#x65B0;&amp;#x8DEF;&amp;#x7531;&amp;#x4FE1;&amp;#x606F;&lt;/p&gt;
&lt;h2 id=&quot;NameServer&amp;#x542F;&amp;#x52A8;&amp;#x6D41;&amp;#x7A0B;&quot;&gt;&lt;a href=&quot;#NameServer&amp;#x542F;&amp;#x52A8;&amp;#x6D41;&amp;#x7A0B;&quot; class=&quot;headerlink&quot; title=&quot;NameServer&amp;#x542F;&amp;#x52A8;&amp;#x6D41;&amp;#x7A0B;&quot;&gt;&lt;/a&gt;NameServer&amp;#x542F;&amp;#x52A8;&amp;#x6D41;&amp;#x7A0B;&lt;/h2&gt;&lt;h4 id=&quot;&amp;#x542F;&amp;#x52A8;&amp;#x6D41;&amp;#x7A0B;&amp;#x56FE;&quot;&gt;&lt;a href=&quot;#&amp;#x542F;&amp;#x52A8;&amp;#x6D41;&amp;#x7A0B;&amp;#x56FE;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x542F;&amp;#x52A8;&amp;#x6D41;&amp;#x7A0B;&amp;#x56FE;&quot;&gt;&lt;/a&gt;&amp;#x542F;&amp;#x52A8;&amp;#x6D41;&amp;#x7A0B;&amp;#x56FE;&lt;/h4&gt;&lt;p&gt;&lt;img src=&quot;/2017/01/07/RocketMQ-Namersrv/Namesrv-start.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h4 id=&quot;&amp;#x6D41;&amp;#x7A0B;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;a href=&quot;#&amp;#x6D41;&amp;#x7A0B;&amp;#x5206;&amp;#x6790;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x6D41;&amp;#x7A0B;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;/a&gt;&amp;#x6D41;&amp;#x7A0B;&amp;#x5206;&amp;#x6790;&lt;/h4&gt;&lt;p&gt;&amp;#x7565;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;NameServer&quot;&gt;&lt;a href=&quot;#NameServer&quot; class=&quot;headerlink&quot; title=&quot;NameServer&quot;&gt;&lt;/a&gt;NameServer&lt;/h2&gt;&lt;p&gt;Namesrv&amp;#xFF0C;&amp;#x540D;&amp;#x79F0;&amp;#x670D
    
    </summary>
    
      <category term="Java" scheme="https://qiufanghua.github.io/categories/Java/"/>
    
      <category term="RocketMQ" scheme="https://qiufanghua.github.io/categories/Java/RocketMQ/"/>
    
    
      <category term="RocketMQ" scheme="https://qiufanghua.github.io/tags/RocketMQ/"/>
    
  </entry>
  
  <entry>
    <title>RocketMQ-Consumer-Message</title>
    <link href="https://qiufanghua.github.io/2017/01/06/RocketMQ-Consumer-Message/"/>
    <id>https://qiufanghua.github.io/2017/01/06/RocketMQ-Consumer-Message/</id>
    <published>2017-01-06T15:44:05.000Z</published>
    <updated>2017-01-06T15:44:05.000Z</updated>
    
    <content type="html"></content>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>RocketMQ-Producer-Message</title>
    <link href="https://qiufanghua.github.io/2017/01/06/RocketMQ-Producer-Message/"/>
    <id>https://qiufanghua.github.io/2017/01/06/RocketMQ-Producer-Message/</id>
    <published>2017-01-06T15:43:34.000Z</published>
    <updated>2017-01-08T04:36:55.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;Producer-Message&amp;#x4E3B;&amp;#x8981;&amp;#x7C7B;&quot;&gt;&lt;a href=&quot;#Producer-Message&amp;#x4E3B;&amp;#x8981;&amp;#x7C7B;&quot; class=&quot;headerlink&quot; title=&quot;Producer Message&amp;#x4E3B;&amp;#x8981;&amp;#x7C7B;&quot;&gt;&lt;/a&gt;Producer Message&amp;#x4E3B;&amp;#x8981;&amp;#x7C7B;&lt;/h2&gt;&lt;h4 id=&quot;&amp;#x6D88;&amp;#x606F;&amp;#x5B58;&amp;#x50A8;&quot;&gt;&lt;a href=&quot;#&amp;#x6D88;&amp;#x606F;&amp;#x5B58;&amp;#x50A8;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x6D88;&amp;#x606F;&amp;#x5B58;&amp;#x50A8;&quot;&gt;&lt;/a&gt;&amp;#x6D88;&amp;#x606F;&amp;#x5B58;&amp;#x50A8;&lt;/h4&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;115&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;116&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;117&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;118&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;119&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;120&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;121&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;122&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;123&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;124&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;125&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;126&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;127&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;129&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;130&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;131&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;132&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;133&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;134&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;135&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;136&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;137&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;138&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;139&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;140&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;141&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;142&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;143&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;144&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;145&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;146&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;147&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;148&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;149&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;150&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;151&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;152&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;153&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;154&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;155&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;156&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;157&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;158&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;159&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;160&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;161&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;162&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;163&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;164&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;165&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;166&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;167&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;168&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;169&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;170&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;171&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;173&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;174&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;175&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;176&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;177&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;178&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;179&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;180&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;181&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;182&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;183&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;184&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;185&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;186&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;187&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;188&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;189&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;190&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;191&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;192&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;193&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;194&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;195&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;196&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;197&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;198&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;199&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;200&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;201&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;202&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;203&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;204&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;205&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;206&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;207&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;208&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;209&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;210&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;211&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;212&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;213&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;214&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;215&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;216&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;217&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;218&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;219&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;220&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;221&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;222&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;223&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;224&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;225&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;226&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;227&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;228&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;229&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;230&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;231&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;232&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;233&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;234&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;235&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;236&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;237&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;238&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;239&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;240&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;241&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;242&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;243&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;244&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;245&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;246&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;247&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;248&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;249&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;250&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;251&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;252&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;253&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;254&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;255&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;256&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;257&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;258&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;259&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;260&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;DefaultMessageStore{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    MessageFilter messageFilter&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    MessageStoreConfig&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    CommitLog commitLog&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ConcurrentHashMap&amp;lt;String&lt;span class=&quot;comment&quot;&gt;//topic,ConcurrentHashMap&amp;lt;Integer//queueId,ConsumeQueue&amp;gt;&amp;gt; consumerQueueTable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;FlushConsumeQueueService&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    CleanCommitedLogService&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    CleanConsumeQueueService&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    IndexService&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    AllocateMapedFileService&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ReputMessageService&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    HAService&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ScheduleMessageService&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    StoreCheckpoint&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ScheduledExcutorService&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    MessageArrviingListener&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; lastExitOk = !root/abort file exist&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; commitLog.load&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; load consumeQueue &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; paths root/consumequeue&lt;span class=&quot;comment&quot;&gt;/*{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; File dirLogic = root/consumequque&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; File[] fileTopicList// root/consumequeue/{topci}/{queueid}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; indexService.load(lastExitOk)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; recover(lastExitOk){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; reconverConsumerQueue(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                consumerQueueTable.forEach(){consumeQueue.reconver()}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; lastExitOk commitLog.recoverNormally(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }else{commitLog.recoverAbnormally()}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; recoverTopicQueueTable(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    pubMessage(MessageExtBrokerInner msg){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; isOSPageCacheBusy(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; long begin = commitLong().getBeginTimeInLock()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; diff = systemClock.now() - begin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; if(diff &amp;lt; 10000000 &amp;amp;&amp;amp; diff &amp;gt; messageStoreConfig.getOsPageCacheBusyTimeOutMills() //1000) true&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; commitLog.putMessage(msg)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CommitLog{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // store all meatdata downtime for recovery, data protection reliability&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    static int messageMagicCode= Message&amp;apos;s MAGIC CODE daa320a7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    static int BlankMagicCode= End of file empty MAGIC CODE cbd43194&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    MapedFileQueue mapedFileQueue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    FlushCommitLogService&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    AppendMessageCallback&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    HashMap&amp;lt;String//topic-queueid,Long//offset, mapedFileQueue.getMaxOffset()/CQStoreUnitSize&amp;gt; topicQueueTable&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    CommitLog{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; mapedFileQueue(store/commiteLog, mapedFileSizeCommitLog// default is 1G, AllocateMapedFileService)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; flshCommitedLogService&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; appendMessageCallback DefaultAppendMessageCallback&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    recoverNormally(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    DispatchRequest checkMessageAndReturnSize(byteBuffer, boolean checkCRC, boolean readBody){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    final int msgLen = 4 // 1 TOTALSIZE&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    + 4 // 2 MAGICCODE&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    + 4 // 3 BODYCRC&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    + 4 // 4 QUEUEID&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    + 4 // 5 FLAG&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    + 8 // 6 QUEUEOFFSET&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    + 8 // 7 PHYSICALOFFSET&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    + 4 // 8 SYSFLAG&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    + 8 // 9 BORNTIMESTAMP&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    + 8 // 10 BORNHOST&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    + 8 // 11 STORETIMESTAMP&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    + 8 // 12 STOREHOSTADDRESS&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    + 4 // 13 RECONSUMETIMES&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    + 8 // 14 Prepared Transaction Offset&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    + 4 + (bodyLength &amp;gt; 0 ? bodyLength : 0) // 14 BODY&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    + 1 + topicLength // 15 TOPIC&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    + 2 + (propertiesLength &amp;gt; 0 ? propertiesLength : 0) // 16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                                        // propertiesLength&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    + 0;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    putMessage(MessageExtBrokerInner msg){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; MapedFile mapedFile = mapedFileQueue.getLastMapedFileWithLock()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; synchronized(this){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; beginTimeInLock&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; msg.setStoreTimestamp(beginTimeInLock)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; mapedFile == null then mapedFileQueue.getLastMapedFile()// if full create&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; mapedFile.appendMessage(msg, appendMessageCallback)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                appendMessageCallback.doAppend&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; flush&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; if synchronous write double&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CommitLog.DefaultAppendMessageCallback{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    doAppend(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; long msgId = MessageDecoder.createMessageId(msgIdMemory, msgInner.getStoreHostBytes//storehost port,wroteOffset){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; msg_id_length = 8+8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; put(addr), putLong(offset)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                // addr: put(storehost.getAddress.getAddress// the highest order byte), putInt(getPort)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; long wroteOffset = fileFromOffset + byteBuffer.position()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; queueOffset = CommitLog.this.topicQueueTable(topic + &amp;quot;-&amp;quot; queueID) default 0L&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; transType=transactionPrepared,rollback queueOffset=0L&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            //prepared and rollback message is not consumed, will not enter the consumer queue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; AppendMessageResult(put_ok,wroteOffset,msgLen,msgId,msgInner.getStoreTimestamp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            queueOffset,defaultMessageStore.now()-beginTimeMills)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; not transcation type topicQueueTable.put(key, ++queueOffset)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            // the next update consumeQueue information&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ConsumeQueue{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    DefaultMessageStore defaultMessageStore&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    MapedFileQueue mapedFileQueue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String topic;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    int queueId&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ByteBuffer byteBufferIndex&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    int mapedFileSize&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    maxPhysicOffset = -1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    volatile long minLogicOffset = 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    int CQStoreUnitSize = 20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ConsumeQueue(String topic, int queueId, String storePath, int mapedFileSize, DefaultMessageStore){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; String queueDir = storePath/topic/queueId&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; mapedFileQueue = new MapedFileQueue(queueDir, mapedFileSize)//30W * ConsumerQueue.CQSotreUnitSize(20)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; byteBufferIndex = ByteBuffer.allocate(CQStoreUnitSize)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    load(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; mapedFileQueue.load()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    recover(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; List&amp;lt;MapedFile&amp;gt; mapedFiles = mapedFileQueue.getMapedFiles()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; last 3 mapedFiles&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; long processOffset = mapedFile.getFileFromOffset()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; mapedFileOffset=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; while{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; for (int i=0;i&amp;lt;this.mapedFileSize;i++CQStoreUnitSize){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                -&amp;gt; long offset=byteBuffer.getLong&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                -&amp;gt; int size=byteBuffer.getInt()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                -&amp;gt; long tagsCode=getLong&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                -&amp;gt; if(offset&amp;gt;=0&amp;amp;&amp;amp; size&amp;gt;0){ // this file is valid&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    -&amp;gt; mapedFileOffset=i + CQStoreUnitSize&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    -&amp;gt; this.maxPhysicOffset = offset&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                } else {break} // is invalid&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            if(mapedFileOffset==this.mapedFileSize){// if this file is valid then get next&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                index++&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                if is the last one then break&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                else get the next file{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    -&amp;gt; mapedFile=next&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    -&amp;gt; processOffset=mapedFile.getFileFromOffset&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    -&amp;gt; mapedFileOffset=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; processOffset += mapedFileOffset&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; mapedFileQueue.truncateDirtyFiles(processOffset)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;MapedFileQueue{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String storePath&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    int mapedFileSize&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    List&amp;lt;MapedFile&amp;gt; mapedFiles&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ReadWriteLock readWriteLock&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    AllocateMapedfielService&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    long committedWhere&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    volatile long storeTimestamp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    load(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; File[] files = dir.listFiles();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; Arrays.sort(files); ascending order&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; files.forEach{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; MapedFile mapedFile=new MapedFile(file.getPath, mapedFileSize)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; mapedFile.setWrotePostion(this.mapedFileSize)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; mapedFile.setCommittedPosition(this.mapedFileSize)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                // MessageStoreConfig.mapedFileSizeConsumeQueue = 30W * ConsumerQueue.CQSotreUnitSize(20)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; add&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    truncateDirtyFiles(offset){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mapedFiles.forEach{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; long fileTailOffset = file.getFileFromOffset + this.mapedFileSize&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; if (fileTailOffset &amp;gt; offset){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                // offset&amp;#x4E4B;&amp;#x540E;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                if(offset&amp;gt;=file.getFileFromOffset){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    // offset &amp;#x5728;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#x4E2D;&amp;#x95F4;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    -&amp;gt; file.setWrotePosition((int) (offset % this.mapedFilesSize))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    -&amp;gt; file.setCommitedPosition...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                } else {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    -&amp;gt; file.destroy(1000)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;MapedFile{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    static final AtomicLong totalMapedVitualMemory&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    static fianl AtomicInteger totalMapedFiles&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String fileName&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    long fileFromOffset&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    int fileSize&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    MappedByteBuffer mappedByteBuffer&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    AtomicInteger wrotePosition, committedPosistion&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    FileChannel fileChannel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    volatile long storeTimestamp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    boolean firstCreateInQueue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    MapedFile(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; fileFromOffset = Long.parseLong(file.getName())&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; fileChannel = new RandowAccessFile(file, &amp;quot;rw&amp;quot;).getChannel()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; mappedByteBuffer = fileChannel.map(MapMode.read_write,0,fileSize)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    appendMessage(Object msg, AppendMessageCallback cb){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; currentPos = wrotePosition.get()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; ByteBuffer byteBuffer = mappedByteBuffer.slice()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; byteBuffer.position(currentPos)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; cb.doAppend(fileFromOffset,byteBuffer,fileSize - currentPos, msg)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; wrotePosition.addAndGet(result.getWroteBytes())&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;IndexService{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    DefaultMessageStore&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    int hashSlotNum&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    int indexNum&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String storePath&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ArrayList&amp;lt;IndexFile&amp;gt; indexFileList&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ReadWriteLock&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    IndexService(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; hashSlotNum = defaultMessageStore.getMessageStoreConfig.getMaxHashSlotNum()// 5000000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; indexNum = //5000000 * 4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; storePath = root/index&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    load(boolean lastExitOk){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; dir.listFiles(); Arrays.sort(files);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; forEache{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; IndexFile f = new IndexFile(path, hashSlotNum, indexNum, 0, 0)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; f.load();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; if(!lastExitOk) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                -&amp;gt; f.getEndTimestamp &amp;gt; defaultMessageStore.getStoreCheckpoting().getIndexMsgTimestamp(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    -&amp;gt; f.destroy(0)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;IndexFile{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    static int hash_slot_size = 4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    static int idex_size = 20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    static int invalid_index = 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    int hashSlotNum&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    int indexNum&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    MapedFile mapedFile&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    FileChannel fileChannel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    MappedByteBuffer mapedByteBuffer&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    IndexHeader indexHeader&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    IndexFile(String fileName, int hashSlotNum, int indexNum,long endPhyOffset,endTimestamp){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; fileTotalSize = IndexHeader.index_headr_size + (hashSlotNum*hash_slot_size)+(indexNum*index_size)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;&amp;#x6D88;&amp;#x606F;&amp;#x53D1;&amp;#x9001;&quot;&gt;&lt;a href=&quot;#&amp;#x6D88;&amp;#x606F;&amp;#x53D1;&amp;#x9001;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x6D88;&amp;#x606F;&amp;#x53D1;&amp;#x9001;&quot;&gt;&lt;/a&gt;&amp;#x6D88;&amp;#x606F;&amp;#x53D1;&amp;#x9001;&lt;/h4&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;115&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;116&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;117&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;118&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;119&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;120&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;121&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;122&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;123&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;124&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;125&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;126&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;127&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;129&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;130&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;131&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;132&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;133&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;134&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;135&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;136&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;137&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;138&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;139&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;140&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;141&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;142&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;143&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;144&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;145&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;146&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;147&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;148&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;149&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;150&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;151&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;152&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;153&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;154&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;155&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;156&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;157&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;158&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;159&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;160&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;161&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;162&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;163&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;164&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;165&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;166&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;167&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;168&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;169&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;170&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;171&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;173&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;174&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;175&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;176&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;177&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;178&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;179&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;180&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;181&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;182&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;183&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;184&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;185&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;186&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;187&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;188&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;189&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;190&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;191&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;192&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;193&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;194&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;195&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;196&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;197&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;198&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;199&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;200&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;201&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;202&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;203&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;204&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;205&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;206&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;DefaultMQProducer{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String producerGroup&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; defaultTopicQueueNums=&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; sendMsgTimeout=&lt;span class=&quot;number&quot;&gt;3000&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; maxMessageSize=&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;function&quot;&gt;M&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; defaultMqProduerImpl.start()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    send(Message msg, &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; timeout){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; defaultMqProduerImpl.send&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;DefaultMQProducerImpl{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ConcurrentHashMap&amp;lt;String&lt;span class=&quot;comment&quot;&gt;//topic,TopicPublishInfo&amp;gt; topicPublishInfoTable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ArrayList&amp;lt;SendMessageHook&amp;gt; sendMessageHookList&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    BlockingQueue&amp;lt;Runnable&amp;gt; checkRequestQueue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    MQClientInstance&lt;span class=&quot;comment&quot;&gt;// per client id clientId: ip@instanceName(if null pid)@unitName&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;MQFaultStrategy&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; startFactory)&lt;/span&gt;&lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// &amp;#x521B;&amp;#x5EFA;producer&amp;#x540E;&amp;#x8C03;&amp;#x7528;start&amp;#xFF0C;&amp;#x9996;&amp;#x6B21;&amp;#x540C;&amp;#x6B65;&amp;#x53D1;&amp;#x9001;&amp;#x5FC3;&amp;#x8DF3;&amp;#x4FE1;&amp;#x606F;&amp;#x81F3;&amp;#x6240;&amp;#x6709;broker&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; serviceState: create_just-&amp;gt;start_failed-&amp;gt;running&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; mQClientFactory = MQClientManager.getInstance().getAndCreateMqClientInstance(defaultMQProducer,rpcHook){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; &lt;span class=&quot;comment&quot;&gt;// concurrentHashMap&amp;lt;Dtring//clientid,MQclientInstance&amp;gt; factoryTable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// clientId: ip@instanceName(if null pid)@unitName&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; mQClientFactory.registerProduer(defaultMQProduer.getProduerGroup()&lt;span class=&quot;comment&quot;&gt;// producer group, this){&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; MQProducerInner pre = producerTable.putIfAbsent(group, producer)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; pre != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; startFactory mqClientFactory.start()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; mqClientFactory.sendHearbeatToAllBrokerWithLock(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; HeartbeatData.clientid, consumerdata, producerdata&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// consumerTable, producerTable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// consumer.groupname&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// consumertype: pull,push&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// messageModel:broadcasting,clustering&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// consumerFroWhere:consume_from_last_offset, from_first_offset, from_timestamp&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// subscriptions,unitMode&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// producerData.groupname&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; sendHearbeat &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; brokers&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// clientManagerProcessor hearBeat&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    send(Message msg, &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; timeout){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; sendDefaultImpl(msg, CommunicationMode.sync, SendCallback ,timeout){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; invokerId = random.nextLong();&lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; beginTimestampFirst,beginTimestampPrev,endTimestamp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; TopicPublishInfo topciPublishInfo = tryToFindTopicPublishInfo(msg.getTopci, &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; isDefault){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                -&amp;gt; topicPublishInfo = topicPublishInfoTable.get(topic)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                -&amp;gt; topicPublishInfo == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    -&amp;gt; &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.topicPublishInfoTable.putInfAbsent(topic, &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; TopicPublishInfo)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &lt;span class=&quot;comment&quot;&gt;// &amp;#x6240;&amp;#x4EE5;&amp;#x4E0D;&amp;#x7BA1;namesrv&amp;#x662F;&amp;#x5426;&amp;#x5B58;&amp;#x5728;topic&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x540E;&amp;#x7EED;&amp;#x90FD;&amp;#x53EF;&amp;#x4EE5;&amp;#x83B7;&amp;#x53D6;&amp;#x5230;&amp;#xFF0C;&amp;#x53EA;&amp;#x662F;&amp;#x53EF;&amp;#x80FD;&amp;#x662F;&amp;#x6CA1;&amp;#x6709;topic route data&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    -&amp;gt; mqClientFactory.updateTopicRoutInfoFromNameServer(topic)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    -&amp;gt; topicPublishInfo = topicPublishInfoTable.get(topic)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; MessageQueue mq&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; timesTotal = communicationMode == CommunicationMode.SYNC ? &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; + &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.defaultMQProducer.getRetryTimesWhenSendFailed() : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; String[] brokersSent&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; timesTotal{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                -&amp;gt; String lastBrokerName&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                -&amp;gt; selectOneMessageQueue(topicPublishInfo, lastBrokerName)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    mqFaultStrategy.selectOneMessageQueue(tpInfo, lastBrokername)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                -&amp;gt; sendKernelImpl(msg,mq,communicationMode,sendCallback,topicPublishInfo,timeout)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                -&amp;gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; exception need &lt;span class=&quot;keyword&quot;&gt;continue&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// call from MQClientInstance updateTopicRoutInfoFromNameServer&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    updateTopicPublishInfo(topic, TopicPublishInfo){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        topicPublishInfoTable&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;TopciPublishInfo{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; orderTopic&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; haveTopicRouterInfo&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    List&amp;lt;MessageQueue&amp;gt; messageQueueList&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    TopicRouteData&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;MessageQueue{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String topic&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String brokerName&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; queueId&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;TopicRouteData{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String orderTopicConf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    List&amp;lt;QueueData&amp;gt; queueDatas&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    List&amp;lt;BrokerData&amp;gt; brokerDatae&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    HashMap&amp;lt;String&lt;span class=&quot;comment&quot;&gt;//brokerAddr,List&amp;lt;String//filter server&amp;gt;&amp;gt; filterServerTable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;MQClientInstance{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; instanceIndex&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String clientId&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ConcurrentHashMap&amp;lt;String&lt;span class=&quot;comment&quot;&gt;//group,MQProducerInner&amp;gt; producerTable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ConcurrentHashMap&amp;lt;String&lt;span class=&quot;comment&quot;&gt;//group, MQConumserInner&amp;gt; consumerTable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ConcurrentHashMap&amp;lt;String&lt;span class=&quot;comment&quot;&gt;//group,MQAdminExtInner&amp;gt; adminExtTable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    MQClientAPIImpl&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ConcurrentHashMap&amp;lt;String&lt;span class=&quot;comment&quot;&gt;//topic,TopicRouterData&amp;gt; topicRouteTable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ConcurrentHashMap&amp;lt;String&lt;span class=&quot;comment&quot;&gt;//broker name,HashMap&amp;lt;Long//brokerId,String//address&amp;gt;&amp;gt; brokerAddrTable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;PullMessageService&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    RebalanceService&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    DefaultMQProducer&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title&quot;&gt;MQClientInstance&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        defaultMQProducer = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DefaultMQProducer(client_inner_producer_group)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    start(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;synchronized&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; mqClientAPIImpl.start &lt;span class=&quot;comment&quot;&gt;// start request-response channel&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; startScheduledTask&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; pullMessageService.start()&lt;span class=&quot;comment&quot;&gt;//start pull service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; reblanceService.start&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; defaultMQProducer.getDefaultMQProducerImpl.start&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    mqClientFactory.sendHearbeatToAllBrokerWithLock(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; HeartbeatData.clientid, consumerdata, producerdata&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// consumerTable, producerTable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// consumer.groupname&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// consumertype: pull,push&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// messageModel:broadcasting,clustering&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// consumerFroWhere:consume_from_last_offset, from_first_offset, from_timestamp&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// subscriptions,unitMode&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// producerData.groupname&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; sendHearbeat &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; brokers&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; HEART_BEAT command&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    mqClientFactory.updateTopicRoutInfoFromNameServer(topic){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; lockNamesrv.tryLock&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; TopicRouteData topicRouteData = mqClientAPIImpl.getTopicRouteInfoFromNameServer(topic, &lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;*&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// GET_ROUTEINTO_BY_TOPIC&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// response_code.topic_not_exist&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; topicRouteData channed&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; update brokerAddrTable,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; update pub info producerTable,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; topicRoutData2TopicPublishInfo(topic, topicRouteData){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                -&amp;gt; rote.queueDatas()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                -&amp;gt; rote.brokerDatas()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                -&amp;gt; brokerData.getBrokerAddrs().containsKey(master_id)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                -&amp;gt; messageQueueList&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; forEach producerTable imp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; impl.updateTopicPublishInfo(topic, publishInfo)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; update sub info consumerTable&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ClientManageProcessor{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    heartBeat(ChannelHandlerContext ctx, RemotingCommand request){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; ConsumerData data : heartbeatData.getConsumerDataSet(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; SubscriptionGroupConfig subscriptionGroupConfig = brokerController.getSubscriptionGroupManager.findSubscriptionGroupConfig(data.groupName){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                -&amp;gt; subscriptionGroupConfig == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    -&amp;gt; brokerConfig.isAutoCreateSubscriptionGroup then create&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; String newTopic = %RETRY%+data.groupName&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; createTopicInSendMessageBackMethod(newTopic,retryQueueNums)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; consumerManager.registerConsumer(data.groupName,clientChannelInfo,consumerType,mesageModel,&lt;span class=&quot;function&quot;&gt;consumerFromWhere&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;title&quot;&gt;subscriptionDataSet&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;)&lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                ConcurrentHashMap&amp;lt;String&lt;span class=&quot;comment&quot;&gt;/* Group */&lt;/span&gt;, ConsumerGroupInfo&amp;gt; consumerTable&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; ProducerData data:hearbeatData.producerdataset{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ProducerManager.registerProducer(groupName, clientChannelInfo){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                -&amp;gt; groupChannelLock.tryLock&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                -&amp;gt;&amp;#x3000;HashMap&amp;lt;String &lt;span class=&quot;comment&quot;&gt;/* group name */&lt;/span&gt;, HashMap&amp;lt;Channel, ClientChannelInfo&amp;gt;&amp;gt; groupChannelTable&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SendMessageProcessor{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    -&amp;gt; request.code&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        consumer_send_msg_back&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; sendMessage(ctx, request, SendMessageContext, SendMessageRequestHeader)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sendMessage(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; queueIdInt...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; PutMessageResult putMessageResult = messageStore.putMessage(msgInner)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Namesrv&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;DefaultRequestProcessor{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//GET_ROUTEINTO_BY_TOPIC&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    getRouteInfoByTopic(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; routeInfoManager().pickupTopicRouteData(topic){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; TopciRouteData create&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; lock&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; List&amp;lt;QueueData&amp;gt; queueDataList = topicQueueTable.get(topic)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; not found &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;MQClientAPIImpl{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//SEND_MESSAGE_V2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sendMessage(){}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sendMessageSync{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; remotingClient.invokeSync&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        -&amp;gt; processSendResponse(){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            -&amp;gt; SendResult&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;Producer-Message&amp;#x6D41;&amp;#x7A0B;&quot;&gt;&lt;a href=&quot;#Producer-Message&amp;#x6D41;&amp;#x7A0B;&quot; class=&quot;headerlink&quot; title=&quot;Producer Message&amp;#x6D41;&amp;#x7A0B;&quot;&gt;&lt;/a&gt;Producer Message&amp;#x6D41;&amp;#x7A0B;&lt;/h2&gt;&lt;h4 id=&quot;&amp;#x6D41;&amp;#x7A0B;&amp;#x56FE;&quot;&gt;&lt;a href=&quot;#&amp;#x6D41;&amp;#x7A0B;&amp;#x56FE;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x6D41;&amp;#x7A0B;&amp;#x56FE;&quot;&gt;&lt;/a&gt;&amp;#x6D41;&amp;#x7A0B;&amp;#x56FE;&lt;/h4&gt;&lt;p&gt;&lt;img src=&quot;/2017/01/06/RocketMQ-Producer-Message/Producer.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Producer-Message&amp;#x4E3B;&amp;#x8981;&amp;#x7C7B;&quot;&gt;&lt;a href=&quot;#Producer-Message&amp;#x4E3B;&amp;#x8981;&amp;#x7C7B;&quot; class=&quot;headerlink&quot; title=&quot;Producer Mes
    
    </summary>
    
      <category term="Java" scheme="https://qiufanghua.github.io/categories/Java/"/>
    
      <category term="RocketMQ" scheme="https://qiufanghua.github.io/categories/Java/RocketMQ/"/>
    
    
      <category term="RocketMQ" scheme="https://qiufanghua.github.io/tags/RocketMQ/"/>
    
  </entry>
  
  <entry>
    <title>RocketMQ-</title>
    <link href="https://qiufanghua.github.io/2017/01/06/RocketMQ-%E7%AE%80%E4%BB%8B/"/>
    <id>https://qiufanghua.github.io/2017/01/06/RocketMQ-/</id>
    <published>2017-01-06T09:23:00.000Z</published>
    <updated>2017-01-08T03:27:03.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;RocketMQ&quot;&gt;&lt;a href=&quot;#RocketMQ&quot; class=&quot;headerlink&quot; title=&quot;RocketMQ&quot;&gt;&lt;/a&gt;RocketMQ&lt;/h2&gt;&lt;h3 id=&quot;&amp;#x524D;&amp;#x4E16;&amp;#x4ECA;&amp;#x751F;&quot;&gt;&lt;a href=&quot;#&amp;#x524D;&amp;#x4E16;&amp;#x4ECA;&amp;#x751F;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x524D;&amp;#x4E16;&amp;#x4ECA;&amp;#x751F;&quot;&gt;&lt;/a&gt;&amp;#x524D;&amp;#x4E16;&amp;#x4ECA;&amp;#x751F;&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;RocketMQ&lt;/strong&gt; &amp;#x963F;&amp;#x91CC;&amp;#x5F00;&amp;#x6E90;&amp;#x7684;&amp;#x53C8;&amp;#x4E00;&amp;#x5927;&amp;#x4F5C;&amp;#xFF0C;&amp;#x5B9A;&amp;#x4E49;&amp;#x4E3A;&amp;#x5206;&amp;#x5E03;&amp;#x5F0F;&amp;#x6D88;&amp;#x606F;&amp;#x4E2D;&amp;#x95F4;&amp;#x4EF6;&amp;#xFF0C;&amp;#x9AD8;&amp;#x53EF;&amp;#x7528;&amp;#xFF08;&amp;#x65E0;&amp;#x5355;&amp;#x70B9;&amp;#xFF1A;Namesrv&amp;#x90E8;&amp;#x7F72;&amp;#x591A;&amp;#x4E2A;&amp;#xFF0C;&amp;#x8282;&amp;#x70B9;&amp;#x4E3A;&amp;#x5BF9;&amp;#x7B49;&amp;#x8282;&amp;#x70B9;&amp;#x4E92;&amp;#x76F8;&amp;#x5907;&amp;#x4EFD;&amp;#xFF0C;Broker&amp;#x4E3B;&amp;#x5907;&amp;#x90E8;&amp;#x7F72;&amp;#xFF09;&amp;#xFF0C;&amp;#x9AD8;&amp;#x541E;&amp;#x5410;&amp;#x91CF;&amp;#xFF0C;&amp;#x9AD8;&amp;#x6297;&amp;#x6D88;&amp;#x606F;&amp;#x79EF;&amp;#x538B;&amp;#xFF08;&amp;#x4EBF;&amp;#x7EA7;&amp;#x6D88;&amp;#x606F;&amp;#x5806;&amp;#x79EF;&amp;#x80FD;&amp;#x529B;&amp;#xFF09;&amp;#xFF0C;&amp;#x4F4E;&amp;#x5EF6;&amp;#x65F6;&amp;#xFF0C;&amp;#x53EF;&amp;#x4F38;&amp;#x7F29;&amp;#x6027;&amp;#xFF0C;&amp;#x524D;&amp;#x4E16;&amp;#x662F;MetaQ2.x&amp;#xFF0C;&amp;#x5176;&amp;#x6838;&amp;#x5FC3;&amp;#x601D;&amp;#xFF08;topic&amp;#xFF0C;&amp;#x961F;&amp;#x5217;&amp;#xFF0C;&amp;#x6D88;&amp;#x606F;&amp;#x5B58;&amp;#x50A8;&amp;#xFF0C;&amp;#x6D88;&amp;#x606F;&amp;#x6D88;&amp;#x8D39;&amp;#x65B9;&amp;#x5F0F;&amp;#x2026;&amp;#xFF09;&amp;#x501F;&amp;#x52A9;&amp;#x4E0E;Kafka&amp;#xFF08;LinkedIn&amp;#x516C;&amp;#x53F8;scala&amp;#x8BED;&amp;#x8A00;&amp;#x5F00;&amp;#x53D1;&amp;#x7684;&amp;#x4E00;&amp;#x79CD;&amp;#x9AD8;&amp;#x541E;&amp;#x5410;&amp;#x91CF;&amp;#x7684;&amp;#x5206;&amp;#x5E03;&amp;#x5F0F;&amp;#x53D1;&amp;#x5E03;&amp;#x8BA2;&amp;#x9605;&amp;#x6D88;&amp;#x606F;&amp;#x7CFB;&amp;#x7EDF;&amp;#xFF0C;&amp;#x73B0;&amp;#x662F;Apache&amp;#x9876;&amp;#x7EA7;&amp;#x9879;&amp;#x76EE;&amp;#xFF09;&amp;#xFF0C;&amp;#x5DF2;&amp;#x5F00;&amp;#x6E90;&amp;#x7684;&amp;#x7A33;&amp;#x5B9A;&amp;#x7248;&amp;#x672C;&amp;#x4E3A;3.5.8&amp;#xFF0C;&amp;#x73B0;&amp;#x5DF2;&amp;#x662F;Apache&amp;#x7684;&amp;#x4E00;&amp;#x4E2A;&amp;#x5B75;&amp;#x5316;&amp;#x9879;&amp;#x76EE;&amp;#xFF0C;&amp;#x7248;&amp;#x672C;&amp;#x662F;4.0.0&amp;#x3002;&amp;#x6211;&amp;#x540E;&amp;#x7EED;&amp;#x7684;&amp;#x5B66;&amp;#x4E60;&amp;#x90FD;&amp;#x662F;3.5.8&amp;#x7248;&amp;#x672C;&amp;#x3002;&lt;/p&gt;
&lt;h3 id=&quot;RocketMQ&amp;#x7279;&amp;#x6027;&quot;&gt;&lt;a href=&quot;#RocketMQ&amp;#x7279;&amp;#x6027;&quot; class=&quot;headerlink&quot; title=&quot;RocketMQ&amp;#x7279;&amp;#x6027;&quot;&gt;&lt;/a&gt;RocketMQ&amp;#x7279;&amp;#x6027;&lt;/h3&gt;&lt;p&gt;&amp;#x76F4;&amp;#x767D;&amp;#x8BF4;&amp;#x6211;&amp;#x4EEC;&amp;#x80FD;&amp;#x7528;RocketMQ&amp;#x505A;&amp;#x4EC0;&amp;#x4E48;&amp;#xFF0C;&amp;#x4EC0;&amp;#x4E48;&amp;#x573A;&amp;#x666F;&amp;#x7528;&amp;#xFF0C;&amp;#x4E3A;&amp;#x4EC0;&amp;#x4E48;&amp;#x7528;&amp;#xFF0C;&amp;#x63D0;&amp;#x4F9B;&amp;#x4F9D;&amp;#x636E;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&amp;#x9AD8;&amp;#x6027;&amp;#x80FD;&amp;#x3001;&amp;#x9AD8;&amp;#x53EF;&amp;#x9760;&amp;#x3001;&amp;#x9AD8;&amp;#x5B9E;&amp;#x65F6;&amp;#x3001;&amp;#x5206;&amp;#x5E03;&amp;#x5F0F;&amp;#x7279;&amp;#x70B9;&lt;/li&gt;
&lt;li&gt;Producer&amp;#x3001;Consumer&amp;#x3001;&amp;#x961F;&amp;#x5217;&amp;#x90FD;&amp;#x53EF;&amp;#x4EE5;&amp;#x5206;&amp;#x5E03;&amp;#x5F0F;&amp;#x3002;&lt;/li&gt;
&lt;li&gt;&amp;#x80FD;&amp;#x591F;&amp;#x4FDD;&amp;#x8BC1;&amp;#x4E25;&amp;#x683C;&amp;#x7684;&amp;#x6D88;&amp;#x606F;&amp;#x987A;&amp;#x5E8F;&lt;/li&gt;
&lt;li&gt;&amp;#x5B9E;&amp;#x65F6;&amp;#x7684;&amp;#x6D88;&amp;#x606F;&amp;#x8BA2;&amp;#x9605;&amp;#x673A;&amp;#x5236;&lt;/li&gt;
&lt;li&gt;&amp;#x4EBF;&amp;#x7EA7;&amp;#x6D88;&amp;#x606F;&amp;#x5806;&amp;#x79EF;&amp;#x80FD;&amp;#x529B;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;RocketMQ&amp;#x6574;&amp;#x4F53;&amp;#x4ECB;&amp;#x7ECD;&quot;&gt;&lt;a href=&quot;#RocketMQ&amp;#x6574;&amp;#x4F53;&amp;#x4ECB;&amp;#x7ECD;&quot; class=&quot;headerlink&quot; title=&quot;RocketMQ&amp;#x6574;&amp;#x4F53;&amp;#x4ECB;&amp;#x7ECD;&quot;&gt;&lt;/a&gt;RocketMQ&amp;#x6574;&amp;#x4F53;&amp;#x4ECB;&amp;#x7ECD;&lt;/h3&gt;&lt;h5 id=&quot;&amp;#x961F;&amp;#x5217;&amp;#x6D88;&amp;#x606F;&amp;#x6A21;&amp;#x578B;&quot;&gt;&lt;a href=&quot;#&amp;#x961F;&amp;#x5217;&amp;#x6D88;&amp;#x606F;&amp;#x6A21;&amp;#x578B;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x961F;&amp;#x5217;&amp;#x6D88;&amp;#x606F;&amp;#x6A21;&amp;#x578B;&quot;&gt;&lt;/a&gt;&amp;#x961F;&amp;#x5217;&amp;#x6D88;&amp;#x606F;&amp;#x6A21;&amp;#x578B;&lt;/h5&gt;&lt;p&gt;&lt;img src=&quot;/2017/01/06/RocketMQ-&amp;#x7B80;&amp;#x4ECB;/rocketmq_design.png&quot; alt=&quot;&amp;#x961F;&amp;#x5217;&amp;#x6A21;&amp;#x578B;&amp;#x6D88;&amp;#x606F;&amp;#x7CFB;&amp;#x7EDF;&quot; title=&quot;&amp;#x961F;&amp;#x5217;&amp;#x6A21;&amp;#x578B;&amp;#x6D88;&amp;#x606F;&amp;#x7CFB;&amp;#x7EDF;&quot;&gt;&lt;/p&gt;
&lt;h5 id=&quot;&amp;#x7EC4;&amp;#x4EF6;&amp;#x4EA4;&amp;#x4E92;&amp;#x6D41;&amp;#x7A0B;&quot;&gt;&lt;a href=&quot;#&amp;#x7EC4;&amp;#x4EF6;&amp;#x4EA4;&amp;#x4E92;&amp;#x6D41;&amp;#x7A0B;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x7EC4;&amp;#x4EF6;&amp;#x4EA4;&amp;#x4E92;&amp;#x6D41;&amp;#x7A0B;&quot;&gt;&lt;/a&gt;&amp;#x7EC4;&amp;#x4EF6;&amp;#x4EA4;&amp;#x4E92;&amp;#x6D41;&amp;#x7A0B;&lt;/h5&gt;&lt;p&gt;&lt;img src=&quot;/2017/01/06/RocketMQ-&amp;#x7B80;&amp;#x4ECB;/rokcetmq_core_component.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Producer&amp;#x3001;Conusmer&amp;#xFF0C;Queue&amp;#x90FD;&amp;#x53EF;&amp;#x4EE5;&amp;#x5206;&amp;#x5E03;&amp;#x5F0F;&lt;/li&gt;
&lt;li&gt;Producer&amp;#x4E0E;Topic&amp;#x4E00;&amp;#x4E00;&amp;#x5BF9;&amp;#x5E94;&amp;#xFF0C;Topic&amp;#x5BF9;&amp;#x5E94;n&amp;#x4E2A;&amp;#x961F;&amp;#x5217;&amp;#xFF0C;&amp;#x961F;&amp;#x5217;&amp;#x53C8;&amp;#x4E0E;Broker&amp;#x5BF9;&amp;#x5E94;&amp;#xFF1B;Producer&amp;#x5411;Topic&amp;#x4E2D;&amp;#x7684;&amp;#x961F;&amp;#x5217;&amp;#x8F6E;&amp;#x6D41;&amp;#x53D1;&amp;#x9001;&amp;#x6D88;&amp;#x606F;&amp;#xFF0C;Consumer&amp;#x5982;&amp;#x679C;&amp;#x662F;&amp;#x5E7F;&amp;#x64AD;&amp;#x6D88;&amp;#x8D39;&amp;#x7C7B;&amp;#x578B;&amp;#xFF0C;&amp;#x5219;Consumer&amp;#x5B9E;&amp;#x4F8B;&amp;#xFF08;&amp;#x540C;&amp;#x6837;&amp;#x53EF;&amp;#x4EE5;&amp;#x90E8;&amp;#x7F72;&amp;#x591A;&amp;#x4E2A;&amp;#xFF09;&amp;#x6D88;&amp;#x8D39;&amp;#x8FD9;&amp;#x4E2A;Topic&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x6240;&amp;#x6709;&amp;#x961F;&amp;#x5217;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x662F;&amp;#x96C6;&amp;#x7FA4;&amp;#x6D88;&amp;#x8D39;&amp;#xFF0C;&amp;#x5219;&amp;#x591A;&amp;#x4E2A;Consumer&amp;#x5B9E;&amp;#x4F8B;&amp;#x5E73;&amp;#x5747;&amp;#x6D88;&amp;#x8D39;&amp;#x8FD9;&amp;#x4E2A;Topic&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x961F;&amp;#x5217;&amp;#xFF1B;Producer&amp;#x4E0E;Name Server&amp;#x96C6;&amp;#x7FA4;&amp;#x4E2D;&amp;#x7684;&amp;#x5176;&amp;#x4E2D;&amp;#x4E00;&amp;#x4E2A;&amp;#x8282;&amp;#x70B9;&amp;#xFF08;&amp;#x968F;&amp;#x673A;&amp;#x9009;&amp;#x62E9;&amp;#xFF09;&amp;#x5EFA;&amp;#x7ACB;&amp;#x957F;&amp;#x8FDE;&amp;#x63A5;&amp;#xFF0C;&amp;#x8FDE;&amp;#x63A5;&amp;#x51FA;&amp;#x73B0;&amp;#x5F02;&amp;#x5E38;&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x91CD;&amp;#x65B0;&amp;#x9009;&amp;#x62E9;&amp;#x53E6;&amp;#x4E00;&amp;#x4E2A;&amp;#x8282;&amp;#x70B9;&amp;#xFF0C;&amp;#x5B9A;&amp;#x671F;&amp;#x4ECE;Name Server&amp;#x53D6;Topic&amp;#x8DEF;&amp;#x7531;&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x5E76;&amp;#x5411;&amp;#x63D0;&amp;#x4F9B;Topic &amp;#x670D;&amp;#x52A1;&amp;#x7684;Master&amp;#x5EFA;&amp;#x7ACB;&amp;#x957F;&amp;#x8FDE;&amp;#x63A5;&amp;#xFF0C;&amp;#x4E14;&amp;#x5B9A;&amp;#x65F6;&amp;#x5411;Master&amp;#x53D1;&amp;#x9001;&amp;#x5FC3;&amp;#x8DF3;&amp;#x3002;Producer &amp;#x5B8C;&amp;#x5168;&amp;#x65E0;&amp;#x72B6;&amp;#x6001;&amp;#xFF0C;&amp;#x53EF;&amp;#x96C6;&amp;#x7FA4;&amp;#x90E8;&amp;#x7F72;&amp;#x3002;&lt;/li&gt;
&lt;li&gt;Name Server &amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x51E0;&amp;#x4E4E;&amp;#x65E0;&amp;#x72B6;&amp;#x6001;&amp;#x8282;&amp;#x70B9;&amp;#xFF08;&amp;#x4E0D;&amp;#x4FDD;&amp;#x5B58;Topic&amp;#x8DEF;&amp;#x7531;&amp;#x4FE1;&amp;#x606F;&amp;#xFF09;&amp;#xFF0C;&amp;#x53EF;&amp;#x96C6;&amp;#x7FA4;&amp;#x90E8;&amp;#x7F72;&amp;#xFF0C;&amp;#x8282;&amp;#x70B9;&amp;#x4E4B;&amp;#x95F4;&amp;#x65E0;&amp;#x4EFB;&amp;#x4F55;&amp;#x4FE1;&amp;#x606F;&amp;#x540C;&amp;#x6B65;&lt;/li&gt;
&lt;li&gt;Broker&amp;#x5206;&amp;#x4E3A;Master&amp;#x4E0E;Slave&amp;#xFF0C;&amp;#x4E00;&amp;#x4E2A;Master&amp;#x53EF;&amp;#x4EE5;&amp;#x5BF9;&amp;#x5E94;&amp;#x591A;&amp;#x4E2A;Slave&amp;#xFF0C;&amp;#x4E00;&amp;#x4E2A;Slave&amp;#x53EA;&amp;#x80FD;&amp;#x5BF9;&amp;#x5E94;&amp;#x4E00;&amp;#x4E2A;Master&amp;#xFF0C;Master&amp;#x4E0E;Slave&amp;#x7684;&amp;#x5BF9;&amp;#x5E94;&amp;#x5173;&amp;#x7CFB;&amp;#x901A;&amp;#x8FC7;&amp;#x6307;&amp;#x5B9A;&amp;#x76F8;&amp;#x540C;&amp;#x7684;BrokerName&amp;#xFF0C;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;BrokerId&amp;#x6765;&amp;#x5B9A;&amp;#x4E49;&amp;#xFF0C;BrokerId=0&amp;#x8868;&amp;#x793A;Master&amp;#xFF0C;&amp;#x975E;0&amp;#x8868;&amp;#x793A;Slave&amp;#x3002;Master&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x90E8;&amp;#x7F72;&amp;#x591A;&amp;#x4E2A;&amp;#x3002;&amp;#x6BCF;&amp;#x4E2A;Broker&amp;#x4E0E;Name Server&amp;#x96C6;&amp;#x7FA4;&amp;#x4E2D;&amp;#x7684;&amp;#x6240;&amp;#x6709;&amp;#x8282;&amp;#x70B9;&amp;#x5EFA;&amp;#x7ACB;&amp;#x957F;&amp;#x8FDE;&amp;#x63A5;&amp;#xFF0C;&amp;#x5B9A;&amp;#x65F6;&amp;#x6CE8;&amp;#x518C;Topic&amp;#x4FE1;&amp;#x606F;&amp;#x5230;&amp;#x6240;&amp;#x6709;Name Server&amp;#x3002;&lt;/li&gt;
&lt;li&gt;Consumer&amp;#x901A;&amp;#x8FC7;pull&amp;#x65B9;&amp;#x5F0F;&amp;#x6D88;&amp;#x8D39;&amp;#x6D88;&amp;#x606F;&amp;#xFF0C;&amp;#x867D;&amp;#x7136;&amp;#x4E5F;&amp;#x63D0;&amp;#x4F9B;&amp;#x6D88;&amp;#x606F;&amp;#x76D1;&amp;#x542C;&amp;#xFF0C;&amp;#x5E95;&amp;#x5C42;&amp;#x5B9E;&amp;#x73B0;&amp;#x4E5F;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;&amp;#x8F6E;&amp;#x8BE2;pull&amp;#x6D88;&amp;#x606F;&amp;#x6765;&amp;#x5B9E;&amp;#x73B0;&amp;#xFF1B;Consumer&amp;#x4E0E;Name Server&amp;#x96C6;&amp;#x7FA4;&amp;#x4E2D;&amp;#x7684;&amp;#x5176;&amp;#x4E2D;&amp;#x4E00;&amp;#x4E2A;&amp;#x8282;&amp;#x70B9;&amp;#xFF08;&amp;#x968F;&amp;#x673A;&amp;#x9009;&amp;#x62E9;&amp;#xFF09;&amp;#x5EFA;&amp;#x7ACB;&amp;#x957F;&amp;#x8FDE;&amp;#x63A5;&amp;#xFF0C;&amp;#x8FDE;&amp;#x63A5;&amp;#x51FA;&amp;#x73B0;&amp;#x5F02;&amp;#x5E38;&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x91CD;&amp;#x65B0;&amp;#x9009;&amp;#x62E9;&amp;#x53E6;&amp;#x4E00;&amp;#x4E2A;&amp;#x8282;&amp;#x70B9;&amp;#xFF0C;&amp;#x5B9A;&amp;#x671F;&amp;#x4ECE;Name Server&amp;#x53D6;Topic &amp;#x8DEF;&amp;#x7531;&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x5E76;&amp;#x5411;&amp;#x63D0;&amp;#x4F9B;Topic&amp;#x670D;&amp;#x52A1;&amp;#x7684;Broker&amp;#xFF08;Master&amp;#x3001;Slave&amp;#xFF09;&amp;#x5EFA;&amp;#x7ACB;&amp;#x957F;&amp;#x8FDE;&amp;#x63A5;&amp;#xFF0C;&amp;#x4E14;&amp;#x5B9A;&amp;#x65F6;&amp;#x5411;Master&amp;#x3001;Slave&amp;#x53D1;&amp;#x9001;&amp;#x5FC3;&amp;#x8DF3;&amp;#x3002;Consumer&amp;#x65E2;&amp;#x53EF;&amp;#x4EE5;&amp;#x4ECE;Master&amp;#x8BA2;&amp;#x9605;&amp;#x6D88;&amp;#x606F;&amp;#xFF0C;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x4ECE;Slave&amp;#x8BA2;&amp;#x9605;&amp;#x6D88;&amp;#x606F;&amp;#xFF0C;&amp;#x8BA2;&amp;#x9605;&amp;#x89C4;&amp;#x5219;&amp;#x7531;Broker&amp;#x914D;&amp;#x7F6E;&amp;#x51B3;&amp;#x5B9A;&amp;#x3002;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;RocketMQ&amp;#x6838;&amp;#x5FC3;&amp;#x6982;&amp;#x5FF5;&amp;#x4ECB;&amp;#x7ECD;&quot;&gt;&lt;a href=&quot;#RocketMQ&amp;#x6838;&amp;#x5FC3;&amp;#x6982;&amp;#x5FF5;&amp;#x4ECB;&amp;#x7ECD;&quot; class=&quot;headerlink&quot; title=&quot;RocketMQ&amp;#x6838;&amp;#x5FC3;&amp;#x6982;&amp;#x5FF5;&amp;#x4ECB;&amp;#x7ECD;&quot;&gt;&lt;/a&gt;RocketMQ&amp;#x6838;&amp;#x5FC3;&amp;#x6982;&amp;#x5FF5;&amp;#x4ECB;&amp;#x7ECD;&lt;/h3&gt;&lt;h4 id=&quot;Topic&quot;&gt;&lt;a href=&quot;#Topic&quot; class=&quot;headerlink&quot; title=&quot;Topic&quot;&gt;&lt;/a&gt;Topic&lt;/h4&gt;&lt;p&gt;&amp;#x961F;&amp;#x5217;&amp;#x7684;&amp;#x96C6;&amp;#x5408;&amp;#xFF0C;&amp;#x8868;&amp;#x793A;&amp;#x6D88;&amp;#x606F;&amp;#x7684;&amp;#x7B2C;&amp;#x4E00;&amp;#x7EA7;&amp;#x7C7B;&amp;#x578B;&amp;#xFF0C;Producer,Consumer&amp;#x90FD;&amp;#x9700;&amp;#x8981;&amp;#x6307;&amp;#x5B9A;&amp;#x8BE5;&amp;#x7C7B;&amp;#x578B;&amp;#x3002;&lt;/p&gt;
&lt;h4 id=&quot;Tag&quot;&gt;&lt;a href=&quot;#Tag&quot; class=&quot;headerlink&quot; title=&quot;Tag&quot;&gt;&lt;/a&gt;Tag&lt;/h4&gt;&lt;p&gt;Tag&amp;#x8868;&amp;#x793A;&amp;#x6D88;&amp;#x606F;&amp;#x7684;&amp;#x7B2C;&amp;#x4E8C;&amp;#x7EA7;&amp;#x7C7B;&amp;#x578B;&amp;#xFF0C;Producer&amp;#x751F;&amp;#x4EA7;&amp;#x6D88;&amp;#x606F;&amp;#x65F6;&amp;#x53EF;&amp;#x4EE5;&amp;#x4E3A;&amp;#x6D88;&amp;#x606F;&amp;#x6253;&amp;#x4E0A;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;Tag&amp;#xFF0C;Consumer&amp;#x53EF;&amp;#x4EE5;&amp;#x9009;&amp;#x62E9;&amp;#x7684;&amp;#x6D88;&amp;#x8D39;&amp;#x611F;&amp;#x5174;&amp;#x8DA3;&amp;#x7684;Tag&amp;#x6D88;&amp;#x606F;&amp;#x3002;&lt;/p&gt;
&lt;h4 id=&quot;Queue&quot;&gt;&lt;a href=&quot;#Queue&quot; class=&quot;headerlink&quot; title=&quot;Queue&quot;&gt;&lt;/a&gt;Queue&lt;/h4&gt;&lt;p&gt;&amp;#x4E00;&amp;#x4E2A;Topic&amp;#x4E0B;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x8BBE;&amp;#x7F6E;&amp;#x591A;&amp;#x4E2A;queue(&amp;#x6D88;&amp;#x606F;&amp;#x961F;&amp;#x5217;)&amp;#xFF0C;&amp;#x6BCF;&amp;#x4E2A;&amp;#x961F;&amp;#x5217;&amp;#x53EF;&amp;#x4EE5;&amp;#x5BF9;&amp;#x5E94;&amp;#x5230;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;Broker&amp;#x3002;&amp;#x5F53;&amp;#x6211;&amp;#x4EEC;&amp;#x53D1;&amp;#x9001;&amp;#x6D88;&amp;#x606F;&amp;#x65F6;&amp;#xFF0C;&amp;#x9700;&amp;#x8981;&amp;#x8981;&amp;#x6307;&amp;#x5B9A;&amp;#x8BE5;&amp;#x6D88;&amp;#x606F;&amp;#x7684;Topic&amp;#xFF0C;RocketMQ&amp;#x4F1A;&amp;#x8F6E;&amp;#x8BE2;&amp;#x8BE5;Topic&amp;#x4E0B;&amp;#x7684;&amp;#x6240;&amp;#x6709;&amp;#x961F;&amp;#x5217;&amp;#xFF0C;&amp;#x5C06;&amp;#x6D88;&amp;#x606F;&amp;#x5B58;&amp;#x50A8;&amp;#x5230;Queue&amp;#x5BF9;&amp;#x5E94;&amp;#x5230;Broker&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x6D88;&amp;#x606F;&amp;#x5B58;&amp;#x50A8;&amp;#x8D1F;&amp;#x8F7D;&amp;#x5230;&amp;#x4E0D;&amp;#x540C;Broker&amp;#x3002;&lt;/p&gt;
&lt;h4 id=&quot;Producer-&amp;#x4E0E;-Producer-Group&quot;&gt;&lt;a href=&quot;#Producer-&amp;#x4E0E;-Producer-Group&quot; class=&quot;headerlink&quot; title=&quot;Producer &amp;#x4E0E; Producer Group&quot;&gt;&lt;/a&gt;Producer &amp;#x4E0E; Producer Group&lt;/h4&gt;&lt;p&gt;Producer&amp;#x8868;&amp;#x793A;&amp;#x6D88;&amp;#x606F;&amp;#x961F;&amp;#x5217;&amp;#x7684;&amp;#x751F;&amp;#x4EA7;&amp;#x8005;&amp;#xFF0C;&amp;#x751F;&amp;#x4EA7;&amp;#x6D88;&amp;#x606F;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;Producer Group&amp;#x662F;&amp;#x4E00;&amp;#x7C7B;Producer&amp;#x7684;&amp;#x96C6;&amp;#x5408;&amp;#x540D;&amp;#x79F0;&amp;#xFF0C;&amp;#x8FD9;&amp;#x7C7B;Producer&amp;#x901A;&amp;#x5E38;&amp;#x53D1;&amp;#x9001;&amp;#x4E00;&amp;#x7C7B;&amp;#x6D88;&amp;#x606F;&amp;#xFF0C;&amp;#x4E14;&amp;#x53D1;&amp;#x9001;&amp;#x903B;&amp;#x8F91;&amp;#x4E00;&amp;#x81F4;&amp;#x3002;&lt;/p&gt;
&lt;h4 id=&quot;Consumer-&amp;#x4E0E;-Consumer-Group&quot;&gt;&lt;a href=&quot;#Consumer-&amp;#x4E0E;-Consumer-Group&quot; class=&quot;headerlink&quot; title=&quot;Consumer &amp;#x4E0E; Consumer Group&quot;&gt;&lt;/a&gt;Consumer &amp;#x4E0E; Consumer Group&lt;/h4&gt;&lt;p&gt;&amp;#x6D88;&amp;#x606F;&amp;#x6D88;&amp;#x8D39;&amp;#x8005;&amp;#xFF0C;&amp;#x6D88;&amp;#x606F;&amp;#x7CFB;&amp;#x7EDF;&amp;#x6D88;&amp;#x8D39;&amp;#x6D88;&amp;#x606F;&amp;#x7C7B;&amp;#x578B;&amp;#x5206;&amp;#x4E24;&amp;#x79CD;&amp;#xFF1A;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Consumer pull&amp;#x6D88;&amp;#x606F;,&amp;#x5E94;&amp;#x7528;&amp;#x901A;&amp;#x5E38;&amp;#x4E3B;&amp;#x52A8;&amp;#x8C03;&amp;#x7528; Consumer &amp;#x7684;&amp;#x62C9;&amp;#x6D88;&amp;#x606F;&amp;#x65B9;&amp;#x6CD5;&amp;#x4ECE; Broker &amp;#x62C9;&amp;#x6D88;&amp;#x606F;&amp;#xFF0C;&amp;#x4E3B;&amp;#x52A8;&amp;#x6743;&amp;#x7531;&amp;#x5E94;&amp;#x7528;&amp;#x63A7;&amp;#x5236;&amp;#x3002;&lt;/li&gt;
&lt;li&gt;MQ Server push&amp;#x6D88;&amp;#x606F;,&amp;#x5E94;&amp;#x7528;&amp;#x901A;&amp;#x5E38;&amp;#x5411; Consumer &amp;#x5BF9;&amp;#x8C61;&amp;#x6CE8;&amp;#x518C;&amp;#x4E00;&amp;#x4E2A; Listener &amp;#x63A5;&amp;#x53E3;&amp;#xFF0C;&amp;#x4E00;&amp;#x65E6;&amp;#x6536;&amp;#x5230;&amp;#x6D88;&amp;#x606F;&amp;#xFF0C;Consumer &amp;#x5BF9;&amp;#x8C61;&amp;#x7ACB;&amp;#x523B;&amp;#x56DE;&amp;#x8C03; Listener &amp;#x63A5;&amp;#x53E3;&amp;#x65B9;&amp;#x6CD5;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;RocketMQ &amp;#x91C7;&amp;#x7528;Consumer pull&amp;#x6D88;&amp;#x606F;&amp;#xFF0C;&amp;#x867D;&amp;#x7136;&amp;#x4E5F;&amp;#x63D0;&amp;#x4F9B;&amp;#x4E86;&amp;#x6D88;&amp;#x606F;&amp;#x76D1;&amp;#x542C;&amp;#x673A;&amp;#x5236;&amp;#xFF0C;&amp;#x4F46;&amp;#x5E95;&amp;#x5C42;&amp;#x5B9E;&amp;#x73B0;&amp;#x8FD8;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;&amp;#x540E;&amp;#x53F0;&amp;#x5B9A;&amp;#x65F6;Pull&amp;#x6D88;&amp;#x606F;&amp;#x6765;&amp;#x5B9E;&amp;#x73B0;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;Consumer Group&amp;#x662F;&amp;#x4E00;&amp;#x7C7B;Consumer&amp;#x7684;&amp;#x96C6;&amp;#x5408;&amp;#x540D;&amp;#x79F0;&amp;#xFF0C;&amp;#x8FD9;&amp;#x7C7B;Consumer&amp;#x901A;&amp;#x5E38;&amp;#x6D88;&amp;#x8D39;&amp;#x4E00;&amp;#x7C7B;&amp;#x6D88;&amp;#x606F;&amp;#xFF0C;&amp;#x4E14;&amp;#x6D88;&amp;#x8D39;&amp;#x903B;&amp;#x8F91;&amp;#x4E00;&amp;#x81F4;&amp;#x3002;&lt;/p&gt;
&lt;h4 id=&quot;Broker&quot;&gt;&lt;a href=&quot;#Broker&quot; class=&quot;headerlink&quot; title=&quot;Broker&quot;&gt;&lt;/a&gt;Broker&lt;/h4&gt;&lt;p&gt;&amp;#x6D88;&amp;#x606F;&amp;#x7684;&amp;#x4E2D;&amp;#x8F6C;&amp;#x8005;&amp;#xFF0C;&amp;#x8D1F;&amp;#x8D23;&amp;#x5B58;&amp;#x50A8;&amp;#x548C;&amp;#x8F6C;&amp;#x53D1;&amp;#x6D88;&amp;#x606F;&amp;#x3002;&amp;#x53EF;&amp;#x4EE5;&amp;#x7406;&amp;#x89E3;&amp;#x4E3A;&amp;#x6D88;&amp;#x606F;&amp;#x961F;&amp;#x5217;&amp;#x670D;&amp;#x52A1;&amp;#x5668;&amp;#xFF0C;&amp;#x63D0;&amp;#x4F9B;&amp;#x4E86;&amp;#x6D88;&amp;#x606F;&amp;#x7684;&amp;#x63A5;&amp;#x6536;&amp;#x3001;&amp;#x5B58;&amp;#x50A8;&amp;#x3001;pull&amp;#x670D;&amp;#x52A1;&amp;#x3002;&amp;#x4E3A;&amp;#x4FDD;&amp;#x8BC1;Broker&amp;#x9AD8;&amp;#x53EF;&amp;#x7528;&amp;#xFF0C;Broker&amp;#x5206;&amp;#x4E3A;Master&amp;#x4E0E;Slave&amp;#xFF0C;&amp;#x4E00;&amp;#x4E2A;Master&amp;#x53EF;&amp;#x4EE5;&amp;#x5BF9;&amp;#x5E94;&amp;#x591A;&amp;#x4E2A;Slaves&amp;#xFF0C;Master&amp;#x4E0E;Slave&amp;#x6570;&amp;#x636E;&amp;#x540C;&amp;#x6B65;&amp;#x53EF;&amp;#x4EE5;&amp;#x662F;&amp;#x540C;&amp;#x6B65;&amp;#x4E0E;&amp;#x5F02;&amp;#x6B65;&amp;#x3002;&lt;/p&gt;
&lt;h5 id=&quot;&amp;#x5E7F;&amp;#x64AD;&amp;#x6D88;&amp;#x8D39;&quot;&gt;&lt;a href=&quot;#&amp;#x5E7F;&amp;#x64AD;&amp;#x6D88;&amp;#x8D39;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x5E7F;&amp;#x64AD;&amp;#x6D88;&amp;#x8D39;&quot;&gt;&lt;/a&gt;&amp;#x5E7F;&amp;#x64AD;&amp;#x6D88;&amp;#x8D39;&lt;/h5&gt;&lt;p&gt;&amp;#x4E00;&amp;#x6761;&amp;#x6D88;&amp;#x606F;&amp;#x88AB;&amp;#x591A;&amp;#x4E2A;Consumer&amp;#x6D88;&amp;#x8D39;&amp;#xFF0C;&amp;#x5373;&amp;#x4F7F;&amp;#x8FD9;&amp;#x4E9B;Consumer&amp;#x5C5E;&amp;#x4E8E;&amp;#x540C;&amp;#x4E00;&amp;#x4E2A;Consumer Group&amp;#xFF0C;&amp;#x6D88;&amp;#x606F;&amp;#x4E5F;&amp;#x4F1A;&amp;#x88AB;Consumer Group&amp;#x4E2D;&amp;#x7684;&amp;#x6BCF;&amp;#x4E2A;Consumer&amp;#x90FD;&amp;#x6D88;&amp;#x8D39;&amp;#x4E00;&amp;#x6B21;&amp;#x3002;&amp;#x5728;&amp;#x5E7F;&amp;#x64AD;&amp;#x6D88;&amp;#x8D39;&amp;#x4E2D;&amp;#x7684;Consumer Group&amp;#x6982;&amp;#x5FF5;&amp;#x53EF;&amp;#x4EE5;&amp;#x8BA4;&amp;#x4E3A;&amp;#x5728;&amp;#x6D88;&amp;#x606F;&amp;#x5212;&amp;#x5206;&amp;#x65B9;&amp;#x9762;&amp;#x65E0;&amp;#x610F;&amp;#x4E49;&amp;#xFF08;JMS Topic&amp;#xFF09;&amp;#x3002;&lt;/p&gt;
&lt;h5 id=&quot;&amp;#x96C6;&amp;#x7FA4;&amp;#x6D88;&amp;#x8D39;&quot;&gt;&lt;a href=&quot;#&amp;#x96C6;&amp;#x7FA4;&amp;#x6D88;&amp;#x8D39;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x96C6;&amp;#x7FA4;&amp;#x6D88;&amp;#x8D39;&quot;&gt;&lt;/a&gt;&amp;#x96C6;&amp;#x7FA4;&amp;#x6D88;&amp;#x8D39;&lt;/h5&gt;&lt;p&gt;&amp;#x4E00;&amp;#x4E2A;Consumer Group&amp;#x4E2D;&amp;#x7684;Consumer&amp;#x5B9E;&amp;#x4F8B;&amp;#x5E73;&amp;#x5747;&amp;#x5206;&amp;#x644A;&amp;#x6D88;&amp;#x8D39;&amp;#x6D88;&amp;#x606F;&amp;#x3002;&amp;#x4F8B;&amp;#x5982;&amp;#x67D0;&amp;#x4E2A;Topic&amp;#x6709; 9 &amp;#x6761;&amp;#x6D88;&amp;#x606F;&amp;#xFF0C;&amp;#x5176;&amp;#x4E2D;&amp;#x4E00;&amp;#x4E2A;Consumer Group&amp;#x6709; 3 &amp;#x4E2A;&amp;#x5B9E;&amp;#x4F8B;(&amp;#x53EF;&amp;#x80FD;&amp;#x662F; 3 &amp;#x4E2A;&amp;#x8FDB;&amp;#x7A0B;,&amp;#x6216;&amp;#x8005; 3 &amp;#x53F0;&amp;#x673A;&amp;#x5668;)&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x6BCF;&amp;#x4E2A;&amp;#x5B9E;&amp;#x4F8B;&amp;#x53EA;&amp;#x6D88;&amp;#x8D39;&amp;#x5176;&amp;#x4E2D;&amp;#x7684; 3 &amp;#x6761;&amp;#x6D88;&amp;#x606F;&amp;#xFF08;P2P&amp;#xFF09;&amp;#x3002;&lt;/p&gt;
&lt;h4 id=&quot;NameServer&quot;&gt;&lt;a href=&quot;#NameServer&quot; class=&quot;headerlink&quot; title=&quot;NameServer&quot;&gt;&lt;/a&gt;NameServer&lt;/h4&gt;&lt;p&gt;Namesrv&amp;#xFF0C;&amp;#x540D;&amp;#x79F0;&amp;#x670D;&amp;#x52A1;&amp;#xFF0C;&amp;#x65E0;&amp;#x72B6;&amp;#x6001;&amp;#xFF0C;&amp;#x65E0;&amp;#x5355;&amp;#x70B9;&amp;#xFF0C;&amp;#x53EF;&amp;#x6A2A;&amp;#x5411;&amp;#x6269;&amp;#x5C55;&amp;#xFF0C;&amp;#x53EF;&amp;#x90E8;&amp;#x7F72;&amp;#x591A;&amp;#x4E2A;&amp;#xFF0C;&amp;#x4E00;&amp;#x822C;&amp;#x90E8;&amp;#x7F72;3&amp;#x53F0;&amp;#xFF0C;&amp;#x8282;&amp;#x70B9;&amp;#x4E4B;&amp;#x95F4;&amp;#x65E0;&amp;#x4EFB;&amp;#x4F55;&amp;#x4FE1;&amp;#x606F;&amp;#x540C;&amp;#x6B65;&amp;#xFF0C;&amp;#x4E3A;&amp;#x5BF9;&amp;#x7B49;&amp;#x8282;&amp;#x70B9;&amp;#x3002;&amp;#x4E3B;&amp;#x8981;&amp;#x6709;&amp;#x4E24;&amp;#x4E2A;&amp;#x529F;&amp;#x80FD;&amp;#x3002;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&amp;#x63A5;&amp;#x6536;Broker&amp;#x8BF7;&amp;#x6C42;&amp;#xFF0C;&amp;#x6CE8;&amp;#x518C;Broker&amp;#x8DEF;&amp;#x7531;&amp;#x4FE1;&amp;#x606F;&lt;/li&gt;
&lt;li&gt;&amp;#x63A5;&amp;#x6536;Client&amp;#xFF08;Producer&amp;#xFF0C;Consumer&amp;#xFF09;&amp;#x8BF7;&amp;#x6C42;&amp;#xFF0C;&amp;#x6839;&amp;#x636E;Topic&amp;#x83B7;&amp;#x53D6;&amp;#x5230;Brokers&amp;#x7684;&amp;#x8DEF;&amp;#x7531;&amp;#x4FE1;&amp;#x606F;&lt;/li&gt;
&lt;/ol&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;RocketMQ&quot;&gt;&lt;a href=&quot;#RocketMQ&quot; class=&quot;headerlink&quot; title=&quot;RocketMQ&quot;&gt;&lt;/a&gt;RocketMQ&lt;/h2&gt;&lt;h3 id=&quot;&amp;#x524D;&amp;#x4E16;&amp;#x4ECA;&amp;#x751F;&quot;&gt;&lt;a href
    
    </summary>
    
      <category term="Java" scheme="https://qiufanghua.github.io/categories/Java/"/>
    
      <category term="RocketMQ" scheme="https://qiufanghua.github.io/categories/Java/RocketMQ/"/>
    
    
      <category term="RocketMQ" scheme="https://qiufanghua.github.io/tags/RocketMQ/"/>
    
  </entry>
  
  <entry>
    <title>zk quorum peer start</title>
    <link href="https://qiufanghua.github.io/2016/05/14/zk-quorum-peer-start/"/>
    <id>https://qiufanghua.github.io/2016/05/14/zk-quorum-peer-start/</id>
    <published>2016-05-14T03:12:03.000Z</published>
    <updated>2016-05-14T15:20:24.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;QuorumPeerMain&quot;&gt;&lt;a href=&quot;#QuorumPeerMain&quot; class=&quot;headerlink&quot; title=&quot;QuorumPeerMain&quot;&gt;&lt;/a&gt;QuorumPeerMain&lt;/h1&gt;&lt;p&gt;Zookeeper&amp;#x96C6;&amp;#x6210;&amp;#x542F;&amp;#x52A8;&amp;#x7C7B;&amp;#xFF0C;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;main&amp;#x65B9;&amp;#x6CD5;&amp;#x542F;&amp;#x52A8;&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;initializeAndRun&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String[] args)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; ConfigException, IOException, AdminServerException&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        QuorumPeerConfig config = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; QuorumPeerConfig();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (args.length == &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            config.parse(args[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// Start and schedule the the purge task&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        DatadirCleanupManager purgeMgr = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DatadirCleanupManager(config&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .getDataDir(), config.getDataLogDir(), config&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .getSnapRetainCount(), config.getPurgeInterval());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        purgeMgr.start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (args.length == &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; &amp;amp;&amp;amp; config.isDistributed()) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            runFromConfig(config);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        } &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            LOG.warn(&lt;span class=&quot;string&quot;&gt;&amp;quot;Either no config or no quorum defined in config, running &amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    + &lt;span class=&quot;string&quot;&gt;&amp;quot; in standalone mode&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// there is only server in the quorum -- run as standalone&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ZooKeeperServerMain.main(args);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;QuorumPeerConfig&amp;#x89E3;&amp;#x6790;Zookeeper&amp;#x914D;&amp;#x7F6E;&amp;#x6587;&amp;#x4EF6;&lt;br&gt;zooSample.cfg&lt;br&gt; tickTime=2000&lt;br&gt; dataDir=/zookeeper/data/zookeeper1&lt;br&gt; initLimit=5&lt;br&gt; syncLimit=2&lt;br&gt; dynamicConfigFile=/zookeeper/conf/zoo_replicated1.cfg.dynamic&lt;br&gt;&amp;#x4E3B;&amp;#x8981;&amp;#x5C5E;&amp;#x6027;&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; InetSocketAddress clientPortAddress;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; InetSocketAddress secureClientPortAddress;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// ZK &amp;#x6570;&amp;#x636E;&amp;#x5B58;&amp;#x50A8;&amp;#x76EE;&amp;#x5F55;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; File dataDir;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// ZK&amp;#x8282;&amp;#x70B9;&amp;#x7F16;&amp;#x8F91;&amp;#x65E5;&amp;#x5FD7;&amp;#x5B58;&amp;#x50A8;&amp;#x76EE;&amp;#x5F55;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; File dataLogDir;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; String dynamicConfigFileStr = &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; String configFileStr = &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; tickTime = ZooKeeperServer.DEFAULT_TICK_TIME;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; maxClientCnxns = &lt;span class=&quot;number&quot;&gt;60&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;/** defaults to -1 if not set explicitly */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; minSessionTimeout = -&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;/** defaults to -1 if not set explicitly */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; maxSessionTimeout = -&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; localSessionsEnabled = &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; localSessionsUpgradingEnabled = &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//&amp;#x94FE;&amp;#x63A5;&amp;#xFF1F;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; initLimit;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; syncLimit;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; electionAlg = &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; electionPort = &lt;span class=&quot;number&quot;&gt;2182&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; quorumListenOnAllIPs = &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// &amp;#x5F53;&amp;#x524D;&amp;#x8282;&amp;#x70B9;&amp;#x7684;ServerId&amp;#xFF0C;myIdFile&amp;#xFF1D;new File(dataDir, &amp;quot;myid&amp;quot;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; serverId = UNSET_SERVERID;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Quorum&amp;#x9A8C;&amp;#x8BC1;&amp;#xFF1B;&amp;#x6682;&amp;#x5B58;&amp;#x914D;&amp;#x7F6E;&amp;#x7684;QuorumServer&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; QuorumVerifier quorumVerifier = &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;, lastSeenQuorumVerifier = &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; snapRetainCount = &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; purgeInterval = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; syncEnabled = &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;//&amp;#x8282;&amp;#x70B9;&amp;#x7C7B;&amp;#x578B;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; LearnerType peerType = LearnerType.PARTICIPANT;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&amp;#x89E3;&amp;#x6790;dynamicConfigFileStr&amp;#xFF0C;&amp;#x521B;&amp;#x5EFA;QuorumVerifier&lt;br&gt;dynamicConfigFile&lt;br&gt; server.&lt;positive id=&quot;&quot;&gt; = &lt;address1&gt;:&lt;port1&gt;:&lt;port2&gt;[:role];[&lt;client port=&quot;&quot; address=&quot;&quot;&gt;:]&lt;client port=&quot;&quot;&gt;&lt;br&gt; server.1=125.23.63.23: 2780: 2783: participant;2791&lt;br&gt; server.2=125.23.63.24: 2781: 2784: participant;2792&lt;br&gt; server.3=125.23.63.25: 2782: 2785: participant;2793&lt;br&gt; group.1=1: 2: 3&lt;br&gt; group.2=4: 5: 6&lt;br&gt; group.3=7: 8: 9&lt;br&gt; weight.1=1&lt;br&gt; weight.2=1&lt;br&gt; weight.3=1&lt;br&gt; weight.4=1&lt;br&gt; weight.5=1&lt;br&gt; weight.6=1&lt;br&gt; weight.7=1&lt;br&gt; weight.8=1&lt;br&gt; weight.9=1&lt;/client&gt;&lt;/client&gt;&lt;/port2&gt;&lt;/port1&gt;&lt;/address1&gt;&lt;/positive&gt;&lt;/p&gt;
 &lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; HashMap&amp;lt;Long, Long&amp;gt; serverWeight = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;Long, Long&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; HashMap&amp;lt;Long, Long&amp;gt; serverGroup = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;Long, Long&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; HashMap&amp;lt;Long, Long&amp;gt; groupWeight = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;Long, Long&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; numGroups = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Map&amp;lt;Long, QuorumServer&amp;gt; allMembers = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;Long, QuorumServer&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Map&amp;lt;Long, QuorumServer&amp;gt; participatingMembers = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;Long, QuorumServer&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Map&amp;lt;Long, QuorumServer&amp;gt; observingMembers = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;Long, QuorumServer&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ol&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;QuorumPeerMain&quot;&gt;&lt;a href=&quot;#QuorumPeerMain&quot; class=&quot;headerlink&quot; title=&quot;QuorumPeerMain&quot;&gt;&lt;/a&gt;QuorumPeerMain&lt;/h1&gt;&lt;p&gt;Zookeeper&amp;#x96C6;&amp;#x62
    
    </summary>
    
      <category term="Java" scheme="https://qiufanghua.github.io/categories/Java/"/>
    
      <category term="Zookeeper" scheme="https://qiufanghua.github.io/categories/Java/Zookeeper/"/>
    
    
      <category term="Zookeeper" scheme="https://qiufanghua.github.io/tags/Zookeeper/"/>
    
  </entry>
  
  <entry>
    <title>zkquorum-manager</title>
    <link href="https://qiufanghua.github.io/2016/05/14/zk-quorum-manager/"/>
    <id>https://qiufanghua.github.io/2016/05/14/zk-quorum-manager/</id>
    <published>2016-05-14T03:06:14.000Z</published>
    <updated>2017-01-06T14:56:44.000Z</updated>
    
    <content type="html"></content>
    
    <summary type="html">
    
    </summary>
    
      <category term="Java" scheme="https://qiufanghua.github.io/categories/Java/"/>
    
      <category term="Zookeeper" scheme="https://qiufanghua.github.io/categories/Java/Zookeeper/"/>
    
    
      <category term="Zookeeper" scheme="https://qiufanghua.github.io/tags/Zookeeper/"/>
    
  </entry>
  
  <entry>
    <title>Datanode Manager</title>
    <link href="https://qiufanghua.github.io/2016/05/08/Datanode-Manager/"/>
    <id>https://qiufanghua.github.io/2016/05/08/Datanode-Manager/</id>
    <published>2016-05-08T02:08:55.000Z</published>
    <updated>2016-05-08T02:08:55.000Z</updated>
    
    <content type="html"></content>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Block Manager</title>
    <link href="https://qiufanghua.github.io/2016/05/08/Block-Manager/"/>
    <id>https://qiufanghua.github.io/2016/05/08/Block-Manager/</id>
    <published>2016-05-08T02:02:36.000Z</published>
    <updated>2016-05-08T02:27:35.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;Block-Manager&quot;&gt;&lt;a href=&quot;#Block-Manager&quot; class=&quot;headerlink&quot; title=&quot;Block Manager&quot;&gt;&lt;/a&gt;Block Manager&lt;/h1&gt;&lt;p&gt;&amp;#x4FDD;&amp;#x5B58;&amp;#x96C6;&amp;#x6210;&amp;#x4E2D;&amp;#x6570;&amp;#x636E;&amp;#x5757;&amp;#x4FE1;&amp;#x606F;&lt;/p&gt;
&lt;h2 id=&quot;&amp;#x4E3B;&amp;#x8981;&amp;#x4F9D;&amp;#x8D56;&quot;&gt;&lt;a href=&quot;#&amp;#x4E3B;&amp;#x8981;&amp;#x4F9D;&amp;#x8D56;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x4E3B;&amp;#x8981;&amp;#x4F9D;&amp;#x8D56;&quot;&gt;&lt;/a&gt;&amp;#x4E3B;&amp;#x8981;&amp;#x4F9D;&amp;#x8D56;&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/2016/05/08/Block-Manager/block_manager_class.png&quot; alt=&quot;Block Manager&quot; title=&quot;Block Manager&quot;&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Block-Manager&quot;&gt;&lt;a href=&quot;#Block-Manager&quot; class=&quot;headerlink&quot; title=&quot;Block Manager&quot;&gt;&lt;/a&gt;Block Manager&lt;/h1&gt;&lt;p&gt;&amp;#x4FDD;&amp;#x5B58;&amp;#x96C6;&amp;#
    
    </summary>
    
      <category term="Java" scheme="https://qiufanghua.github.io/categories/Java/"/>
    
      <category term="Hadoop" scheme="https://qiufanghua.github.io/categories/Java/Hadoop/"/>
    
    
      <category term="Hadoop" scheme="https://qiufanghua.github.io/tags/Hadoop/"/>
    
  </entry>
  
  <entry>
    <title>hadoop name node start</title>
    <link href="https://qiufanghua.github.io/2016/05/07/hadoop-name-node-start/"/>
    <id>https://qiufanghua.github.io/2016/05/07/hadoop-name-node-start/</id>
    <published>2016-05-07T10:02:14.000Z</published>
    <updated>2016-05-08T02:03:45.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;Hadoop-Namenode-Server-Start&quot;&gt;&lt;a href=&quot;#Hadoop-Namenode-Server-Start&quot; class=&quot;headerlink&quot; title=&quot;Hadoop Namenode Server Start&quot;&gt;&lt;/a&gt;Hadoop Namenode Server Start&lt;/h1&gt;&lt;p&gt;Namenode &amp;#x547D;&amp;#x540D;&amp;#x8282;&amp;#x70B9;&amp;#x4E3B;&amp;#x8981;&amp;#x7BA1;&amp;#x7406;&amp;#x76EE;&amp;#x5F55;&amp;#x547D;&amp;#x540D;&amp;#x7A7A;&amp;#x95F4;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;&amp;#x6570;&amp;#x636E;&amp;#x5757;&amp;#x4FE1;&amp;#x606F;&amp;#x7BA1;&amp;#x7406;&amp;#xFF1B;&amp;#x540C;&amp;#x65F6;&amp;#x7EF4;&amp;#x62A4;&amp;#x8005;&amp;#x6587;&amp;#x4EF6;&amp;#x540D;&amp;#x5230;&amp;#x5757;&amp;#x5E8F;&amp;#x5217;&amp;#x5173;&amp;#x7CFB;(namespace)&amp;#xFF0C;&amp;#x8FD9;&amp;#x5757;&amp;#x4FE1;&amp;#x606F;&amp;#x4F1A;&amp;#x5B58;&amp;#x5230;&amp;#x78C1;&amp;#x76D8;&amp;#xFF1B;&amp;#x5DF2;&amp;#x4FDD;&amp;#x5B58;&amp;#x6570;&amp;#x636E;&amp;#x5757;&amp;#x4E0E;&amp;#x6570;&amp;#x636E;&amp;#x8282;&amp;#x70B9;&amp;#x5230;&amp;#x5BF9;&amp;#x5E94;&amp;#x5173;&amp;#x7CFB;&amp;#xFF0C;&amp;#x6B64;&amp;#x4FE1;&amp;#x606F;&amp;#x4F1A;&amp;#x5728;namenode &amp;#x542F;&amp;#x52A8;&amp;#x65F6;&amp;#x91CD;&amp;#x5EFA;&amp;#x3002;Namenode&amp;#x5B9E;&amp;#x73B0;ClientProtocol&amp;#x63A5;&amp;#x53E3;&amp;#xFF0C;&amp;#x63D0;&amp;#x4F9B;&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&amp;#x64CD;&amp;#x4F5C;DFS services&amp;#xFF1B;&amp;#x4E5F;&amp;#x5B9E;&amp;#x73B0;DataNodeProtocol&amp;#x63A5;&amp;#x53E3;&amp;#xFF0C;&amp;#x63D0;&amp;#x4F9B;DataNode&amp;#x901A;&amp;#x8BAF;&amp;#x7684;&amp;#x63A5;&amp;#x53E3;&amp;#xFF1B;&amp;#x5B9E;&amp;#x73B0;NamenodeProtocol&amp;#xFF0C;&amp;#x63D0;&amp;#x4F9B;Secondary namenodes&amp;#x901A;&amp;#x8BAF;&amp;#x7684;&amp;#x63A5;&amp;#x53E3;&amp;#x3002;&lt;br&gt;&amp;#x6211;&amp;#x4EEC;&amp;#x4ECE;main&amp;#x65B9;&amp;#x6CD5;&amp;#x5F00;&amp;#x59CB;&amp;#x5206;&amp;#x6790;&amp;#xFF1A;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;main&amp;#x542F;&amp;#x52A8;&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String argv[])&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// help&amp;#x63D0;&amp;#x793A;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (DFSUtil.parseHelpArgument(argv, NameNode.USAGE, System.out, &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;)) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      System.exit(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      StringUtils.startupShutdownMessage(NameNode.class, argv, LOG);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  &lt;span class=&quot;comment&quot;&gt;// &amp;#x521B;&amp;#x5EFA;NameNode&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      NameNode namenode = createNameNode(argv, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  &lt;span class=&quot;comment&quot;&gt;// &amp;#x7B49;&amp;#x5F85;NameNode&amp;#x7EBF;&amp;#x7A0B;&amp;#x7ED3;&amp;#x675F;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (namenode != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        namenode.join();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    } &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Throwable e) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      LOG.error(&lt;span class=&quot;string&quot;&gt;&amp;quot;Failed to start namenode.&amp;quot;&lt;/span&gt;, e);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      terminate(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, e);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  }&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;new NameNode&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;NameNode&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Configuration conf, NamenodeRole role)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;(conf);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.tracer = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Tracer.Builder(&lt;span class=&quot;string&quot;&gt;&amp;quot;NameNode&amp;quot;&lt;/span&gt;).&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        conf(TraceUtils.wrapHadoopConf(NAMENODE_HTRACE_PREFIX, conf)).&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        build();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.tracerConfigurationManager =&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; TracerConfigurationManager(NAMENODE_HTRACE_PREFIX, conf);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.role = role;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    setClientNamenodeAddress(conf);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;// &amp;#x83B7;&amp;#x53D6;&amp;#x547D;&amp;#x540D;&amp;#x670D;&amp;#x52A1;ID&amp;#xFF0C;&amp;#x8054;&amp;#x90A6;&amp;#x670D;&amp;#x52A1;(&amp;#x6269;&amp;#x5C55;NameNode&amp;#x7BA1;&amp;#x7406;&amp;#x6587;&amp;#x4EF6;&amp;#x5BF9;&amp;#x5E94;&amp;#x5757;&amp;#x4FE1;&amp;#x606F;&amp;#x7684;&amp;#x80FD;&amp;#x529B;&amp;#xFF0C;&amp;#x540E;&amp;#x7EED;&amp;#x518D;&amp;#x505A;&amp;#x8FD9;&amp;#x5757;&amp;#x5730;&amp;#x5206;&amp;#x6790;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String nsId = getNameServiceId(conf);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String namenodeId = HAUtil.getNameNodeId(conf, nsId);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;// &amp;#x9AD8;&amp;#x53EF;&amp;#x7528;&amp;#x662F;&amp;#x5426;&amp;#x914D;&amp;#x7F6E;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.haEnabled = HAUtil.isHAEnabled(conf, nsId);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;// &amp;#x6839;&amp;#x636E;&amp;#x542F;&amp;#x52A8;&amp;#x9879;&amp;#x51B3;&amp;#x5B9A;&amp;#x662F;Master&amp;#x4E0E;StandBy&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    state = createHAState(getStartupOption(conf));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.allowStaleStandbyReads = HAUtil.shouldAllowStandbyReads(conf);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;// &amp;#x521B;&amp;#x5EFA;NameNodeHaContext&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.haContext = createHAContext();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      initializeGenericKeys(conf, nsId, namenodeId);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	  &lt;span class=&quot;comment&quot;&gt;// &amp;#x521D;&amp;#x59CB;&amp;#x5316;NameNode&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      initialize(getConf());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        haContext.writeLock();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        state.prepareToEnterState(haContext);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        state.enterState(haContext);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      } &lt;span class=&quot;keyword&quot;&gt;finally&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        haContext.writeUnlock();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    } &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.stopAtException(e);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; e;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    } &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (HadoopIllegalArgumentException e) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.stopAtException(e);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; e;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.started.set(&lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  }&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&amp;#x521B;&amp;#x5EFA;NameNodeHAContext&amp;#x8FC7;&amp;#x7A0B;&amp;#xFF0C;&amp;#x5176;&amp;#x5B9E;&amp;#x5C31;&amp;#x662F;&amp;#x4FDD;&amp;#x5B58;&amp;#x72B6;&amp;#x6001;&amp;#x4E0E;&amp;#x9009;&amp;#x62E9;&amp;#x884C;&amp;#x7684;&amp;#x66B4;&amp;#x9732;&amp;#x4E00;&amp;#x4E9B;&amp;#x63A5;&amp;#x53E3;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&amp;#x521D;&amp;#x59CB;&amp;#x5316;NameNode&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;initialize&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Configuration conf)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (conf.get(HADOOP_USER_GROUP_METRICS_PERCENTILES_INTERVALS) == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      String intervals = conf.get(DFS_METRICS_PERCENTILES_INTERVALS_KEY);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (intervals != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        conf.set(HADOOP_USER_GROUP_METRICS_PERCENTILES_INTERVALS,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          intervals);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    UserGroupInformation.setConfiguration(conf);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    loginAsNameNodeUser(conf);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NameNode.initMetrics(conf, &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.getRole());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    StartupProgressMetrics.register(startupProgress);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    pauseMonitor = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; JvmPauseMonitor();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    pauseMonitor.init(conf);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    pauseMonitor.start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    metrics.getJvmMetrics().setPauseMonitor(pauseMonitor);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (NamenodeRole.NAMENODE == role) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;// &amp;#x542F;&amp;#x52A8;NameNodeHttpServer&amp;#xFF0C;&amp;#x6B64;&amp;#x8FC7;&amp;#x7A0B;&amp;#x53E6;&amp;#x505A;&amp;#x5206;&amp;#x6790;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      startHttpServer(conf);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;// &amp;#x52A0;&amp;#x8F7D;&amp;#x6587;&amp;#x4EF6;&amp;#x7CFB;&amp;#x7EDF;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    loadNamesystem(conf);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    rpcServer = createRpcServer(conf);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    initReconfigurableBackoffKey();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (clientNamenodeAddress == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// This is expected for MiniDFSCluster. Set it now using &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// the RPC server&amp;apos;s bind address.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      clientNamenodeAddress = &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          NetUtils.getHostPortString(rpcServer.getRpcAddress());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      LOG.info(&lt;span class=&quot;string&quot;&gt;&amp;quot;Clients are to use &amp;quot;&lt;/span&gt; + clientNamenodeAddress + &lt;span class=&quot;string&quot;&gt;&amp;quot; to access&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          + &lt;span class=&quot;string&quot;&gt;&amp;quot; this namenode/service.&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (NamenodeRole.NAMENODE == role) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      httpServer.setNameNodeAddress(getNameNodeAddress());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      httpServer.setFSImage(getFSImage());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    startCommonServices(conf);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    startMetricsLogger(conf);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  }&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&amp;#x8BFB;&amp;#x53D6;&amp;#x6587;&amp;#x4EF6;&amp;#xFF0C;&amp;#x52A0;&amp;#x8F7D;Image&amp;#x4E0E;Edit&amp;#x6587;&amp;#x4EF6;&amp;#xFF0C;&amp;#x521B;&amp;#x5EFA;FsNamesystem&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&amp;#x521B;&amp;#x5EFA;BlockManager&lt;/li&gt;
&lt;/ol&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Hadoop-Namenode-Server-Start&quot;&gt;&lt;a href=&quot;#Hadoop-Namenode-Server-Start&quot; class=&quot;headerlink&quot; title=&quot;Hadoop Namenode Server Start&quot;&gt;&lt;/a&gt;Ha
    
    </summary>
    
      <category term="Java" scheme="https://qiufanghua.github.io/categories/Java/"/>
    
      <category term="Hadoop" scheme="https://qiufanghua.github.io/categories/Java/Hadoop/"/>
    
    
      <category term="Hadoop" scheme="https://qiufanghua.github.io/tags/Hadoop/"/>
    
  </entry>
  
  <entry>
    <title>dubbo service gray deploy</title>
    <link href="https://qiufanghua.github.io/2016/05/02/dubbo-service-gray-deploy/"/>
    <id>https://qiufanghua.github.io/2016/05/02/dubbo-service-gray-deploy/</id>
    <published>2016-05-02T13:30:06.000Z</published>
    <updated>2017-01-06T15:17:35.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;&amp;#x80CC;&amp;#x666F;&quot;&gt;&lt;a href=&quot;#&amp;#x80CC;&amp;#x666F;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x80CC;&amp;#x666F;&quot;&gt;&lt;/a&gt;&amp;#x80CC;&amp;#x666F;&lt;/h1&gt;&lt;p&gt;&amp;#x6211;&amp;#x4EEC;&amp;#x73B0;&amp;#x5728;&amp;#x7684;&amp;#x7070;&amp;#x5EA6;&amp;#x662F;&amp;#x57FA;&amp;#x4E8E;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7EA7;&amp;#x522B;&amp;#xFF0C;&amp;#x662F;&amp;#x5728;FCP&amp;#x7CFB;&amp;#x7EDF;&amp;#x4E0A;&amp;#x5BF9;&amp;#x6240;&amp;#x4EE5;&amp;#x8FC7;&amp;#x6765;&amp;#x7684;&amp;#x8BF7;&amp;#x6C42;&amp;#x8FDB;&amp;#x884C;&amp;#x62E6;&amp;#x622A;&amp;#xFF0C;&amp;#x901A;&amp;#x8FC7;&amp;#x8BF7;&amp;#x6C42;&amp;#x53C2;&amp;#x6570;&amp;#xFF0C;&amp;#x5BA2;&amp;#x670D;&amp;#x7AEF;IP&amp;#x6765;&amp;#x51B3;&amp;#x5B9A;&amp;#x662F;&amp;#x5426;&amp;#x80FD;&amp;#x591F;&amp;#x8BBF;&amp;#x95EE;&amp;#x88AB;&amp;#x8BBF;&amp;#x95EE;&amp;#x7684;&amp;#x7CFB;&amp;#x7EDF;&amp;#x3002;&amp;#x8FD9;&amp;#x63A7;&amp;#x5236;&amp;#x7C92;&amp;#x5EA6;&amp;#x592A;&amp;#x5927;&amp;#x4E86;&amp;#xFF0C;&amp;#x6CA1;&amp;#x6CD5;&amp;#x505A;&amp;#x5230;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x7070;&amp;#x5EA6;&amp;#x66F4;&amp;#x65B0;&amp;#x4EE5;&amp;#x53CA;&amp;#x670D;&amp;#x52A1;&amp;#x7684;&amp;#x7070;&amp;#x5EA6;&amp;#x53D1;&amp;#x5E03;&amp;#x3002;&amp;#x4F8B;&amp;#x5982;&amp;#xFF0C;&amp;#x7CFB;&amp;#x7EDF;A&amp;#x5728;&amp;#x673A;&amp;#x5668;s1&amp;#x4E0E;s2&amp;#x4E0A;&amp;#x90E8;&amp;#x7F72;&amp;#x7684;&amp;#x662F;v1&amp;#x7684;&amp;#x7248;&amp;#x672C;&amp;#xFF0C;&amp;#x5728;s3&amp;#x4E0E;s4&amp;#x4E0A;&amp;#x90E8;&amp;#x7F72;&amp;#x7684;&amp;#x662F;&amp;#x66F4;&amp;#x65B0;&amp;#x4E86;&amp;#x670D;&amp;#x52A1;&amp;#x7684;v2&amp;#x7684;&amp;#x7248;&amp;#x672C;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x9700;&amp;#x8981;&amp;#x4F01;&amp;#x4E1A;A&amp;#x53EA;&amp;#x80FD;&amp;#x8BBF;&amp;#x95EE;v2&amp;#x7684;&amp;#x7248;&amp;#x672C;&amp;#xFF0C;&amp;#x4F01;&amp;#x4E1A;B&amp;#x53EA;&amp;#x80FD;&amp;#x8BBF;&amp;#x95EE;v1&amp;#x7684;&amp;#x7248;&amp;#x672C;&amp;#xFF0C;&amp;#x8FD9;&amp;#x79CD;&amp;#x60C5;&amp;#x51B5;&amp;#x73B0;&amp;#x6709;&amp;#x7684;&amp;#x7070;&amp;#x5EA6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x662F;&amp;#x65E0;&amp;#x6CD5;&amp;#x5B9E;&amp;#x73B0;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x9700;&amp;#x8981;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x7070;&amp;#x5EA6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x80FD;&amp;#x591F;&amp;#x63D0;&amp;#x4F9B;&amp;#x57FA;&amp;#x4E8E;&amp;#x5E94;&amp;#x7528;&amp;#x3001;&amp;#x57FA;&amp;#x4E8E;&amp;#x90E8;&amp;#x7F72;&amp;#x5230;&amp;#x673A;&amp;#x5668;&amp;#x3001;&amp;#x57FA;&amp;#x4E8E;&amp;#x670D;&amp;#x52A1;&amp;#x7EA7;&amp;#x522B;&amp;#x7684;&amp;#x7070;&amp;#x5EA6;&amp;#x63A7;&amp;#x5236;&amp;#x3002;&lt;/p&gt;
&lt;h1 id=&quot;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7ED3;&amp;#x6784;&quot;&gt;&lt;a href=&quot;#&amp;#x7CFB;&amp;#x7EDF;&amp;#x7ED3;&amp;#x6784;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7ED3;&amp;#x6784;&quot;&gt;&lt;/a&gt;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7ED3;&amp;#x6784;&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;/2016/05/02/dubbo-service-gray-deploy/gray_servcie_architect.png&quot; alt=&quot;gray architect&quot; title=&quot;gray architect &quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;&amp;#x7CFB;&amp;#x7EDF;&amp;#x6A21;&amp;#x5757;&quot;&gt;&lt;a href=&quot;#&amp;#x7CFB;&amp;#x7EDF;&amp;#x6A21;&amp;#x5757;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x7CFB;&amp;#x7EDF;&amp;#x6A21;&amp;#x5757;&quot;&gt;&lt;/a&gt;&amp;#x7CFB;&amp;#x7EDF;&amp;#x6A21;&amp;#x5757;&lt;/h1&gt;&lt;h2 id=&quot;&amp;#x7070;&amp;#x5EA6;&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&quot;&gt;&lt;a href=&quot;#&amp;#x7070;&amp;#x5EA6;&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x7070;&amp;#x5EA6;&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&quot;&gt;&lt;/a&gt;&amp;#x7070;&amp;#x5EA6;&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&lt;/h2&gt;&lt;p&gt;&amp;#x8D77;&amp;#x521D;&amp;#x6211;&amp;#x4EEC;&amp;#x60F3;&amp;#x901A;&amp;#x8FC7;&amp;#x6269;&amp;#x5C55;Dubbo&amp;#x7684;&amp;#x670D;&amp;#x52A1;&amp;#x8DEF;&amp;#x7531;&amp;#x5668;&amp;#xFF0C;&amp;#x6DFB;&amp;#x52A0;&amp;#x57FA;&amp;#x4E8E;&amp;#x8BF7;&amp;#x6C42;&amp;#x53C2;&amp;#x6570;&amp;#x7684;&amp;#x8DEF;&amp;#x7531;&amp;#x5668;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x5728;Dubbo&amp;#x670D;&amp;#x52A1;&amp;#x8C03;&amp;#x7528;&amp;#x65F6;&amp;#x52A0;&amp;#x5165;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x7070;&amp;#x5EA6;&amp;#x903B;&amp;#x8F91;&amp;#xFF0C;&amp;#x8FC7;&amp;#x6EE4;&amp;#x4E0D;&amp;#x7B26;&amp;#x5408;&amp;#x6761;&amp;#x4EF6;&amp;#x7684;&amp;#x8FDC;&amp;#x7A0B;&amp;#x670D;&amp;#x52A1;&amp;#xFF0C;&amp;#x8FBE;&amp;#x5230;&amp;#x670D;&amp;#x52A1;&amp;#x5730;&amp;#x7070;&amp;#x5EA6;&amp;#x53D1;&amp;#x5E03;&amp;#x3002;&amp;#x4F46;&amp;#x662F;&amp;#x8FD9;&amp;#x79CD;&amp;#x5B9E;&amp;#x73B0;&amp;#x662F;&amp;#x57FA;&amp;#x4E8E;Dubbo&amp;#x670D;&amp;#x52A1;&amp;#x6765;&amp;#x914D;&amp;#x7F6E;&amp;#x8DEF;&amp;#x7531;&amp;#x89C4;&amp;#x5219;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x6211;&amp;#x4EEC;&amp;#x9700;&amp;#x8981;&amp;#x63D0;&amp;#x4F9B;&amp;#x57FA;&amp;#x4E8E;&amp;#x5E94;&amp;#x7528;&amp;#x7EA7;&amp;#x522B;&amp;#x7684;&amp;#x7070;&amp;#x5EA6;&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x9700;&amp;#x8981;&amp;#x4E3A;&amp;#x8BE5;&amp;#x5E94;&amp;#x7528;&amp;#x66B4;&amp;#x9732;&amp;#x6240;&amp;#x6709;&amp;#x670D;&amp;#x52A1;&amp;#x90FD;&amp;#x6DFB;&amp;#x52A0;&amp;#x8DEF;&amp;#x7531;&amp;#x89C4;&amp;#x5219;&amp;#xFF0C;&amp;#x4EE5;&amp;#x4FBF;&amp;#x6211;&amp;#x4EEC;Dubbo&amp;#x670D;&amp;#x52A1;&amp;#x5F15;&amp;#x7528;&amp;#x8005;&amp;#x80FD;&amp;#x591F;&amp;#x63A5;&amp;#x6536;&amp;#x5230;&amp;#x5BF9;&amp;#x5E94;&amp;#x670D;&amp;#x52A1;&amp;#x7684;&amp;#x8DEF;&amp;#x7531;&amp;#x89C4;&amp;#x5219;&amp;#x3002;&amp;#x8FD9;&amp;#x6709;&amp;#x4E24;&amp;#x4E2A;&amp;#x5F0A;&amp;#x7AEF;&amp;#xFF0C;&amp;#x4E00;&amp;#x662F;&amp;#xFF0C;&amp;#x9891;&amp;#x7E41;&amp;#x7684;&amp;#x8BBE;&amp;#x7F6E;Dubbo&amp;#x670D;&amp;#x52A1;&amp;#x5F71;&amp;#x54CD;&amp;#x6027;&amp;#x80FD;&amp;#xFF1B;&amp;#x4E8C;&amp;#x662F;&amp;#xFF1A;&amp;#x670D;&amp;#x52A1;&amp;#x8DEF;&amp;#x7531;&amp;#x914D;&amp;#x7F6E;&amp;#x4FE1;&amp;#x606F;&amp;#x4F1A;&amp;#x63A8;&amp;#x9001;&amp;#x5230;&amp;#x6240;&amp;#x6709;&amp;#x7684;&amp;#x5BA2;&amp;#x670D;&amp;#x7AEF;&amp;#xFF0C;&amp;#x5373;&amp;#x4F7F;&amp;#x4ED6;&amp;#x6CA1;&amp;#x6709;&amp;#x6DFB;&amp;#x52A0;&amp;#x7070;&amp;#x5EA6;&amp;#x63A7;&amp;#x5236;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6709;&amp;#x4E9B;&amp;#x4E0D;&amp;#x5408;&amp;#x7406;&amp;#x3002;&lt;br&gt;&amp;#x56E0;&amp;#x6B64;&amp;#x6211;&amp;#x4EEC;&amp;#x91C7;&amp;#x7528;&amp;#x5982;&amp;#x4E0B;&amp;#x65B9;&amp;#x6848;&amp;#xFF1A;&lt;br&gt;&amp;#x5F15;&amp;#x7528;Dubbo&amp;#x670D;&amp;#x52A1;&amp;#x65F6;&amp;#xFF0C;Dubbo&amp;#x8FD4;&amp;#x56DE;Invoker&amp;#x5BF9;&amp;#x8C61;&amp;#x5F15;&amp;#x7528;&amp;#x8FDC;&amp;#x7A0B;&amp;#x670D;&amp;#x52A1;&amp;#xFF0C;&amp;#x5728;&amp;#x8BF7;&amp;#x6C42;&amp;#x670D;&amp;#x52A1;&amp;#x65F6;&amp;#x4F1A;&amp;#x6839;&amp;#x636E;&amp;#x6211;&amp;#x4EEC;Invocation(&amp;#x670D;&amp;#x52A1;&amp;#x8BF7;&amp;#x6C42;&amp;#x4FE1;&amp;#x606F;)&amp;#x8C03;&amp;#x7528;Invoker&amp;#x5173;&amp;#x8054;&amp;#x7684;Directory&amp;#x7684;&amp;#x670D;&amp;#x52A1;&amp;#x67E5;&amp;#x627E;&amp;#x65B9;&amp;#x6CD5;&amp;#xFF0C;&amp;#x901A;&amp;#x8FC7;&amp;#x4EE3;&amp;#x7406;Directory&amp;#x7684;&amp;#x670D;&amp;#x52A1;&amp;#x67E5;&amp;#x627E;&amp;#x65B9;&amp;#x6CD5;&amp;#xFF0C;&amp;#x6DFB;&amp;#x52A0;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x7070;&amp;#x5EA6;&amp;#x903B;&amp;#x8F91;&amp;#x3002;&lt;/p&gt;
&lt;h3 id=&quot;Dubbo&amp;#x670D;&amp;#x52A1;&amp;#x67E5;&amp;#x627E;&amp;#x62E6;&amp;#x622A;&quot;&gt;&lt;a href=&quot;#Dubbo&amp;#x670D;&amp;#x52A1;&amp;#x67E5;&amp;#x627E;&amp;#x62E6;&amp;#x622A;&quot; class=&quot;headerlink&quot; title=&quot;Dubbo&amp;#x670D;&amp;#x52A1;&amp;#x67E5;&amp;#x627E;&amp;#x62E6;&amp;#x622A;&quot;&gt;&lt;/a&gt;Dubbo&amp;#x670D;&amp;#x52A1;&amp;#x67E5;&amp;#x627E;&amp;#x62E6;&amp;#x622A;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&amp;#x6DFB;&amp;#x52A0;Cluster Wrapper&amp;#x7C7B;&amp;#x3002;&amp;#x6DFB;&amp;#x52A0;&amp;#x6B64;&amp;#x7C7B;&amp;#x63D0;&amp;#x4F9B;&amp;#x4EE3;&amp;#x7406;Directory&amp;#x7684;&amp;#x5165;&amp;#x53E3;&amp;#x3002;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;GrayServiceClusterWrapper&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Cluster&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Cluster cluster;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;// Dubbo will inject properties which have associated setting method by SpringExtenstionFactory,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;// which uses property name lookup bean in spring context.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; GrayControlService grayControlService;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;GrayServiceClusterWrapper&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Cluster cluster)&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (cluster == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;string&quot;&gt;&amp;quot;cluster == null&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.cluster = cluster;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &amp;lt;T&amp;gt; &lt;span class=&quot;function&quot;&gt;Invoker&amp;lt;T&amp;gt; &lt;span class=&quot;title&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Directory&amp;lt;T&amp;gt; directory)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; RpcException &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (grayControlService == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; cluster.join(directory);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;comment&quot;&gt;// proxy directory list method and add gray logic&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; cluster.join(DirectoryProxyFactory.getProxy(directory, grayControlService));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;DirectoryProxyFactory&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Class&amp;lt;?&amp;gt;[] interfaces = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Class[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           interfaces[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;] = Directory.class;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &amp;lt;T&amp;gt; &lt;span class=&quot;function&quot;&gt;Directory&amp;lt;T&amp;gt; &lt;span class=&quot;title&quot;&gt;getProxy&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Directory&amp;lt;T&amp;gt; directory, GrayControlService grayControlService)&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (Directory&amp;lt;T&amp;gt;) Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(), interfaces, &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt;  DirectoryInvocationHandler(directory, grayControlService));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;DirectoryInvocationHandler&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;T&lt;/span&gt;&amp;gt; &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;InvocationHandler&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Directory&amp;lt;T&amp;gt; directory;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; GrayControlService grayControlService;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;DirectoryInvocationHandler&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Directory&amp;lt;T&amp;gt; directory, GrayControlService grayControlService)&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.directory = directory;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.grayControlService = grayControlService;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Object &lt;span class=&quot;title&quot;&gt;invoke&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Object proxy, Method method, Object[] args)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; Throwable &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           String methodName = method.getName();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           Class&amp;lt;?&amp;gt;[] parameterTypes = method.getParameterTypes();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;comment&quot;&gt;// user proxy object method&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;string&quot;&gt;&amp;quot;list&amp;quot;&lt;/span&gt;.equals(methodName) &amp;amp;&amp;amp; parameterTypes != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; parameterTypes.length == &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; &amp;amp;&amp;amp; parameterTypes[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;] == Invocation.class) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               Invocation invocation = (Invocation) args[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               URL consumerUrl;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               &lt;span class=&quot;comment&quot;&gt;// first we list all available invokers then we filter it by gray service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (AbstractDirectory.class.isAssignableFrom(directory.getClass())) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   AbstractDirectory absDirectory = (AbstractDirectory) directory;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   consumerUrl = absDirectory.getConsumerUrl();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               } &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   String interfaceName = directory.getInterface().getName();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   consumerUrl = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; URL(Constants.CONSUMER_PROTOCOL, NetUtils.getLocalHost(), &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, interfaceName, directory.getUrl().getParameters());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               List&amp;lt;Invoker&amp;lt;T&amp;gt;&amp;gt; invokers = directory.list(invocation);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; grayControlService.grayFilter(invokers, consumerUrl, invocation);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           } &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;string&quot;&gt;&amp;quot;getUrl&amp;quot;&lt;/span&gt;.equals(methodName)) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; directory.getUrl();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           } &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;string&quot;&gt;&amp;quot;isAvailable&amp;quot;&lt;/span&gt;.equals(methodName)) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; directory.isAvailable();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           } &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;string&quot;&gt;&amp;quot;destroy&amp;quot;&lt;/span&gt;.equals(methodName)) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               directory.destroy();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           } &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; method.invoke(proxy, args);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; GrayControlService &lt;span class=&quot;title&quot;&gt;getGrayControlService&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; grayControlService;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setGrayControlService&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(GrayControlService grayControlService)&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.grayControlService = grayControlService;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   	}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;&amp;#x6DFB;&amp;#x52A0;DirectoryInvocationHandler&amp;#x3002;&amp;#x4EE3;&amp;#x7406;Directory&amp;#x7684;&amp;#x670D;&amp;#x52A1;&amp;#x67E5;&amp;#x627E;&amp;#x65B9;&amp;#x6CD5;&amp;#xFF0C;&amp;#x52A0;&amp;#x5165;&amp;#x7070;&amp;#x5EA6;&amp;#x63A7;&amp;#x5236;&amp;#x903B;&amp;#x8F91;&amp;#x3002;&lt;/li&gt;
&lt;li&gt;&amp;#x5B9E;&amp;#x73B0;&amp;#x7070;&amp;#x5EA6;&amp;#x63A7;&amp;#x5236;&amp;#x903B;&amp;#x8F91;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;&amp;#x7070;&amp;#x5EA6;&amp;#x914D;&amp;#x7F6E;&amp;#x4FE1;&amp;#x606F;&amp;#x76D1;&amp;#x542C;&quot;&gt;&lt;a href=&quot;#&amp;#x7070;&amp;#x5EA6;&amp;#x914D;&amp;#x7F6E;&amp;#x4FE1;&amp;#x606F;&amp;#x76D1;&amp;#x542C;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x7070;&amp;#x5EA6;&amp;#x914D;&amp;#x7F6E;&amp;#x4FE1;&amp;#x606F;&amp;#x76D1;&amp;#x542C;&quot;&gt;&lt;/a&gt;&amp;#x7070;&amp;#x5EA6;&amp;#x914D;&amp;#x7F6E;&amp;#x4FE1;&amp;#x606F;&amp;#x76D1;&amp;#x542C;&lt;/h3&gt;&lt;p&gt;&amp;#x5B9E;&amp;#x65F6;&amp;#x7684;&amp;#x63A5;&amp;#x53D7;&amp;#x7070;&amp;#x5EA6;&amp;#x914D;&amp;#x7F6E;&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x7070;&amp;#x5EA6;&amp;#x63A7;&amp;#x5236;&amp;#x57FA;&amp;#x4E8E;&amp;#x6B64;&amp;#x914D;&amp;#x7F6E;&amp;#x4FE1;&amp;#x606F;&amp;#x8FDB;&amp;#x884C;&amp;#x7070;&amp;#x5EA6;&amp;#x5224;&amp;#x65AD;&amp;#x3002;&amp;#x76D1;&amp;#x542C;&amp;#x76EE;&amp;#x5F55;&amp;#xFF0F;fs_gray&lt;/p&gt;
&lt;h2 id=&quot;&amp;#x7070;&amp;#x5EA6;&amp;#x7BA1;&amp;#x7406;&amp;#x7CFB;&amp;#x7EDF;&quot;&gt;&lt;a href=&quot;#&amp;#x7070;&amp;#x5EA6;&amp;#x7BA1;&amp;#x7406;&amp;#x7CFB;&amp;#x7EDF;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x7070;&amp;#x5EA6;&amp;#x7BA1;&amp;#x7406;&amp;#x7CFB;&amp;#x7EDF;&quot;&gt;&lt;/a&gt;&amp;#x7070;&amp;#x5EA6;&amp;#x7BA1;&amp;#x7406;&amp;#x7CFB;&amp;#x7EDF;&lt;/h2&gt;&lt;h3 id=&quot;Dubbo&amp;#x670D;&amp;#x52A1;&amp;#x76D1;&amp;#x542C;&quot;&gt;&lt;a href=&quot;#Dubbo&amp;#x670D;&amp;#x52A1;&amp;#x76D1;&amp;#x542C;&quot; class=&quot;headerlink&quot; title=&quot;Dubbo&amp;#x670D;&amp;#x52A1;&amp;#x76D1;&amp;#x542C;&quot;&gt;&lt;/a&gt;Dubbo&amp;#x670D;&amp;#x52A1;&amp;#x76D1;&amp;#x542C;&lt;/h3&gt;&lt;p&gt;&amp;#x7070;&amp;#x5EA6;&amp;#x7CFB;&amp;#x7EDF;&amp;#x9700;&amp;#x8981;&amp;#x80FD;&amp;#x591F;&amp;#x53D1;&amp;#x73B0;&amp;#x6211;&amp;#x4EEC;&amp;#x6240;&amp;#x6709;&amp;#x7684;&amp;#x670D;&amp;#x52A1;&amp;#x63D0;&amp;#x4F9B;&amp;#x8005;&amp;#xFF0C;Dubbo&amp;#x5E76;&amp;#x6CA1;&amp;#x6709;&amp;#x63D0;&amp;#x4F9B;&amp;#x57FA;&amp;#x4E8E;&amp;#x5E94;&amp;#x7528;&amp;#x6216;&amp;#x8005;&amp;#x65F6;&amp;#x57FA;&amp;#x4E8E;&amp;#x673A;&amp;#x5668;&amp;#x7684;&amp;#x670D;&amp;#x52A1;&amp;#x67E5;&amp;#x627E;&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x6211;&amp;#x4EEC;&amp;#x9700;&amp;#x8981;&amp;#x76D1;&amp;#x542C;&amp;#x6240;&amp;#x6709;&amp;#x670D;&amp;#x52A1;&amp;#xFF0C;&amp;#x4EE5;&amp;#x4FBF;&amp;#x80FD;&amp;#x53D1;&amp;#x73B0;&amp;#x670D;&amp;#x52A1;&amp;#xFF0C;&amp;#x5BF9;&amp;#x6536;&amp;#x5230;&amp;#x7684;&amp;#x670D;&amp;#x52A1;&amp;#x63D0;&amp;#x4F9B;&amp;#x8005;&amp;#x4FE1;&amp;#x606F;&amp;#x8FDB;&amp;#x884C;&amp;#x5C01;&amp;#x88C5;&amp;#x540E;&amp;#xFF0C;&amp;#x4F9B;&amp;#x540E;&amp;#x7EED;&amp;#x7684;&amp;#x670D;&amp;#x52A1;&amp;#x67E5;&amp;#x8BE2;&amp;#x3002;&lt;/p&gt;
&lt;h3 id=&quot;Dubbo&amp;#x670D;&amp;#x52A1;&amp;#x67E5;&amp;#x8BE2;&quot;&gt;&lt;a href=&quot;#Dubbo&amp;#x670D;&amp;#x52A1;&amp;#x67E5;&amp;#x8BE2;&quot; class=&quot;headerlink&quot; title=&quot;Dubbo&amp;#x670D;&amp;#x52A1;&amp;#x67E5;&amp;#x8BE2;&quot;&gt;&lt;/a&gt;Dubbo&amp;#x670D;&amp;#x52A1;&amp;#x67E5;&amp;#x8BE2;&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&amp;#x6839;&amp;#x636E;&amp;#x5E94;&amp;#x7528;&amp;#x540D;&amp;#x79F0;&amp;#x67E5;&amp;#x8BE2;&amp;#x670D;&amp;#x52A1;&amp;#x5730;&amp;#x5740;&amp;#x5217;&amp;#x8868;&amp;#x3002;&lt;/li&gt;
&lt;li&gt;&amp;#x6839;&amp;#x636E;&amp;#x670D;&amp;#x52A1;&amp;#x5730;&amp;#x5740;&amp;#x67E5;&amp;#x8BE2;&amp;#x670D;&amp;#x52A1;&amp;#x5217;&amp;#x8868;&amp;#x3002;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;&amp;#x7070;&amp;#x5EA6;&amp;#x914D;&amp;#x7F6E;&quot;&gt;&lt;a href=&quot;#&amp;#x7070;&amp;#x5EA6;&amp;#x914D;&amp;#x7F6E;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x7070;&amp;#x5EA6;&amp;#x914D;&amp;#x7F6E;&quot;&gt;&lt;/a&gt;&amp;#x7070;&amp;#x5EA6;&amp;#x914D;&amp;#x7F6E;&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&amp;#x6839;&amp;#x636E;&amp;#x5E94;&amp;#x7528;&amp;#x914D;&amp;#x7F6E;&amp;#x7070;&amp;#x5EA6;&amp;#x3002;&lt;/li&gt;
&lt;li&gt;&amp;#x6839;&amp;#x636E;&amp;#x670D;&amp;#x52A1;&amp;#x5730;&amp;#x5740;&amp;#x914D;&amp;#x7F6E;&amp;#x7070;&amp;#x5EA6;&amp;#x3002;&lt;/li&gt;
&lt;li&gt;&amp;#x6839;&amp;#x636E;&amp;#x670D;&amp;#x52A1;&amp;#x914D;&amp;#x7F6E;&amp;#x7070;&amp;#x5EA6;&amp;#x3002;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;&amp;#x7070;&amp;#x5EA6;&amp;#x914D;&amp;#x7F6E;&amp;#x5728;zk&amp;#x7684;&amp;#x76EE;&amp;#x5F55;&amp;#x7ED3;&amp;#x6784;&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&amp;#x5E94;&amp;#x7528;&amp;#x7EA7;&amp;#x522B;&amp;#x7684;&amp;#x7070;&amp;#x5EA6;&amp;#x914D;&amp;#x7F6E;&amp;#x76EE;&amp;#x5F55;&lt;br&gt;&amp;#xFF0F;fs_gray/{application_name}&lt;/li&gt;
&lt;li&gt;&amp;#x670D;&amp;#x52A1;&amp;#x5730;&amp;#x5740;&amp;#x7EA7;&amp;#x522B;&amp;#x7684;&amp;#x7070;&amp;#x5EA6;&amp;#x914D;&amp;#x7F6E;&amp;#x76EE;&amp;#x5F55;&lt;br&gt;/fs_gray/{appliation_name}/{service_address}&lt;/li&gt;
&lt;li&gt;&amp;#x670D;&amp;#x52A1;&amp;#x7EA7;&amp;#x522B;&amp;#x7684;&amp;#x7070;&amp;#x5EA6;&amp;#x914D;&amp;#x7F6E;&amp;#x76EE;&amp;#x5F55;&lt;br&gt;&amp;#xFF0F;fs_gray/{application_name}/{service_address}/{service_url}&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;&amp;#x7070;&amp;#x5EA6;&amp;#x914D;&amp;#x7F6E;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// &amp;#x5BF9;&amp;#x5E94;&amp;#x914D;&amp;#x7F6E;&amp;#x7EA7;&amp;#x522B;&amp;#x662F;&amp;#x5426;&amp;#x53EF;&amp;#x7528;&amp;#x3002;eg&amp;#xFF1A;&amp;#x5728;&amp;#x5E94;&amp;#x7528;&amp;#x7EA7;&amp;#x522B;&amp;#x914D;&amp;#x7F6E;&amp;#x8BE5;&amp;#x5C5E;&amp;#x6027;false&amp;#xFF0C;&amp;#x8868;&amp;#x793A;&amp;#x8BE5;&amp;#x5F15;&amp;#x7528;&amp;#x4E0D;&amp;#x53EF;&amp;#x7528;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; available;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// &amp;#x8BBF;&amp;#x95EE;&amp;#x8005;&amp;#x767D;&amp;#x540D;&amp;#x5355;&amp;#x5730;&amp;#x5740;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;List&amp;lt;String&amp;gt; ipWhiteList;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;List&amp;lt;String&amp;gt; ipBlackList;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;List&amp;lt;String&amp;gt; enterpriseWhiteList;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;List&amp;lt;String&amp;gt; enterpriseBlackList;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;List&amp;lt;String&amp;gt; userIdWhiteList;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;List&amp;lt;String&amp;gt; userIdBlackList;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// &amp;#x8BBF;&amp;#x95EE;&amp;#x767E;&amp;#x5206;&amp;#x6BD4;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Integer percent;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;&amp;#x80CC;&amp;#x666F;&quot;&gt;&lt;a href=&quot;#&amp;#x80CC;&amp;#x666F;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x80CC;&amp;#x666F;&quot;&gt;&lt;/a&gt;&amp;#x80CC;&amp;#x666F;&lt;/h1&gt;&lt;p&gt;&amp;#x6211;&amp;#x4EE
    
    </summary>
    
      <category term="Java" scheme="https://qiufanghua.github.io/categories/Java/"/>
    
      <category term="Dubbo" scheme="https://qiufanghua.github.io/categories/Java/Dubbo/"/>
    
    
      <category term="Dubbo" scheme="https://qiufanghua.github.io/tags/Dubbo/"/>
    
  </entry>
  
  <entry>
    <title>dubbo provider start process analysis</title>
    <link href="https://qiufanghua.github.io/2016/04/27/dubbo-provider-start-process-analysis/"/>
    <id>https://qiufanghua.github.io/2016/04/27/dubbo-provider-start-process-analysis/</id>
    <published>2016-04-27T04:05:16.000Z</published>
    <updated>2017-01-06T15:22:36.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;Dubbo&amp;#x7B80;&amp;#x4ECB;&quot;&gt;&lt;a href=&quot;#Dubbo&amp;#x7B80;&amp;#x4ECB;&quot; class=&quot;headerlink&quot; title=&quot;Dubbo&amp;#x7B80;&amp;#x4ECB;&quot;&gt;&lt;/a&gt;Dubbo&amp;#x7B80;&amp;#x4ECB;&lt;/h1&gt;&lt;h1 id=&quot;Dubbo&amp;#x542F;&amp;#x52A8;&amp;#x8FC7;&amp;#x7A0B;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;a href=&quot;#Dubbo&amp;#x542F;&amp;#x52A8;&amp;#x8FC7;&amp;#x7A0B;&amp;#x5206;&amp;#x6790;&quot; class=&quot;headerlink&quot; title=&quot;Dubbo&amp;#x542F;&amp;#x52A8;&amp;#x8FC7;&amp;#x7A0B;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;/a&gt;Dubbo&amp;#x542F;&amp;#x52A8;&amp;#x8FC7;&amp;#x7A0B;&amp;#x5206;&amp;#x6790;&lt;/h1&gt;&lt;p&gt;Dubbo&amp;#x662F;&amp;#x57FA;&amp;#x4E8E;Spring&amp;#x5BB9;&amp;#x5668;&amp;#x914D;&amp;#x7F6E;&amp;#x4E0E;&amp;#x7BA1;&amp;#x7406;Dubbo&amp;#x670D;&amp;#x52A1;&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x901A;&amp;#x8FC7;Dubbo&amp;#x63D0;&amp;#x4F9B;&amp;#x7684;Spring&amp;#x547D;&amp;#x540D;&amp;#x7A7A;&amp;#x95F4;&amp;#x914D;&amp;#x7F6E;Dubbo&amp;#x5E94;&amp;#x7528;&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x53D1;&amp;#x5E03;&amp;#x7684;&amp;#x670D;&amp;#x52A1;&amp;#xFF0C;&amp;#x5F15;&amp;#x7528;&amp;#x7684;&amp;#x670D;&amp;#x52A1;&amp;#x7B49;&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x901A;&amp;#x8FC7;Spring&amp;#x5BB9;&amp;#x5668;&amp;#x542F;&amp;#x52A8;Dubbo&amp;#x670D;&amp;#x52A1;&amp;#xFF0C;&amp;#x4E0B;&amp;#x9762;&amp;#x4ECE;&amp;#x5206;&amp;#x522B;&amp;#x4ECE;&amp;#x670D;&amp;#x52A1;&amp;#x63D0;&amp;#x4F9B;&amp;#x8005;&amp;#x8BED;&amp;#x6D88;&amp;#x8D39;&amp;#x7740;&amp;#x8BE6;&amp;#x7EC6;&amp;#x7684;&amp;#x4ECB;&amp;#x7ECD;&amp;#x4E0B;&amp;#x542F;&amp;#x52A8;&amp;#x8FC7;&amp;#x7A0B;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;Dubbo&amp;#x670D;&amp;#x52A1;&amp;#x63D0;&amp;#x4F9B;&amp;#x8005;&amp;#x542F;&amp;#x52A8;&amp;#x8FC7;&amp;#x7A0B;&quot;&gt;&lt;a href=&quot;#Dubbo&amp;#x670D;&amp;#x52A1;&amp;#x63D0;&amp;#x4F9B;&amp;#x8005;&amp;#x542F;&amp;#x52A8;&amp;#x8FC7;&amp;#x7A0B;&quot; class=&quot;headerlink&quot; title=&quot;Dubbo&amp;#x670D;&amp;#x52A1;&amp;#x63D0;&amp;#x4F9B;&amp;#x8005;&amp;#x542F;&amp;#x52A8;&amp;#x8FC7;&amp;#x7A0B;&quot;&gt;&lt;/a&gt;Dubbo&amp;#x670D;&amp;#x52A1;&amp;#x63D0;&amp;#x4F9B;&amp;#x8005;&amp;#x542F;&amp;#x52A8;&amp;#x8FC7;&amp;#x7A0B;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Dubbo&amp;#x914D;&amp;#x7F6E;&amp;#x3002;&amp;#x901A;&amp;#x8FC7;dubbo namespace&amp;#x914D;&amp;#x7F6E;application&amp;#xFF0C;module&amp;#xFF0C;registry&amp;#xFF0C;monitor&amp;#xFF0C;provider&amp;#xFF0C;consumer&amp;#xFF0C;protocol&amp;#xFF0C;service&amp;#xFF0C;reference&amp;#xFF0C;annotation&amp;#x4FE1;&amp;#x606F;&amp;#xFF08;&amp;#x5404;&amp;#x6A21;&amp;#x5757;&amp;#x4FE1;&amp;#x606F;&amp;#x53C2;&amp;#x8003;&amp;#x6A21;&amp;#x5757;&amp;#x5206;&amp;#x6790;&amp;#x7AE0;&amp;#x8282;&amp;#xFF09;&amp;#x3002;&lt;/li&gt;
&lt;li&gt;Dubbo&amp;#x7684;jar&amp;#x5305;&amp;#x7684;META-INFO&amp;#x4E0B;sring.handlers&amp;#x4E2D;&amp;#x914D;&amp;#x7F6E;&amp;#x4E86;dubbo scheme&amp;#x7684;&amp;#x89E3;&amp;#x6790;&amp;#x5668;DubboNamespaceHandler&amp;#x3002;&lt;/li&gt;
&lt;li&gt;&lt;img src=&quot;/2016/04/27/dubbo-provider-start-process-analysis/dubbo_scheme_configuration.png&quot; alt=&quot;dubbo scheme configuration&quot;&gt;&lt;/li&gt;
&lt;li&gt;Dubbo&amp;#x547D;&amp;#x540D;&amp;#x7A7A;&amp;#x95F4;&amp;#x5904;&amp;#x7406;&amp;#x3002;DubboNamespaceHandler&amp;#x89E3;&amp;#x6790;&amp;#x914D;&amp;#x7F6E;&amp;#x7684;Dubbo&amp;#x4FE1;&amp;#x606F;&amp;#x5E76;&amp;#x751F;&amp;#x6210;&amp;#x76F8;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;BeanDefinition&amp;#xFF0C;&amp;#x4ECE;&amp;#x800C;&amp;#x751F;&amp;#x6210;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;Dubbo&amp;#x914D;&amp;#x7F6E;&amp;#x7C7B;&amp;#xFF0C;&amp;#x670D;&amp;#x52A1;Bean&amp;#xFF08;&amp;#x670D;&amp;#x52A1;&amp;#x63D0;&amp;#x4F9B;&amp;#x8005;&amp;#xFF09;&amp;#x4EE5;&amp;#x53CA;&amp;#x670D;&amp;#x52A1;Bean&amp;#x5F15;&amp;#x7528;&amp;#xFF08;&amp;#x670D;&amp;#x52A1;&amp;#x6D88;&amp;#x8D39;&amp;#x8005;&amp;#xFF09;&amp;#x3002;&amp;#x6D89;&amp;#x53CA;&amp;#x7684;&amp;#x7C7B;DubboNamespaceHandler&amp;#xFF08;Dubbo&amp;#x547D;&amp;#x540D;&amp;#x7A7A;&amp;#x95F4;&amp;#x5904;&amp;#x7406;&amp;#xFF09;&amp;#xFF0C;DubboBeanDefinitionParser&amp;#xFF08;&amp;#x89E3;&amp;#x6790;Dubbo&amp;#x914D;&amp;#x7F6E;&amp;#x5E76;&amp;#x751F;&amp;#x6210;BeanDefinition&amp;#xFF09;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2016/04/27/dubbo-provider-start-process-analysis/parser_regester.png&quot; alt=&quot;Dubbo parser registe&quot;&gt;&lt;/li&gt;
&lt;li&gt;&amp;#x670D;&amp;#x52A1;&amp;#x63D0;&amp;#x4F9B;&amp;#x8005;&amp;#x914D;&amp;#x7F6E;&amp;#x3002;Dubbo&amp;#x63D0;&amp;#x4F9B;&lt;dubbo:service&gt;xml&amp;#x4EE5;&amp;#x53CA;@Service&amp;#x6CE8;&amp;#x89E3;&amp;#x65B9;&amp;#x5F0F;&amp;#x914D;&amp;#x7F6E;&amp;#x670D;&amp;#x52A1;&amp;#x63D0;&amp;#x4F9B;&amp;#x8005;&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x7531;DubboBeanDefinitionParser&amp;#x89E3;&amp;#x6790;&amp;#x5E76;&amp;#x751F;&amp;#x6210;&amp;#x670D;&amp;#x52A1;&amp;#x7684;BeanDefinition&amp;#xFF0C;Spring&amp;#x6839;&amp;#x636E;BeanDefinition&amp;#x751F;&amp;#x6210;&amp;#x670D;&amp;#x52A1;&amp;#x7684;ServiceBean&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2016/04/27/dubbo-provider-start-process-analysis/bean_parser.png&quot; alt=&quot;Dubbo bean definition&quot;&gt;&lt;/dubbo:service&gt;&lt;/li&gt;
&lt;li&gt;&amp;#x670D;&amp;#x52A1;&amp;#x53D1;&amp;#x5E03;-&amp;#x5165;&amp;#x53E3;&amp;#x3002;&amp;#x901A;&amp;#x8FC7;&amp;#x524D;&amp;#x9762;&amp;#x7684;&amp;#x6B65;&amp;#x9AA4;&amp;#x914D;&amp;#x7F6E;&amp;#x7684;&amp;#x670D;&amp;#x52A1;&amp;#x90FD;&amp;#x4F1A;&amp;#x751F;&amp;#x6210;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;ServiceBean&amp;#x5B9E;&amp;#x4F8B;&amp;#xFF0C;&amp;#x8BE5;&amp;#x7C7B;&amp;#x5B9E;&amp;#x73B0;&amp;#x4E86;InitializingBean&amp;#xFF0C;ApplicationListener&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x6211;&amp;#x4EEC;&amp;#x6709;2&amp;#x79CD;&amp;#x5165;&amp;#x53E3;&amp;#x53D1;&amp;#x5E03;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x670D;&amp;#x52A1;&amp;#x3002;&amp;#x4E00;&amp;#x662F;Spring&amp;#x5BB9;&amp;#x5668;&amp;#x5728;&amp;#x5B8C;&amp;#x6210;&amp;#x670D;&amp;#x52A1;&amp;#x914D;&amp;#x7F6E;&amp;#x540E;&amp;#x8C03;&amp;#x7528;afterPropertiesSet&amp;#x65B9;&amp;#x6CD5;&amp;#xFF0C;&amp;#x8BE5;&amp;#x65B9;&amp;#x6CD5;&amp;#x4F1A;&amp;#x6839;&amp;#x636E;&amp;#x662F;&amp;#x5426;&amp;#x914D;&amp;#x7F6E;&amp;#x4E86;&amp;#x670D;&amp;#x52A1;&amp;#x66B4;&amp;#x9732;Delay&amp;#x800C;&amp;#x51B3;&amp;#x5B9A;&amp;#x662F;&amp;#x5426;&amp;#x9700;&amp;#x8981;&amp;#x53D1;&amp;#x5E03;&amp;#x670D;&amp;#x52A1;&amp;#xFF08;&amp;#x4E00;&amp;#x822C;&amp;#x6211;&amp;#x4EEC;&amp;#x90FD;&amp;#x4F1A;&amp;#x8BBE;&amp;#x7F6E;delay&amp;#xFF1D;&amp;#xFF0D;1&amp;#xFF0C;&amp;#x4E5F;&amp;#x5373;&amp;#x6682;&amp;#x65F6;&amp;#x53D1;&amp;#x5E03;&amp;#x670D;&amp;#x52A1;&amp;#xFF09;&amp;#xFF1B;&amp;#x4E8C;&amp;#x662F;&amp;#x5728;Spring&amp;#x5BB9;&amp;#x5668;&amp;#x6210;&amp;#x529F;&amp;#x542F;&amp;#x52A8;&amp;#x540E;&amp;#x53D1;&amp;#x5E03;&amp;#x670D;&amp;#x52A1;&amp;#x3002;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;/2016/04/27/dubbo-provider-start-process-analysis/service_export.png&quot; alt=&quot;Dubbo bean definition&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&amp;#x670D;&amp;#x52A1;&amp;#x53D1;&amp;#x5E03;-&amp;#x83B7;&amp;#x53D6;&amp;#x670D;&amp;#x52A1;&amp;#x914D;&amp;#x7F6E;&amp;#x7684;&amp;#x6CE8;&amp;#x518C;URL&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x7B80;&amp;#x5355;&amp;#x8BF4;&amp;#x5C31;&amp;#x662F;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x670D;&amp;#x52A1;&amp;#x9700;&amp;#x8981;&amp;#x6CE8;&amp;#x518C;&amp;#x6216;&amp;#x8005;&amp;#x8F93;&amp;#x51FA;&amp;#x5230;&amp;#x54EA;&amp;#x91CC;&amp;#xFF0C;&amp;#x7531;&amp;#x8C01;&amp;#x6765;&amp;#x7BA1;&amp;#x7406;&amp;#x670D;&amp;#x52A1;&amp;#x3002;&amp;#x83B7;&amp;#x53D6;&amp;#x7684;url&amp;#x683C;&amp;#x5F0F;&amp;#x5982;&amp;#xFF1A;&lt;strong&gt;registry&lt;/strong&gt;://172.31.105.107:4180/com.alibaba.dubbo.registry.RegistryService?application=fs-open-pay_business&amp;amp;check=false&amp;amp;compiler=javassist&amp;amp;dubbo=2.5.3&amp;amp;logger=slf4j&amp;amp;organization=FSOPEN&amp;amp;owner=fs-open-pay_business&amp;amp;pid=5428&amp;amp;registry=zookeeper&amp;amp;timestamp=1461553111445&lt;/li&gt;
&lt;li&gt;&amp;#x670D;&amp;#x52A1;&amp;#x53D1;&amp;#x5E03;-&amp;#x901A;&amp;#x8FC7;&amp;#x4EE3;&amp;#x7406;&amp;#x5DE5;&amp;#x5382;&amp;#x751F;&amp;#x6210;Invoker&amp;#x670D;&amp;#x52A1;&amp;#x8C03;&amp;#x7528;&amp;#x8005;&amp;#xFF0C;&amp;#x9ED8;&amp;#x8BA4;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;javassist&amp;#x52A8;&amp;#x6001;&amp;#x751F;&amp;#x6210;Wrapper&amp;#x7C7B;&amp;#x800C;&amp;#x4E0D;&amp;#x662F;&amp;#x901A;&amp;#x8FC7;&amp;#x53CD;&amp;#x5C04;&amp;#x6765;&amp;#x8C03;&amp;#x7528;&amp;#x670D;&amp;#x52A1;&amp;#x65B9;&amp;#x6CD5;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2016/04/27/dubbo-provider-start-process-analysis/JavassistProxyFactory.png&quot; alt=&quot;JavassistProxyFactory create invoker&quot;&gt;&lt;br&gt;&amp;#x751F;&amp;#x6210;&amp;#x7684;wrapper&amp;#x7C7B;&amp;#x4EE3;&amp;#x7801;&amp;#x5185;&amp;#x5BB9;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Wrapper0&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Wrapper&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;DC&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; String[] pns;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; Map pts;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; String[] mns;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; String[] dmns;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; Class[] mts0;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; Class[] mts1;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; Class[] mts2;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String[] getPropertyNames() {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; pns;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;hasProperty&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String var1)&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; pts.containsKey(var1);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Class &lt;span class=&quot;title&quot;&gt;getPropertyType&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String var1)&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (Class)pts.get(var1);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String[] getMethodNames() {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; mns;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String[] getDeclaredMethodNames() {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; dmns;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setPropertyValue&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Object var1, String var2, Object var3)&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            AlarmLogService var4 = (AlarmLogService)var1;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        } &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Throwable var6) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(var6);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; NoSuchPropertyException(&lt;span class=&quot;string&quot;&gt;&amp;quot;Not found property \&amp;quot;&amp;quot;&lt;/span&gt; + var2 + &lt;span class=&quot;string&quot;&gt;&amp;quot;\&amp;quot; filed or setter method in class com.facishare.pay.notice.service.AlarmLogService.&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Object &lt;span class=&quot;title&quot;&gt;getPropertyValue&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Object var1, String var2)&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            AlarmLogService var3 = (AlarmLogService)var1;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        } &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Throwable var5) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(var5);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; NoSuchPropertyException(&lt;span class=&quot;string&quot;&gt;&amp;quot;Not found property \&amp;quot;&amp;quot;&lt;/span&gt; + var2 + &lt;span class=&quot;string&quot;&gt;&amp;quot;\&amp;quot; filed or setter method in class com.facishare.pay.notice.service.AlarmLogService.&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Object &lt;span class=&quot;title&quot;&gt;invokeMethod&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Object var1, String var2, Class[] var3, Object[] var4)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; InvocationTargetException &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        AlarmLogService var5;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            var5 = (AlarmLogService)var1;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        } &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Throwable var8) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(var8);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;notifyError&amp;quot;&lt;/span&gt;.equals(var2) &amp;amp;&amp;amp; var3.length == &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; var5.notifyError((String)var4[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;], (LevelType)var4[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;], (TransTypeEnum)var4[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;], (String)var4[&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;], (String)var4[&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;], (Calendar)var4[&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;queryAlarmLog&amp;quot;&lt;/span&gt;.equals(var2) &amp;amp;&amp;amp; var3.length == &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; var5.queryAlarmLog((Pager)var4[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;], (AlarmLogVO)var4[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;updateAlarmLogStatus&amp;quot;&lt;/span&gt;.equals(var2) &amp;amp;&amp;amp; var3.length == &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; var5.updateAlarmLogStatus((Long)var4[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;], (AlarmStatus)var4[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        } &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Throwable var9) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; InvocationTargetException(var9);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; NoSuchMethodException(&lt;span class=&quot;string&quot;&gt;&amp;quot;Not found method \&amp;quot;&amp;quot;&lt;/span&gt; + var2 + &lt;span class=&quot;string&quot;&gt;&amp;quot;\&amp;quot; in class com.facishare.pay.notice.service.AlarmLogService.&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Wrapper0&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;&amp;#x670D;&amp;#x52A1;&amp;#x53D1;&amp;#x5E03;-RegistryProtocol&amp;#x8F93;&amp;#x51FA;Invoker&amp;#xFF0C;RegistryProtocol&amp;#x8C03;&amp;#x7528;&amp;#x7531;javasist&amp;#x751F;&amp;#x6210;&amp;#x7684;ProtocolAdaptiveProtocol.export(Invoker invoker)&amp;#x65B9;&amp;#x6CD5;&amp;#xFF0C;&amp;#x8BE5;&amp;#x65B9;&amp;#x6CD5;&amp;#x6839;&amp;#x636E;invoker&amp;#x4E2D;&amp;#x7684;URL&amp;#x7684;protocol&amp;#x534F;&amp;#x8BAE;&amp;#x503C;&amp;#x83B7;&amp;#x53D6;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x7C7B;(&amp;#x9ED8;&amp;#x8BA4;&amp;#x662F;dubbo&amp;#xFF0C;&amp;#x5BF9;&amp;#x5E94;&amp;#x5B9E;&amp;#x73B0;&amp;#x7C7B;&amp;#x662F;DubboProtocol&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x53EF;&amp;#x901A;&amp;#x8FC7;&lt;dubbo.protocol&gt;&amp;#x7684;name&amp;#x5C5E;&amp;#x6027;&amp;#x914D;&amp;#x7F6E;&amp;#x5176;&amp;#x4ED6;&amp;#x5B9E;&amp;#x73B0;&amp;#x7C7B;)&amp;#x8F93;&amp;#x51FA;Invoker&amp;#x3002;&lt;/dubbo.protocol&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;serviceKey&amp;#x7EC4;&amp;#x6210;&amp;#x89C4;&amp;#x5219;&amp;#xFF1A;serviceGroup/serviceName: version:port&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &amp;lt;T&amp;gt; &lt;span class=&quot;function&quot;&gt;Exporter&amp;lt;T&amp;gt; &lt;span class=&quot;title&quot;&gt;export&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Invoker&amp;lt;T&amp;gt; invoker)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; RpcException &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        URL url = invoker.getUrl();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// export service.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        String key = serviceKey(url);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        DubboExporter&amp;lt;T&amp;gt; exporter = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DubboExporter&amp;lt;T&amp;gt;(invoker, key, exporterMap);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        exporterMap.put(key, exporter);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//export an stub service for dispaching event&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Boolean isStubSupportEvent = url.getParameter(Constants.STUB_EVENT_KEY,Constants.DEFAULT_STUB_EVENT);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Boolean isCallbackservice = url.getParameter(Constants.IS_CALLBACK_SERVICE, &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (isStubSupportEvent &amp;amp;&amp;amp; !isCallbackservice){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            String stubServiceMethods = url.getParameter(Constants.STUB_EVENT_METHODS_KEY);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (stubServiceMethods == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; || stubServiceMethods.length() == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; ){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (logger.isWarnEnabled()){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    logger.warn(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; IllegalStateException(&lt;span class=&quot;string&quot;&gt;&amp;quot;consumer [&amp;quot;&lt;/span&gt; +url.getParameter(Constants.INTERFACE_KEY) +&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            &lt;span class=&quot;string&quot;&gt;&amp;quot;], has set stubproxy support event ,but no stub methods founded.&amp;quot;&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            } &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                stubServiceMethodsMap.put(url.getServiceKey(), stubServiceMethods);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        openServer(url);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; exporter;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&amp;#x65B0;&amp;#x5EFA;&amp;#x5E76;&amp;#x6839;&amp;#x636E;&amp;#x670D;&amp;#x52A1;&amp;#x5730;&amp;#x5740;&amp;#x4E0E;&amp;#x7AEF;&amp;#x53E3;&amp;#x7F13;&amp;#x5B58;&amp;#x670D;&amp;#x52A1;&amp;#x7AEF;&amp;#xFF0C;&amp;#x5DF2;&amp;#x5373;&amp;#x5BF9;&amp;#x5E94;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;SocketServer&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;openServer&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(URL url)&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// find server.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        String key = url.getAddress();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//client &amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x66B4;&amp;#x9732;&amp;#x4E00;&amp;#x4E2A;&amp;#x53EA;&amp;#x6709;server&amp;#x53EF;&amp;#x4EE5;&amp;#x8C03;&amp;#x7528;&amp;#x7684;&amp;#x670D;&amp;#x52A1;&amp;#x3002;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; isServer = url.getParameter(Constants.IS_SERVER_KEY,&lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (isServer) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        	ExchangeServer server = serverMap.get(key);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        	&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (server == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        		serverMap.put(key, createServer(url));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        	} &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        		&lt;span class=&quot;comment&quot;&gt;//server&amp;#x652F;&amp;#x6301;reset,&amp;#x914D;&amp;#x5408;override&amp;#x529F;&amp;#x80FD;&amp;#x4F7F;&amp;#x7528;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        		server.reset(url);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        	}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x521B;&amp;#x5EFA;&amp;#x670D;&amp;#x52A1;&amp;#x7AEF;&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; ExchangeServer &lt;span class=&quot;title&quot;&gt;createServer&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(URL url)&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//&amp;#x9ED8;&amp;#x8BA4;&amp;#x5F00;&amp;#x542F;server&amp;#x5173;&amp;#x95ED;&amp;#x65F6;&amp;#x53D1;&amp;#x9001;readonly&amp;#x4E8B;&amp;#x4EF6;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        url = url.addParameterIfAbsent(Constants.CHANNEL_READONLYEVENT_SENT_KEY, Boolean.TRUE.toString());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//&amp;#x9ED8;&amp;#x8BA4;&amp;#x5F00;&amp;#x542F;heartbeat&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        url = url.addParameterIfAbsent(Constants.HEARTBEAT_KEY, String.valueOf(Constants.DEFAULT_HEARTBEAT));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        String str = url.getParameter(Constants.SERVER_KEY, Constants.DEFAULT_REMOTING_SERVER);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (str != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; str.length() &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &amp;amp;&amp;amp; ! ExtensionLoader.getExtensionLoader(Transporter.class).hasExtension(str))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; RpcException(&lt;span class=&quot;string&quot;&gt;&amp;quot;Unsupported server type: &amp;quot;&lt;/span&gt; + str + &lt;span class=&quot;string&quot;&gt;&amp;quot;, url: &amp;quot;&lt;/span&gt; + url);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        url = url.addParameter(Constants.CODEC_KEY, Version.isCompatibleVersion() ? COMPATIBLE_CODEC_NAME : DubboCodec.NAME);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ExchangeServer server;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            server = Exchangers.bind(url, requestHandler);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        } &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (RemotingException e) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; RpcException(&lt;span class=&quot;string&quot;&gt;&amp;quot;Fail to start server(url: &amp;quot;&lt;/span&gt; + url + &lt;span class=&quot;string&quot;&gt;&amp;quot;) &amp;quot;&lt;/span&gt; + e.getMessage(), e);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        str = url.getParameter(Constants.CLIENT_KEY);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (str != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; str.length() &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Set&amp;lt;String&amp;gt; supportedTypes = ExtensionLoader.getExtensionLoader(Transporter.class).getSupportedExtensions();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!supportedTypes.contains(str)) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; RpcException(&lt;span class=&quot;string&quot;&gt;&amp;quot;Unsupported client type: &amp;quot;&lt;/span&gt; + str);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; server;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x521B;&amp;#x5EFA;HeaderExchangeServer&amp;#xFF0C;&amp;#x5E76;&amp;#x521B;&amp;#x5EFA;Timer&amp;#x5B9A;&amp;#x65F6;&amp;#x53D1;&amp;#x9001;&amp;#x5FC3;&amp;#x8DF3;&amp;#x6D88;&amp;#x606F;&amp;#x7ED9;&amp;#x5DF2;&amp;#x8FDE;&amp;#x63A5;&amp;#x7684;&amp;#x901A;&amp;#x9053;&amp;#x4E5F;&amp;#x5373;&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;HeaderExchanger&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Exchanger&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; String NAME = &lt;span class=&quot;string&quot;&gt;&amp;quot;header&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; ExchangeServer &lt;span class=&quot;title&quot;&gt;bind&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(URL url, ExchangeHandler handler)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; RemotingException &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; HeaderExchangeServer(Transporters.bind(url, &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DecodeHandler(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; HeaderExchangeHandler(handler))));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x9ED8;&amp;#x8BA4;&amp;#x901A;&amp;#x8FC7;NettyTransporter&amp;#x521B;&amp;#x5EFA;NettyServer&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Transporters&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; Server &lt;span class=&quot;title&quot;&gt;bind&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(URL url, ChannelHandler... handlers)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; RemotingException &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (url == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;string&quot;&gt;&amp;quot;url == null&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (handlers == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; || handlers.length == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;string&quot;&gt;&amp;quot;handlers == null&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ChannelHandler handler;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (handlers.length == &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            handler = handlers[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        } &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            handler = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ChannelHandlerDispatcher(handlers);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; getTransporter().bind(url, handler);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;// &amp;#x901A;&amp;#x8FC7;&amp;#x6269;&amp;#x5C55;&amp;#x6A21;&amp;#x5757;&amp;#x83B7;&amp;#x53D6;Transport&amp;#x9002;&amp;#x914D;&amp;#x5668;&amp;#xFF0C;&amp;#x5E76;&amp;#x6839;&amp;#x636E;&amp;#x65B9;&amp;#x6CD5;&amp;#x4F20;&amp;#x5165;&amp;#x7684;URL&amp;#x7684;transporter&amp;#x53C2;&amp;#x6570;&amp;#x83B7;&amp;#x53D6;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;Transporter&amp;#x5B9E;&amp;#x73B0;&amp;#x7C7B;&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x8FC7;&amp;#x7A0B;&amp;#x53C2;&amp;#x8003;Dubbo&amp;#x6269;&amp;#x5C55;&amp;#x6A21;&amp;#x5757;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; Transporter &lt;span class=&quot;title&quot;&gt;getTransporter&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; ExtensionLoader.getExtensionLoader(Transporter.class).getAdaptiveExtension();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x521B;&amp;#x5EFA;NettyServer&amp;#xFF0C;&amp;#x521B;&amp;#x5EFA;&amp;#x76D1;&amp;#x542C;&amp;#xFF0C;&amp;#x7ED1;&amp;#x5B9A;&amp;#x7AEF;&amp;#x53E3;&lt;br&gt;&lt;img src=&quot;/2016/04/27/dubbo-provider-start-process-analysis/netty_server.png&quot; alt=&quot;netty_server&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&amp;#x670D;&amp;#x52A1;&amp;#x53D1;&amp;#x5E03;-RegistryProtocol&amp;#x6CE8;&amp;#x518C;&amp;#x670D;&amp;#x52A1;&amp;#xFF0C;&amp;#x540C;&amp;#x6837;&amp;#x662F;&amp;#x8C03;&amp;#x7528;RegistryFactory&amp;#x7684;Adaptive&amp;#x7C7B;&amp;#x7684;getRegistry&amp;#x65B9;&amp;#x6CD5;&amp;#xFF0C;&amp;#x8BE5;&amp;#x65B9;&amp;#x6CD5;&amp;#x83B7;&amp;#x53D6;URL&amp;#x7684;registry&amp;#x53C2;&amp;#x6570;&amp;#x503C;&amp;#xFF0C;&amp;#x5E76;&amp;#x901A;&amp;#x8FC7;&amp;#x8BE5;&amp;#x503C;&amp;#x83B7;&amp;#x53D6;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x7C7B;&amp;#xFF0C;&amp;#x8C03;&amp;#x7528;&amp;#x5B9E;&amp;#x73B0;&amp;#x7C7B;&amp;#x7684;register&amp;#x65B9;&amp;#x6CD5;&amp;#x3002;&amp;#x4F8B;&amp;#x5B50;&amp;#x4E2D;&amp;#x7ED9;&amp;#x7684;&amp;#x662F;zookeeper&amp;#xFF0C;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x6CE8;&amp;#x518C;&amp;#x5668;&amp;#x5B9E;&amp;#x73B0;&amp;#x7C7B;&amp;#x662F;ZookeeperRegistry&amp;#xFF0C;ZookeeperRegistry&amp;#x7EE7;&amp;#x627F;&amp;#x4E0E;FailbackRegistry&amp;#xFF0C;&amp;#x4EE5;&amp;#x4E0B;&amp;#x662F;&amp;#x8BE5;&amp;#x65B9;&amp;#x6CD5;&amp;#x7684;&amp;#x6267;&amp;#x884C;&amp;#x8FC7;&amp;#x7A0B;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&amp;#x8C03;&amp;#x7528;zookeeper&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&amp;#x521B;&amp;#x5EFA;&amp;#x670D;&amp;#x52A1;Node&amp;#xFF0C;&amp;#x6587;&amp;#x4EF6;&amp;#x8DEF;&amp;#x5F84;&amp;#x7EC4;&amp;#x6210;&amp;#x5F62;&amp;#x5F0F;&amp;#xFF1A; /group/seviceInterfacePath/providers/urlFullPath&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;doRegister&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(URL url)&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       	zkClient.create(toUrlPath(url), url.getParameter(Constants.DYNAMIC_KEY, &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       } &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Throwable e) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; RpcException(&lt;span class=&quot;string&quot;&gt;&amp;quot;Failed to register &amp;quot;&lt;/span&gt; + url + &lt;span class=&quot;string&quot;&gt;&amp;quot; to zookeeper &amp;quot;&lt;/span&gt; + getUrl() + &lt;span class=&quot;string&quot;&gt;&amp;quot;, cause: &amp;quot;&lt;/span&gt; + e.getMessage(), e);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   }&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&amp;#x670D;&amp;#x52A1;&amp;#x53D1;&amp;#x5E03;-ProtocolFilterWrapper&lt;br&gt;Dubbo ExtentionLoader&amp;#xFF0C;&amp;#x63D0;&amp;#x4F9B;&amp;#x4E86;Extension Wrapper&amp;#x529F;&amp;#x80FD;&amp;#xFF0C;&amp;#x901A;&amp;#x4FD7;&amp;#x6765;&amp;#x8BF4;Dubbo&amp;#x5148;&amp;#x521B;&amp;#x5EFA;Extension&amp;#x7C7B;&amp;#xFF0C;&amp;#x521B;&amp;#x5EFA;&amp;#x5176;Wrapper&amp;#x7C7B;&amp;#x5E76;&amp;#x6CE8;&amp;#x5165;&amp;#x88AB;&amp;#x5305;&amp;#x88C5;&amp;#x7684;&amp;#x7C7B;&amp;#xFF08;&amp;#x5982;&amp;#x679C;&amp;#x5176;&amp;#x6709;Wrapper&amp;#x7C7B;&amp;#xFF0C;&amp;#x5982;&amp;#x6709;&amp;#x591A;&amp;#x4E2A;Wrapper&amp;#x7C7B;&amp;#xFF0C;&amp;#x4F1A;&amp;#x4F9D;&amp;#x6B21;&amp;#x521B;&amp;#x5EFA;&amp;#xFF0C;&amp;#x8FD4;&amp;#x56DE;&amp;#x7684;&amp;#x662F;&amp;#x6700;&amp;#x540E;&amp;#x521B;&amp;#x5EFA;&amp;#x7684;Wrapper&amp;#x7C7B;&amp;#xFF09;&amp;#xFF1B;ProtocolFilterWrapper&amp;#x5C31;&amp;#x662F;Protocol&amp;#x7684;&amp;#x4E00;&amp;#x4E2A;Wrapper&amp;#x7C7B;&amp;#xFF0C;&amp;#x8BE5;&amp;#x7C7B;&amp;#x662F;&amp;#x7ED9;&amp;#x670D;&amp;#x52A1;&amp;#x8C03;&amp;#x7528;&amp;#x6DFB;&amp;#x52A0;Filter&amp;#x529F;&amp;#x80FD;&amp;#xFF0C;AccessLogFilter(&amp;#x670D;&amp;#x52A1;&amp;#x8BF7;&amp;#x6C42;&amp;#x4FE1;&amp;#x606F;&amp;#x6253;&amp;#x5370;)&amp;#x3001;ActiveLimitFilter(&amp;#x670D;&amp;#x52A1;&amp;#x5F53;&amp;#x524D;&amp;#x6D3B;&amp;#x52A8;&amp;#x6570;&amp;#x9650;&amp;#x5236;Filter)&amp;#x7B49;&amp;#x7B49;&amp;#xFF0C;&amp;#x5177;&amp;#x4F53;&amp;#x53C2;&amp;#x8003;&amp;#x6A21;&amp;#x5757;&amp;#x5206;&amp;#x6790;&amp;#x3002;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&amp;#x670D;&amp;#x52A1;&amp;#x53D1;&amp;#x5E03;-ProtocolListenerWrapper&lt;br&gt;ProtocolListenerWrapper&amp;#x662F;Protocol&amp;#x7684;Wrapper&amp;#x7C7B;&amp;#xFF0C;&amp;#x7ED9;&amp;#x670D;&amp;#x52A1;&amp;#x7684;&amp;#x6CE8;&amp;#x518C;&amp;#x4E8E;&amp;#x5378;&amp;#x8F7D;&amp;#x6DFB;&amp;#x52A0;&amp;#x76D1;&amp;#x542C;&amp;#x3002;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ExporterListener&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * The exporter exported.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@see&lt;/span&gt; com.alibaba.dubbo.rpc.Protocol#export(Invoker)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; exporter&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@throws&lt;/span&gt; RpcException&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;exported&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Exporter&amp;lt;?&amp;gt; exporter)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; RpcException&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * The exporter unexported.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@see&lt;/span&gt; com.alibaba.dubbo.rpc.Exporter#unexport()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; exporter&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@throws&lt;/span&gt; RpcException&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;unexported&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Exporter&amp;lt;?&amp;gt; exporter)&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;Dubbo&amp;#x6D88;&amp;#x8D39;&amp;#x8005;&amp;#x542F;&amp;#x52A8;&amp;#x8FC7;&amp;#x7A0B;&quot;&gt;&lt;a href=&quot;#Dubbo&amp;#x6D88;&amp;#x8D39;&amp;#x8005;&amp;#x542F;&amp;#x52A8;&amp;#x8FC7;&amp;#x7A0B;&quot; class=&quot;headerlink&quot; title=&quot;Dubbo&amp;#x6D88;&amp;#x8D39;&amp;#x8005;&amp;#x542F;&amp;#x52A8;&amp;#x8FC7;&amp;#x7A0B;&quot;&gt;&lt;/a&gt;Dubbo&amp;#x6D88;&amp;#x8D39;&amp;#x8005;&amp;#x542F;&amp;#x52A8;&amp;#x8FC7;&amp;#x7A0B;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&amp;#x914D;&amp;#x7F6E;&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;Registry&amp;#x4FE1;&amp;#x606F;&lt;/li&gt;
&lt;li&gt;&amp;#x914D;&amp;#x7F6E;Consumer&amp;#x4FE1;&amp;#x606F;&lt;/li&gt;
&lt;li&gt;&amp;#x914D;&amp;#x7F6E;Application&amp;#x4FE1;&amp;#x606F;&lt;/li&gt;
&lt;li&gt;&amp;#x914D;&amp;#x7F6E;Module&amp;#x4FE1;&amp;#x606F;&lt;/li&gt;
&lt;li&gt;&amp;#x914D;&amp;#x7F6E;Monitor&amp;#x4FE1;&amp;#x606F;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Dubbo&amp;#x6D88;&amp;#x8D39;&amp;#x8005;Bean&amp;#x5BF9;&amp;#x5E94;&amp;#x4E8E;ReferenceBean&amp;#xFF0C;&amp;#x8BE5;&amp;#x7C7B;&amp;#x5B9E;&amp;#x73B0;&amp;#x4E86;Spring&amp;#x7684;FactoryBean&amp;#xFF0C;&amp;#x5728;&amp;#x83B7;&amp;#x53D6;&amp;#x8BE5;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x5E94;&amp;#x7528;&amp;#x65F6;&amp;#x4F1A;&amp;#x8C03;&amp;#x7528;&amp;#x7684;getObject&amp;#x65B9;&amp;#x6CD5;&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;synchronized&lt;/span&gt; T &lt;span class=&quot;title&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (destroyed){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; IllegalStateException(&lt;span class=&quot;string&quot;&gt;&amp;quot;Already destroyed!&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    	&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (ref == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    		init();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    	}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; ref;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&amp;#x8C03;&amp;#x7528;&amp;#x521D;&amp;#x59CB;&amp;#x65B9;&amp;#x6CD5;&amp;#x521B;&amp;#x5EFA;&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&amp;#x4EE3;&amp;#x7406;&amp;#xFF0C;&amp;#x5F15;&amp;#x7528;&amp;#x8FDC;&amp;#x7A0B;&amp;#x670D;&amp;#x52A1;&amp;#x3002;URL&amp;#x683C;&amp;#x5F0F;&amp;#x5982;&amp;#xFF1A;&lt;br&gt;&lt;strong&gt;registry&lt;/strong&gt;://172.31.105.107:4180/com.alibaba.dubbo.registry.RegistryService?application=fs-open-pay_business&amp;amp;check=false&amp;amp;compiler=javassist&amp;amp;dubbo=2.5.3&amp;amp;logger=slf4j&amp;amp;organization=FSOPEN&amp;amp;owner=fs-open-pay_business&amp;amp;pid=14936&amp;amp;refer=application%3Dfs-open-pay_business%26check%3Dfalse%26compiler%3Djavassist%26default.check%3Dfalse%26default.init%3Dfalse%26default.retries%3D0%26default.timeout%3D3000%26dubbo%3D2.5.3%26init%3Dtrue%26interface%3D&lt;br&gt;&lt;strong&gt;com.facishare.pay.order.service.OrderService&lt;/strong&gt;%26logger%3Dslf4j%26methods%3DqueryOrder%2CgetOrderByOrderNo%2CaddOrder%2CupdateOrder%2CupdateOrderStatus%26organization%3DFSOPEN%26owner%3Dfs-open-pay_business%26pid%3D14936%26revision%3D0.0.2-SNAPSHOT%26side%3Dconsumer%26timeout%3D3000%26timestamp%3D1461650714943%26version%3D1.0&amp;amp;registry=zookeeper&amp;amp;timestamp=1461650715005&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;com.alibaba.dubbo.registry.integration.RegistryProtocol&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &amp;lt;T&amp;gt; &lt;span class=&quot;function&quot;&gt;Invoker&amp;lt;T&amp;gt; &lt;span class=&quot;title&quot;&gt;refer&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Class&amp;lt;T&amp;gt; type, URL url)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; RpcException &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        url = url.setProtocol(url.getParameter(Constants.REGISTRY_KEY, Constants.DEFAULT_REGISTRY)).removeParameter(Constants.REGISTRY_KEY);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Registry registry = registryFactory.getRegistry(url);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (RegistryService.class.equals(type)) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; proxyFactory.getInvoker((T) registry, type, url);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// group=&amp;quot;a,b&amp;quot; or group=&amp;quot;*&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Map&amp;lt;String, String&amp;gt; qs = StringUtils.parseQueryString(url.getParameterAndDecoded(Constants.REFER_KEY));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        String group = qs.get(Constants.GROUP_KEY);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (group != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; group.length() &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; ) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ( ( Constants.COMMA_SPLIT_PATTERN.split( group ) ).length &amp;gt; &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    || &lt;span class=&quot;string&quot;&gt;&amp;quot;*&amp;quot;&lt;/span&gt;.equals( group ) ) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; doRefer( getMergeableCluster(), registry, type, url );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; doRefer(cluster, registry, type, url);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&amp;#x6CE8;&amp;#x518C;consumer&amp;#x5230;zookeeper&amp;#xFF0C;&amp;#x521B;&amp;#x5EFA;&amp;#x7684;&amp;#x76EE;&amp;#x5F55;&amp;#x683C;&amp;#x5F0F;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;br&gt;&lt;strong&gt;/dubbo/com.facishare.pay.order.service.OrderService/consumers/consumer&lt;/strong&gt;%3A%2F%2F10.22.0.78%2Fcom.facishare.pay.order.service.OrderService%3Fapplication%3Dfs-open-pay_business%26category%3Dconsumers%26check%3Dfalse%26compiler%3Djavassist%26default.check%3Dfalse%26default.init%3Dfalse%26default.retries%3D0%26default.timeout%3D3000%26dubbo%3D2.5.3%26init%3Dtrue%26interface%3Dcom.facishare.pay.order.service.OrderService%26logger%3Dslf4j%26methods%3DqueryOrder%2CgetOrderByOrderNo%2CaddOrder%2CupdateOrder%2CupdateOrderStatus%26organization%3DFSOPEN%26owner%3Dfs-open-pay_business%26pid%3D14936%26revision%3D0.0.2-SNAPSHOT%26side%3Dconsumer%26timeout%3D3000%26timestamp%3D1461650714943%26version%3D1.0&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&amp;#x5E76;&amp;#x8BA2;&amp;#x9605;&amp;#x7B26;&amp;#x5408;&amp;#x6761;&amp;#x4EF6;&amp;#x7684;&amp;#x5DF2;&amp;#x6CE8;&amp;#x518C;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x5F53;&amp;#x6709;&amp;#x6CE8;&amp;#x518C;&amp;#x6570;&amp;#x636E;&amp;#x53D8;&amp;#x66F4;&amp;#x65F6;&amp;#x81EA;&amp;#x52A8;&amp;#x63A8;&amp;#x9001;&lt;br&gt;URL&amp;#x4E2D;&amp;#x6DFB;&amp;#x52A0;&amp;#x53C2;&amp;#x6570;&amp;#xFF0C;category=providers,configurators,routers&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &amp;lt;T&amp;gt; &lt;span class=&quot;function&quot;&gt;Invoker&amp;lt;T&amp;gt; &lt;span class=&quot;title&quot;&gt;doRefer&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Cluster cluster, Registry registry, Class&amp;lt;T&amp;gt; type, URL url)&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        RegistryDirectory&amp;lt;T&amp;gt; directory = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; RegistryDirectory&amp;lt;T&amp;gt;(type, url);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        directory.setRegistry(registry);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        directory.setProtocol(protocol);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        URL subscribeUrl = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; URL(Constants.CONSUMER_PROTOCOL, NetUtils.getLocalHost(), &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, type.getName(), directory.getUrl().getParameters());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (! Constants.ANY_VALUE.equals(url.getServiceInterface())&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;amp;&amp;amp; url.getParameter(Constants.REGISTER_KEY, &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;)) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;comment&quot;&gt;// &amp;#x6CE8;&amp;#x518C;consumer&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            registry.register(subscribeUrl.addParameters(Constants.CATEGORY_KEY, Constants.CONSUMERS_CATEGORY,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    Constants.CHECK_KEY, String.valueOf(&lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;)));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;comment&quot;&gt;// &amp;#x8BA2;&amp;#x9605;&amp;#x5DF2;&amp;#x6CE8;&amp;#x518C;&amp;#x6570;&amp;#x636E;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        directory.subscribe(subscribeUrl.addParameter(Constants.CATEGORY_KEY, &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Constants.PROVIDERS_CATEGORY &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                + &lt;span class=&quot;string&quot;&gt;&amp;quot;,&amp;quot;&lt;/span&gt; + Constants.CONFIGURATORS_CATEGORY &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                + &lt;span class=&quot;string&quot;&gt;&amp;quot;,&amp;quot;&lt;/span&gt; + Constants.ROUTERS_CATEGORY));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; cluster.join(directory);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&amp;#x8C03;&amp;#x7528;ZookeeperRegistry.doSubscribe&amp;#x65B9;&amp;#x6CD5;&amp;#x521B;&amp;#x5EFA;&amp;#x5982;&amp;#x4E0B;&amp;#x76EE;&amp;#x5F55;&amp;#x5E76;&amp;#x6DFB;&amp;#x52A0;&amp;#x76EE;&amp;#x5F55;&amp;#x53D8;&amp;#x5316;&amp;#x76D1;&amp;#x542C;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x76EE;&amp;#x5F55;&amp;#x6709;&amp;#x53D8;&amp;#x5316;&amp;#x5219;&amp;#x56DE;&amp;#x8C03;ZookeeperRegistry.this.notify&amp;#x65B9;&amp;#x6CD5;&lt;br&gt;/dubbo/com.facishare.pay.order.service.OrderService/&lt;strong&gt;providers&lt;/strong&gt;&lt;br&gt;/dubbo/com.facishare.pay.order.service.OrderService/&lt;strong&gt;configurators&lt;/strong&gt;&lt;br&gt;/dubbo/com.facishare.pay.order.service.OrderService/&lt;strong&gt;routers&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;/2016/04/27/dubbo-provider-start-process-analysis/dubbo_servcie_zk_directory.png&quot; alt=&quot;dubbo_servcie_zk_directory&quot;&gt;&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;doSubscribe&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; URL url, &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; NotifyListener listener)&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            } &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                List&amp;lt;URL&amp;gt; urls = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;URL&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (String path : toCategoriesPath(url)) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    ConcurrentMap&amp;lt;NotifyListener, ChildListener&amp;gt; listeners = zkListeners.get(url);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (listeners == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        zkListeners.putIfAbsent(url, &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ConcurrentHashMap&amp;lt;NotifyListener, ChildListener&amp;gt;());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        listeners = zkListeners.get(url);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    ChildListener zkListener = listeners.get(listener);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (zkListener == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        listeners.putIfAbsent(listener, &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ChildListener() {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;childChanged&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String parentPath, List&amp;lt;String&amp;gt; currentChilds)&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            	ZookeeperRegistry.&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.notify(url, listener, toUrlsWithEmpty(url, parentPath, currentChilds));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        });&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        zkListener = listeners.get(listener);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    zkClient.create(path, &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    List&amp;lt;String&amp;gt; children = zkClient.addChildListener(path, zkListener);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (children != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    	urls.addAll(toUrlsWithEmpty(url, path, children));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                notify(url, listener, urls);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        } &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Throwable e) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; RpcException(&lt;span class=&quot;string&quot;&gt;&amp;quot;Failed to subscribe &amp;quot;&lt;/span&gt; + url + &lt;span class=&quot;string&quot;&gt;&amp;quot; to zookeeper &amp;quot;&lt;/span&gt; + getUrl() + &lt;span class=&quot;string&quot;&gt;&amp;quot;, cause: &amp;quot;&lt;/span&gt; + e.getMessage(), e);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x83B7;&amp;#x53D6;&amp;#x5BF9;&amp;#x5E94;&amp;#x76EE;&amp;#x5F55;&amp;#x4E0B;URl&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;List&amp;lt;String&amp;gt; children = zkClient.addChildListener(path, zkListener);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (children != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    	urls.addAll(toUrlsWithEmpty(url, path, children));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    }&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&amp;#x5F53;&amp;#x76D1;&amp;#x542C;&amp;#x5230;&amp;#x5DF2;&amp;#x4E0A;&amp;#x8282;&amp;#x70B9;&amp;#x6709;&amp;#x53D8;&amp;#x5316;&amp;#x65F6;&amp;#x8C03;&amp;#x7528;com.alibaba.dubbo.registry.integration.RegistryDirectory.notify&amp;#x66F4;&amp;#x65B0;&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;Invoker&amp;#x4FE1;&amp;#x606F;&amp;#x4E5F;&amp;#x5373;&amp;#x670D;&amp;#x52A1;&amp;#x5E94;&amp;#x7528;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;synchronized&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;notify&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(List&amp;lt;URL&amp;gt; urls)&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        List&amp;lt;URL&amp;gt; invokerUrls = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;URL&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        List&amp;lt;URL&amp;gt; routerUrls = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;URL&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        List&amp;lt;URL&amp;gt; configuratorUrls = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;URL&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (URL url : urls) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            String protocol = url.getProtocol();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            String category = url.getParameter(Constants.CATEGORY_KEY, Constants.DEFAULT_CATEGORY);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (Constants.ROUTERS_CATEGORY.equals(category) &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    || Constants.ROUTE_PROTOCOL.equals(protocol)) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                routerUrls.add(url);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            } &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (Constants.CONFIGURATORS_CATEGORY.equals(category) &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    || Constants.OVERRIDE_PROTOCOL.equals(protocol)) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                configuratorUrls.add(url);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            } &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (Constants.PROVIDERS_CATEGORY.equals(category)) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                invokerUrls.add(url);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            } &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                logger.warn(&lt;span class=&quot;string&quot;&gt;&amp;quot;Unsupported category &amp;quot;&lt;/span&gt; + category + &lt;span class=&quot;string&quot;&gt;&amp;quot; in notified url: &amp;quot;&lt;/span&gt; + url + &lt;span class=&quot;string&quot;&gt;&amp;quot; from registry &amp;quot;&lt;/span&gt; + getUrl().getAddress() + &lt;span class=&quot;string&quot;&gt;&amp;quot; to consumer &amp;quot;&lt;/span&gt; + NetUtils.getLocalHost());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// configurators &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (configuratorUrls != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; configuratorUrls.size() &amp;gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; ){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.configurators = toConfigurators(configuratorUrls);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// routers&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (routerUrls != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; routerUrls.size() &amp;gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; ){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            List&amp;lt;Router&amp;gt; routers = toRouters(routerUrls);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(routers != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;){ &lt;span class=&quot;comment&quot;&gt;// null - do nothing&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                setRouters(routers);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        List&amp;lt;Configurator&amp;gt; localConfigurators = &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.configurators; &lt;span class=&quot;comment&quot;&gt;// local reference&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// &amp;#x5408;&amp;#x5E76;override&amp;#x53C2;&amp;#x6570;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.overrideDirectoryUrl = directoryUrl;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (localConfigurators != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; localConfigurators.size() &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (Configurator configurator : localConfigurators) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.overrideDirectoryUrl = configurator.configure(overrideDirectoryUrl);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// providers&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        refreshInvoker(invokerUrls);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&amp;#x6839;&amp;#x636E;&amp;#x670D;&amp;#x52A1;&amp;#x63D0;&amp;#x4F9B;&amp;#x8005;&amp;#x6700;&amp;#x65B0;&amp;#x5730;&amp;#x5740;&amp;#x5217;&amp;#x8868;&amp;#xFF0C;&amp;#x66F4;&amp;#x65B0;&amp;#x672C;&amp;#x5730;&amp;#x5E94;&amp;#x7528;&amp;#x7684;&amp;#x76EE;&amp;#x5F55;&amp;#x670D;&amp;#x52A1;&amp;#x5217;&amp;#x8868;&lt;br&gt;urls&amp;#x5982;&amp;#xFF1A;&lt;br&gt;&lt;strong&gt;dubbo&lt;/strong&gt;%3A%2F%2F172.31.105.110%3A29201%2Fcom.facishare.open.msg.service.SendMessageService%3Fanyhost%3Dtrue%26application%3Dfs-open-msg%26compiler%3Djavassist%26default.cluster%3Dfailover%26default.delay%3D-1%26default.loadbalance%3Dleastactive%26default.proxy%3Djavassist%26default.retries%3D2%26default.serialization%3Dhessian2%26default.timeout%3D3000%26delay%3D-1%26dubbo%3D2.5.3%26interface%3Dcom.facishare.open.msg.service.SendMessageService%26logger%3Dslf4j%26methods%3DsendTextMessage%2CsendTemplateMessage%2CsendOfficeMessage%26organization%3DFSOPEN%26owner%3Dfs-open-msg%26pid%3D11197%26retries%3D2%26revision%3D0.0.5-SNAPSHOT%26side%3Dprovider%26timestamp%3D1461745941653%26version%3D1.0&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Map&amp;lt;String, Invoker&amp;lt;T&amp;gt;&amp;gt; toInvokers(List&amp;lt;URL&amp;gt; urls) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Map&amp;lt;String, Invoker&amp;lt;T&amp;gt;&amp;gt; newUrlInvokerMap = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;String, Invoker&amp;lt;T&amp;gt;&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(urls == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; || urls.size() == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; newUrlInvokerMap;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Set&amp;lt;String&amp;gt; keys = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; HashSet&amp;lt;String&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        String queryProtocols = &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.queryMap.get(Constants.PROTOCOL_KEY);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (URL providerUrl : urls) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        	&lt;span class=&quot;comment&quot;&gt;//&amp;#x5982;&amp;#x679C;reference&amp;#x7AEF;&amp;#x914D;&amp;#x7F6E;&amp;#x4E86;protocol&amp;#xFF0C;&amp;#x5219;&amp;#x53EA;&amp;#x9009;&amp;#x62E9;&amp;#x5339;&amp;#x914D;&amp;#x7684;protocol&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        	&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (queryProtocols != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; queryProtocols.length() &amp;gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        		&lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; accept = &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        		String[] acceptProtocols = queryProtocols.split(&lt;span class=&quot;string&quot;&gt;&amp;quot;,&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        		&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (String acceptProtocol : acceptProtocols) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        			&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (providerUrl.getProtocol().equals(acceptProtocol)) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        				accept = &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        				&lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        			}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        		}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        		&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!accept) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        			&lt;span class=&quot;keyword&quot;&gt;continue&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        		}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        	}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (Constants.EMPTY_PROTOCOL.equals(providerUrl.getProtocol())) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;continue&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (! ExtensionLoader.getExtensionLoader(Protocol.class).hasExtension(providerUrl.getProtocol())) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                logger.error(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; IllegalStateException(&lt;span class=&quot;string&quot;&gt;&amp;quot;Unsupported protocol &amp;quot;&lt;/span&gt; + providerUrl.getProtocol() + &lt;span class=&quot;string&quot;&gt;&amp;quot; in notified url: &amp;quot;&lt;/span&gt; + providerUrl + &lt;span class=&quot;string&quot;&gt;&amp;quot; from registry &amp;quot;&lt;/span&gt; + getUrl().getAddress() + &lt;span class=&quot;string&quot;&gt;&amp;quot; to consumer &amp;quot;&lt;/span&gt; + NetUtils.getLocalHost() &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        + &lt;span class=&quot;string&quot;&gt;&amp;quot;, supported protocol: &amp;quot;&lt;/span&gt;+ExtensionLoader.getExtensionLoader(Protocol.class).getSupportedExtensions()));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;continue&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            URL url = mergeUrl(providerUrl);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            String key = url.toFullString(); &lt;span class=&quot;comment&quot;&gt;// URL&amp;#x53C2;&amp;#x6570;&amp;#x662F;&amp;#x6392;&amp;#x5E8F;&amp;#x7684;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (keys.contains(key)) { &lt;span class=&quot;comment&quot;&gt;// &amp;#x91CD;&amp;#x590D;URL&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;continue&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            keys.add(key);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// &amp;#x7F13;&amp;#x5B58;key&amp;#x4E3A;&amp;#x6CA1;&amp;#x6709;&amp;#x5408;&amp;#x5E76;&amp;#x6D88;&amp;#x8D39;&amp;#x7AEF;&amp;#x53C2;&amp;#x6570;&amp;#x7684;URL&amp;#xFF0C;&amp;#x4E0D;&amp;#x7BA1;&amp;#x6D88;&amp;#x8D39;&amp;#x7AEF;&amp;#x5982;&amp;#x4F55;&amp;#x5408;&amp;#x5E76;&amp;#x53C2;&amp;#x6570;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x670D;&amp;#x52A1;&amp;#x7AEF;URL&amp;#x53D1;&amp;#x751F;&amp;#x53D8;&amp;#x5316;&amp;#xFF0C;&amp;#x5219;&amp;#x91CD;&amp;#x65B0;refer&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Map&amp;lt;String, Invoker&amp;lt;T&amp;gt;&amp;gt; localUrlInvokerMap = &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.urlInvokerMap; &lt;span class=&quot;comment&quot;&gt;// local reference&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Invoker&amp;lt;T&amp;gt; invoker = localUrlInvokerMap == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; ? &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; : localUrlInvokerMap.get(key);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (invoker == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) { &lt;span class=&quot;comment&quot;&gt;// &amp;#x7F13;&amp;#x5B58;&amp;#x4E2D;&amp;#x6CA1;&amp;#x6709;&amp;#xFF0C;&amp;#x91CD;&amp;#x65B0;refer&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                	&lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; enabled = &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                	&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (url.hasParameter(Constants.DISABLED_KEY)) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                		enabled = ! url.getParameter(Constants.DISABLED_KEY, &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                	} &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                		enabled = url.getParameter(Constants.ENABLED_KEY, &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                	}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                	&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (enabled) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                		invoker = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; InvokerDelegete&amp;lt;T&amp;gt;(protocol.refer(serviceType, url), url, providerUrl);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                	}&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                } &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Throwable t) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    logger.error(&lt;span class=&quot;string&quot;&gt;&amp;quot;Failed to refer invoker for interface:&amp;quot;&lt;/span&gt;+serviceType+&lt;span class=&quot;string&quot;&gt;&amp;quot;,url:(&amp;quot;&lt;/span&gt;+url+&lt;span class=&quot;string&quot;&gt;&amp;quot;)&amp;quot;&lt;/span&gt; + t.getMessage(), t);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (invoker != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) { &lt;span class=&quot;comment&quot;&gt;// &amp;#x5C06;&amp;#x65B0;&amp;#x7684;&amp;#x5F15;&amp;#x7528;&amp;#x653E;&amp;#x5165;&amp;#x7F13;&amp;#x5B58;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    newUrlInvokerMap.put(key, invoker);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                newUrlInvokerMap.put(key, invoker);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        keys.clear();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; newUrlInvokerMap;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x4F8B;&amp;#x4E2D;&amp;#x534F;&amp;#x8BAE;&amp;#x4E3A;dubbo&amp;#xFF0C;&amp;#x56E0;&amp;#x6B64;&amp;#x8C03;&amp;#x7528;DubboProtocol&amp;#x7684;refer&amp;#x65B9;&amp;#x6CD5;&amp;#xFF0C;&amp;#x521B;&amp;#x5EFA;DubboInoker&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &amp;lt;T&amp;gt; &lt;span class=&quot;function&quot;&gt;Invoker&amp;lt;T&amp;gt; &lt;span class=&quot;title&quot;&gt;refer&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Class&amp;lt;T&amp;gt; serviceType, URL url)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; RpcException &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// create rpc invoker.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        DubboInvoker&amp;lt;T&amp;gt; invoker = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DubboInvoker&amp;lt;T&amp;gt;(serviceType, url, getClients(url), invokers);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        invokers.add(invoker);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; invoker;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x83B7;&amp;#x53D6;&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; ExchangeClient[] getClients(URL url){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//&amp;#x662F;&amp;#x5426;&amp;#x5171;&amp;#x4EAB;&amp;#x8FDE;&amp;#x63A5;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; service_share_connect = &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; connections = url.getParameter(Constants.CONNECTIONS_KEY, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//&amp;#x5982;&amp;#x679C;connections&amp;#x4E0D;&amp;#x914D;&amp;#x7F6E;&amp;#xFF0C;&amp;#x5219;&amp;#x5171;&amp;#x4EAB;&amp;#x8FDE;&amp;#x63A5;&amp;#xFF0C;&amp;#x5426;&amp;#x5219;&amp;#x6BCF;&amp;#x670D;&amp;#x52A1;&amp;#x6BCF;&amp;#x8FDE;&amp;#x63A5;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (connections == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            service_share_connect = &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            connections = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ExchangeClient[] clients = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ExchangeClient[connections];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; clients.length; i++) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (service_share_connect){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                clients[i] = getSharedClient(url);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            } &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                clients[i] = initClient(url);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; clients;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x6839;&amp;#x636E;URL&amp;#x521B;&amp;#x5EFA;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;ExchangeClient&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * &amp;#x521B;&amp;#x5EFA;&amp;#x65B0;&amp;#x8FDE;&amp;#x63A5;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; ExchangeClient &lt;span class=&quot;title&quot;&gt;initClient&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(URL url)&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// client type setting.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        String str = url.getParameter(Constants.CLIENT_KEY, url.getParameter(Constants.SERVER_KEY, Constants.DEFAULT_REMOTING_CLIENT));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        String version = url.getParameter(Constants.DUBBO_VERSION_KEY);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; compatible = (version != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; version.startsWith(&lt;span class=&quot;string&quot;&gt;&amp;quot;1.0.&amp;quot;&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        url = url.addParameter(Constants.CODEC_KEY, Version.isCompatibleVersion() &amp;amp;&amp;amp; compatible ? COMPATIBLE_CODEC_NAME : DubboCodec.NAME);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//&amp;#x9ED8;&amp;#x8BA4;&amp;#x5F00;&amp;#x542F;heartbeat&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        url = url.addParameterIfAbsent(Constants.HEARTBEAT_KEY, String.valueOf(Constants.DEFAULT_HEARTBEAT));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// BIO&amp;#x5B58;&amp;#x5728;&amp;#x4E25;&amp;#x91CD;&amp;#x6027;&amp;#x80FD;&amp;#x95EE;&amp;#x9898;&amp;#xFF0C;&amp;#x6682;&amp;#x65F6;&amp;#x4E0D;&amp;#x5141;&amp;#x8BB8;&amp;#x4F7F;&amp;#x7528;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (str != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; str.length() &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &amp;amp;&amp;amp; ! ExtensionLoader.getExtensionLoader(Transporter.class).hasExtension(str)) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; RpcException(&lt;span class=&quot;string&quot;&gt;&amp;quot;Unsupported client type: &amp;quot;&lt;/span&gt; + str + &lt;span class=&quot;string&quot;&gt;&amp;quot;,&amp;quot;&lt;/span&gt; +&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;string&quot;&gt;&amp;quot; supported client type is &amp;quot;&lt;/span&gt; + StringUtils.join(ExtensionLoader.getExtensionLoader(Transporter.class).getSupportedExtensions(), &lt;span class=&quot;string&quot;&gt;&amp;quot; &amp;quot;&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ExchangeClient client ;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;//&amp;#x8BBE;&amp;#x7F6E;&amp;#x8FDE;&amp;#x63A5;&amp;#x5E94;&amp;#x8BE5;&amp;#x662F;lazy&amp;#x7684; &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (url.getParameter(Constants.LAZY_CONNECT_KEY, &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;)){&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                client = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; LazyConnectExchangeClient(url ,requestHandler);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            } &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                client = Exchangers.connect(url ,requestHandler);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        } &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (RemotingException e) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; RpcException(&lt;span class=&quot;string&quot;&gt;&amp;quot;Fail to create remoting client for service(&amp;quot;&lt;/span&gt; + url&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    + &lt;span class=&quot;string&quot;&gt;&amp;quot;): &amp;quot;&lt;/span&gt; + e.getMessage(), e);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; client;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x6839;&amp;#x636E;URL&amp;#x4E2D;client&amp;#x53C2;&amp;#x6570;&amp;#x9009;&amp;#x62E9;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;Transport&amp;#xFF0C;&amp;#x9ED8;&amp;#x8BA4;&amp;#x662F;NettyTransporter&amp;#xFF0C;&amp;#x901A;&amp;#x8FC7;Transport&amp;#x521B;&amp;#x5EFA;&amp;#x5BF9;&amp;#x5E94;NettyClient&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;NettyTransporter&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Transporter&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; String NAME = &lt;span class=&quot;string&quot;&gt;&amp;quot;netty&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Server &lt;span class=&quot;title&quot;&gt;bind&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(URL url, ChannelHandler listener)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; RemotingException &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; NettyServer(url, listener);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Client &lt;span class=&quot;title&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(URL url, ChannelHandler listener)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; RemotingException &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; NettyClient(url, listener);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&amp;#x8C03;&amp;#x7528;&amp;#x8BF7;&amp;#x6C42;&amp;#x670D;&amp;#x52A1;&amp;#xFF0C;&amp;#x6267;&amp;#x884C;DubboInoker&amp;#x7684;doInvoke&amp;#x65B9;&amp;#x6CD5;&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; Result &lt;span class=&quot;title&quot;&gt;doInvoke&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Invocation invocation)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; Throwable &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        RpcInvocation inv = (RpcInvocation) invocation;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; String methodName = RpcUtils.getMethodName(invocation);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        inv.setAttachment(Constants.PATH_KEY, getUrl().getPath());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        inv.setAttachment(Constants.VERSION_KEY, version);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ExchangeClient currentClient;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (clients.length == &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            currentClient = clients[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        } &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            currentClient = clients[index.getAndIncrement() % clients.length];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; isAsync = RpcUtils.isAsync(getUrl(), invocation);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; isOneway = RpcUtils.isOneway(getUrl(), invocation);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; timeout = getUrl().getMethodParameter(methodName, Constants.TIMEOUT_KEY,Constants.DEFAULT_TIMEOUT);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (isOneway) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            	&lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; isSent = getUrl().getMethodParameter(methodName, Constants.SENT_KEY, &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                currentClient.send(inv, isSent);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                RpcContext.getContext().setFuture(&lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; RpcResult();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            } &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (isAsync) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            	ResponseFuture future = currentClient.request(inv, timeout) ;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                RpcContext.getContext().setFuture(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; FutureAdapter&amp;lt;Object&amp;gt;(future));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; RpcResult();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            } &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            	RpcContext.getContext().setFuture(&lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (Result) currentClient.request(inv, timeout).get();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        } &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (TimeoutException e) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; RpcException(RpcException.TIMEOUT_EXCEPTION, &lt;span class=&quot;string&quot;&gt;&amp;quot;Invoke remote method timeout. method: &amp;quot;&lt;/span&gt; + invocation.getMethodName() + &lt;span class=&quot;string&quot;&gt;&amp;quot;, provider: &amp;quot;&lt;/span&gt; + getUrl() + &lt;span class=&quot;string&quot;&gt;&amp;quot;, cause: &amp;quot;&lt;/span&gt; + e.getMessage(), e);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        } &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (RemotingException e) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; RpcException(RpcException.NETWORK_EXCEPTION, &lt;span class=&quot;string&quot;&gt;&amp;quot;Failed to invoke remote method: &amp;quot;&lt;/span&gt; + invocation.getMethodName() + &lt;span class=&quot;string&quot;&gt;&amp;quot;, provider: &amp;quot;&lt;/span&gt; + getUrl() + &lt;span class=&quot;string&quot;&gt;&amp;quot;, cause: &amp;quot;&lt;/span&gt; + e.getMessage(), e);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h1 id=&quot;Dubbo&amp;#x4E3B;&amp;#x8981;&amp;#x6A21;&amp;#x5757;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;a href=&quot;#Dubbo&amp;#x4E3B;&amp;#x8981;&amp;#x6A21;&amp;#x5757;&amp;#x5206;&amp;#x6790;&quot; class=&quot;headerlink&quot; title=&quot;Dubbo&amp;#x4E3B;&amp;#x8981;&amp;#x6A21;&amp;#x5757;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;/a&gt;Dubbo&amp;#x4E3B;&amp;#x8981;&amp;#x6A21;&amp;#x5757;&amp;#x5206;&amp;#x6790;&lt;/h1&gt;&lt;h2 id=&quot;Dubbo&amp;#x6269;&amp;#x5C55;&amp;#x6A21;&amp;#x5757;&quot;&gt;&lt;a href=&quot;#Dubbo&amp;#x6269;&amp;#x5C55;&amp;#x6A21;&amp;#x5757;&quot; class=&quot;headerlink&quot; title=&quot;Dubbo&amp;#x6269;&amp;#x5C55;&amp;#x6A21;&amp;#x5757;&quot;&gt;&lt;/a&gt;Dubbo&amp;#x6269;&amp;#x5C55;&amp;#x6A21;&amp;#x5757;&lt;/h2&gt;&lt;h2 id=&quot;Dubbo&amp;#x5F88;&amp;#x591A;&amp;#x6A21;&amp;#x5757;&amp;#x63D0;&amp;#x4F9B;&amp;#x4E86;&amp;#x591A;&amp;#x79CD;&amp;#x5B9E;&amp;#x73B0;&amp;#xFF0C;&amp;#x5728;Dubbo&amp;#x914D;&amp;#x7F6E;&amp;#x6587;&amp;#x4EF6;&amp;#x914D;&amp;#x7F6E;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x5C5E;&amp;#x6027;&amp;#x9009;&amp;#x62E9;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x7C7B;&amp;#xFF0C;&amp;#x5728;&amp;#x53D1;&amp;#x5E03;&amp;#x670D;&amp;#x52A1;&amp;#x65F6;Dubbo&amp;#x4F1A;&amp;#x6839;&amp;#x636E;&amp;#x914D;&amp;#x7F6E;&amp;#x7684;&amp;#x503C;&amp;#x5728;URL&amp;#x4E2D;&amp;#x6DFB;&amp;#x52A0;&amp;#x76F8;&amp;#x5E94;&amp;#x7684;&amp;#x53C2;&amp;#x6570;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5404;&amp;#x4E2A;&amp;#x6A21;&amp;#x5757;&amp;#x7684;Adaptive&amp;#x4F1A;&amp;#x6839;&amp;#x636E;URL&amp;#x4E2D;&amp;#x7684;&amp;#x53C2;&amp;#x6570;&amp;#x503C;&amp;#x9009;&amp;#x62E9;&amp;#x76F8;&amp;#x5E94;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x7C7B;&amp;#xFF08;&amp;#x5982;&amp;#x679C;&amp;#x6A21;&amp;#x5757;&amp;#x5B9E;&amp;#x73B0;&amp;#x7C7B;&amp;#x6CA1;&amp;#x6709;Adaptive&amp;#x6CE8;&amp;#x89E3;&amp;#xFF0C;Dubbo&amp;#x4F1A;&amp;#x52A8;&amp;#x6001;&amp;#x7684;&amp;#x521B;&amp;#x5EFA;&amp;#x8BE5;&amp;#x6A21;&amp;#x5757;&amp;#x7684;Adaptive&amp;#x5B9E;&amp;#x73B0;&amp;#x7C7B;&amp;#xFF09;&amp;#x3002;&quot;&gt;&lt;a href=&quot;#Dubbo&amp;#x5F88;&amp;#x591A;&amp;#x6A21;&amp;#x5757;&amp;#x63D0;&amp;#x4F9B;&amp;#x4E86;&amp;#x591A;&amp;#x79CD;&amp;#x5B9E;&amp;#x73B0;&amp;#xFF0C;&amp;#x5728;Dubbo&amp;#x914D;&amp;#x7F6E;&amp;#x6587;&amp;#x4EF6;&amp;#x914D;&amp;#x7F6E;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x5C5E;&amp;#x6027;&amp;#x9009;&amp;#x62E9;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x7C7B;&amp;#xFF0C;&amp;#x5728;&amp;#x53D1;&amp;#x5E03;&amp;#x670D;&amp;#x52A1;&amp;#x65F6;Dubbo&amp;#x4F1A;&amp;#x6839;&amp;#x636E;&amp;#x914D;&amp;#x7F6E;&amp;#x7684;&amp;#x503C;&amp;#x5728;URL&amp;#x4E2D;&amp;#x6DFB;&amp;#x52A0;&amp;#x76F8;&amp;#x5E94;&amp;#x7684;&amp;#x53C2;&amp;#x6570;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5404;&amp;#x4E2A;&amp;#x6A21;&amp;#x5757;&amp;#x7684;Adaptive&amp;#x4F1A;&amp;#x6839;&amp;#x636E;URL&amp;#x4E2D;&amp;#x7684;&amp;#x53C2;&amp;#x6570;&amp;#x503C;&amp;#x9009;&amp;#x62E9;&amp;#x76F8;&amp;#x5E94;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x7C7B;&amp;#xFF08;&amp;#x5982;&amp;#x679C;&amp;#x6A21;&amp;#x5757;&amp;#x5B9E;&amp;#x73B0;&amp;#x7C7B;&amp;#x6CA1;&amp;#x6709;Adaptive&amp;#x6CE8;&amp;#x89E3;&amp;#xFF0C;Dubbo&amp;#x4F1A;&amp;#x52A8;&amp;#x6001;&amp;#x7684;&amp;#x521B;&amp;#x5EFA;&amp;#x8BE5;&amp;#x6A21;&amp;#x5757;&amp;#x7684;Adaptive&amp;#x5B9E;&amp;#x73B0;&amp;#x7C7B;&amp;#xFF09;&amp;#x3002;&quot; class=&quot;headerlink&quot; title=&quot;Dubbo&amp;#x5F88;&amp;#x591A;&amp;#x6A21;&amp;#x5757;&amp;#x63D0;&amp;#x4F9B;&amp;#x4E86;&amp;#x591A;&amp;#x79CD;&amp;#x5B9E;&amp;#x73B0;&amp;#xFF0C;&amp;#x5728;Dubbo&amp;#x914D;&amp;#x7F6E;&amp;#x6587;&amp;#x4EF6;&amp;#x914D;&amp;#x7F6E;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x5C5E;&amp;#x6027;&amp;#x9009;&amp;#x62E9;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x7C7B;&amp;#xFF0C;&amp;#x5728;&amp;#x53D1;&amp;#x5E03;&amp;#x670D;&amp;#x52A1;&amp;#x65F6;Dubbo&amp;#x4F1A;&amp;#x6839;&amp;#x636E;&amp;#x914D;&amp;#x7F6E;&amp;#x7684;&amp;#x503C;&amp;#x5728;URL&amp;#x4E2D;&amp;#x6DFB;&amp;#x52A0;&amp;#x76F8;&amp;#x5E94;&amp;#x7684;&amp;#x53C2;&amp;#x6570;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5404;&amp;#x4E2A;&amp;#x6A21;&amp;#x5757;&amp;#x7684;Adaptive&amp;#x4F1A;&amp;#x6839;&amp;#x636E;URL&amp;#x4E2D;&amp;#x7684;&amp;#x53C2;&amp;#x6570;&amp;#x503C;&amp;#x9009;&amp;#x62E9;&amp;#x76F8;&amp;#x5E94;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x7C7B;&amp;#xFF08;&amp;#x5982;&amp;#x679C;&amp;#x6A21;&amp;#x5757;&amp;#x5B9E;&amp;#x73B0;&amp;#x7C7B;&amp;#x6CA1;&amp;#x6709;Adaptive&amp;#x6CE8;&amp;#x89E3;&amp;#xFF0C;Dubbo&amp;#x4F1A;&amp;#x52A8;&amp;#x6001;&amp;#x7684;&amp;#x521B;&amp;#x5EFA;&amp;#x8BE5;&amp;#x6A21;&amp;#x5757;&amp;#x7684;Adaptive&amp;#x5B9E;&amp;#x73B0;&amp;#x7C7B;&amp;#xFF09;&amp;#x3002;&quot;&gt;&lt;/a&gt;Dubbo&amp;#x5F88;&amp;#x591A;&amp;#x6A21;&amp;#x5757;&amp;#x63D0;&amp;#x4F9B;&amp;#x4E86;&amp;#x591A;&amp;#x79CD;&amp;#x5B9E;&amp;#x73B0;&amp;#xFF0C;&amp;#x5728;Dubbo&amp;#x914D;&amp;#x7F6E;&amp;#x6587;&amp;#x4EF6;&amp;#x914D;&amp;#x7F6E;&amp;#x5BF9;&amp;#x5E94;&amp;#x7684;&amp;#x5C5E;&amp;#x6027;&amp;#x9009;&amp;#x62E9;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x7C7B;&amp;#xFF0C;&amp;#x5728;&amp;#x53D1;&amp;#x5E03;&amp;#x670D;&amp;#x52A1;&amp;#x65F6;Dubbo&amp;#x4F1A;&amp;#x6839;&amp;#x636E;&amp;#x914D;&amp;#x7F6E;&amp;#x7684;&amp;#x503C;&amp;#x5728;URL&amp;#x4E2D;&amp;#x6DFB;&amp;#x52A0;&amp;#x76F8;&amp;#x5E94;&amp;#x7684;&amp;#x53C2;&amp;#x6570;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x5404;&amp;#x4E2A;&amp;#x6A21;&amp;#x5757;&amp;#x7684;Adaptive&amp;#x4F1A;&amp;#x6839;&amp;#x636E;URL&amp;#x4E2D;&amp;#x7684;&amp;#x53C2;&amp;#x6570;&amp;#x503C;&amp;#x9009;&amp;#x62E9;&amp;#x76F8;&amp;#x5E94;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x7C7B;&amp;#xFF08;&amp;#x5982;&amp;#x679C;&amp;#x6A21;&amp;#x5757;&amp;#x5B9E;&amp;#x73B0;&amp;#x7C7B;&amp;#x6CA1;&amp;#x6709;Adaptive&amp;#x6CE8;&amp;#x89E3;&amp;#xFF0C;Dubbo&amp;#x4F1A;&amp;#x52A8;&amp;#x6001;&amp;#x7684;&amp;#x521B;&amp;#x5EFA;&amp;#x8BE5;&amp;#x6A21;&amp;#x5757;&amp;#x7684;Adaptive&amp;#x5B9E;&amp;#x73B0;&amp;#x7C7B;&amp;#xFF09;&amp;#x3002;&lt;/h2&gt;&lt;h3 id=&quot;&amp;#x4E3B;&amp;#x8981;&amp;#x7C7B;&amp;#x56FE;&quot;&gt;&lt;a href=&quot;#&amp;#x4E3B;&amp;#x8981;&amp;#x7C7B;&amp;#x56FE;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x4E3B;&amp;#x8981;&amp;#x7C7B;&amp;#x56FE;&quot;&gt;&lt;/a&gt;&amp;#x4E3B;&amp;#x8981;&amp;#x7C7B;&amp;#x56FE;&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;/2016/04/27/dubbo-provider-start-process-analysis/extension_module_frame.png&quot; alt=&quot;extension_module_frame&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Active&amp;#x6CE8;&amp;#x89E3;&amp;#xFF0C;&amp;#x7C7B;&amp;#x6CE8;&amp;#x89E3;&amp;#xFF0C;&amp;#x5BF9;&amp;#x4E8E;&amp;#x53EF;&amp;#x4EE5;&amp;#x88AB;&amp;#x6846;&amp;#x67B6;&amp;#x4E2D;&amp;#x81EA;&amp;#x52A8;&amp;#x6FC0;&amp;#x6D3B;&amp;#x52A0;&amp;#x8F7D;&amp;#x6269;&amp;#x5C55;&amp;#xFF0C;&amp;#x6B64;Annotation&amp;#x7528;&amp;#x4E8E;&amp;#x914D;&amp;#x7F6E;&amp;#x6269;&amp;#x5C55;&amp;#x88AB;&amp;#x81EA;&amp;#x52A8;&amp;#x6FC0;&amp;#x6D3B;&amp;#x52A0;&amp;#x8F7D;&amp;#x6761;&amp;#x4EF6;&amp;#x3002;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;&amp;#x4E3B;&amp;#x8981;&amp;#x7C7B;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;a href=&quot;#&amp;#x4E3B;&amp;#x8981;&amp;#x7C7B;&amp;#x5206;&amp;#x6790;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x4E3B;&amp;#x8981;&amp;#x7C7B;&amp;#x5206;&amp;#x6790;&quot;&gt;&lt;/a&gt;&amp;#x4E3B;&amp;#x8981;&amp;#x7C7B;&amp;#x5206;&amp;#x6790;&lt;/h3&gt;&lt;h2 id=&quot;Registry&quot;&gt;&lt;a href=&quot;#Registry&quot; class=&quot;headerlink&quot; title=&quot;Registry&quot;&gt;&lt;/a&gt;Registry&lt;/h2&gt;&lt;h2 id=&quot;Dubbo&amp;#x670D;&amp;#x52A1;&amp;#x7AEF;&quot;&gt;&lt;a href=&quot;#Dubbo&amp;#x670D;&amp;#x52A1;&amp;#x7AEF;&quot; class=&quot;headerlink&quot; title=&quot;Dubbo&amp;#x670D;&amp;#x52A1;&amp;#x7AEF;&quot;&gt;&lt;/a&gt;Dubbo&amp;#x670D;&amp;#x52A1;&amp;#x7AEF;&lt;/h2&gt;&lt;h2 id=&quot;Dubbo&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&quot;&gt;&lt;a href=&quot;#Dubbo&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&quot; class=&quot;headerlink&quot; title=&quot;Dubbo&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&quot;&gt;&lt;/a&gt;Dubbo&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&lt;/h2&gt;&lt;h2 id=&quot;Dubbo-Filter&quot;&gt;&lt;a href=&quot;#Dubbo-Filter&quot; class=&quot;headerlink&quot; title=&quot;Dubbo Filter&quot;&gt;&lt;/a&gt;Dubbo Filter&lt;/h2&gt;&lt;h2 id=&quot;Dubbo-Transport&quot;&gt;&lt;a href=&quot;#Dubbo-Transport&quot; class=&quot;headerlink&quot; title=&quot;Dubbo Transport&quot;&gt;&lt;/a&gt;Dubbo Transport&lt;/h2&gt;</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Dubbo&amp;#x7B80;&amp;#x4ECB;&quot;&gt;&lt;a href=&quot;#Dubbo&amp;#x7B80;&amp;#x4ECB;&quot; class=&quot;headerlink&quot; title=&quot;Dubbo&amp;#x7B80;&amp;#x4ECB;&quot;&gt;&lt;/a&gt;Dubbo&amp;#x7B80;&amp;#x4ECB;&lt;/
    
    </summary>
    
      <category term="Java" scheme="https://qiufanghua.github.io/categories/Java/"/>
    
      <category term="Dubbo" scheme="https://qiufanghua.github.io/categories/Java/Dubbo/"/>
    
    
      <category term="Dubbo" scheme="https://qiufanghua.github.io/tags/Dubbo/"/>
    
  </entry>
  
  <entry>
    <title>mybatis and spring integrate analyze</title>
    <link href="https://qiufanghua.github.io/2016/04/27/mybatis-and-spring-integrate-analyze/"/>
    <id>https://qiufanghua.github.io/2016/04/27/mybatis-and-spring-integrate-analyze/</id>
    <published>2016-04-27T01:59:24.000Z</published>
    <updated>2016-04-27T04:19:12.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;Mybatis&amp;#x4E0E;Spring&amp;#x96C6;&amp;#x6210;&quot;&gt;&lt;a href=&quot;#Mybatis&amp;#x4E0E;Spring&amp;#x96C6;&amp;#x6210;&quot; class=&quot;headerlink&quot; title=&quot;Mybatis&amp;#x4E0E;Spring&amp;#x96C6;&amp;#x6210;&quot;&gt;&lt;/a&gt;Mybatis&amp;#x4E0E;Spring&amp;#x96C6;&amp;#x6210;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;Spring&amp;#x914D;&amp;#x7F6E;&amp;#x6587;&amp;#x4EF6;&amp;#x4E2D;&amp;#x914D;&amp;#x7F6E;SqlSessionFactoryBean&amp;#xFF0C;&amp;#x542F;&amp;#x52A8;Mybatis&amp;#x3002;&amp;#x5305;&amp;#x62EC;Mybatis&amp;#x53C2;&amp;#x6570;&amp;#x914D;&amp;#x7F6E;&amp;#x4EE5;&amp;#x53CA;Mybatis statement&amp;#x89E3;&amp;#x6790;&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2016/04/27/mybatis-and-spring-integrate-analyze/sqlsessionfactorybean.png&quot; alt=&quot;sqlsessionfactorybean&quot;&gt;&lt;/li&gt;
&lt;li&gt;&amp;#x914D;&amp;#x7F6E;MapperScannerConfigurer&amp;#xFF0C;&amp;#x914D;&amp;#x7F6E;&amp;#x7684;MapperScanConfigurer&amp;#x5728;Spring&amp;#x542F;&amp;#x52A8;&amp;#x65F6;&amp;#x8C03;&amp;#x7528;ClassPathMapperScanner&amp;#x626B;&amp;#x63CF;basePackage&amp;#x5305;&amp;#x4E0B;&amp;#x7684;&amp;#x63A5;&amp;#x53E3;Mapper&amp;#xFF0C;&amp;#x751F;&amp;#x6210;BeanDefinition&amp;#xFF0C;&amp;#x8BBE;&amp;#x7F6E;mapperInterface&amp;#x4E3A;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;Mapper&amp;#x63A5;&amp;#x53E3;&amp;#xFF0C;&amp;#x8BBE;&amp;#x7F6E;BeanClass&amp;#x4E3A;MapperFactoryBean&amp;#x3002;&lt;br&gt;&lt;img src=&quot;/2016/04/27/mybatis-and-spring-integrate-analyze/mapper_scan_configurer.png&quot; alt=&quot;mapper_scan_configurer&quot;&gt;&lt;/li&gt;
&lt;li&gt;Spring&amp;#x81EA;&amp;#x52A8;&amp;#x6CE8;&amp;#x5165;&amp;#x63A5;&amp;#x53E3;Mapper&amp;#x65F6;&amp;#x4F1A;&amp;#x8C03;&amp;#x7528;&amp;#x4E0A;&amp;#x4E00;&amp;#x6B65;&amp;#x521B;&amp;#x5EFA;MapperFactoryBean&amp;#x7684;getObject&amp;#x65B9;&amp;#x6CD5;&amp;#xFF0C;MapperFactoryBean&amp;#x521B;&amp;#x5EFA;MapperProxy&amp;#xFF0C;&amp;#x7531;&amp;#x6539;&amp;#x5BF9;&amp;#x8C61;&amp;#x4EE3;&amp;#x7406;&amp;#x6211;&amp;#x4EEC;&amp;#x63A5;&amp;#x53E3;&amp;#x65B9;&amp;#x6CD5;&amp;#x3002;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;Spring&amp;#x6CE8;&amp;#x5165;&amp;#x63A5;&amp;#x53E3;Mapper&amp;#x5BF9;&amp;#x8C61;&amp;#x8FC7;&amp;#x7A0B;&quot;&gt;&lt;a href=&quot;#Spring&amp;#x6CE8;&amp;#x5165;&amp;#x63A5;&amp;#x53E3;Mapper&amp;#x5BF9;&amp;#x8C61;&amp;#x8FC7;&amp;#x7A0B;&quot; class=&quot;headerlink&quot; title=&quot;Spring&amp;#x6CE8;&amp;#x5165;&amp;#x63A5;&amp;#x53E3;Mapper&amp;#x5BF9;&amp;#x8C61;&amp;#x8FC7;&amp;#x7A0B;&quot;&gt;&lt;/a&gt;Spring&amp;#x6CE8;&amp;#x5165;&amp;#x63A5;&amp;#x53E3;Mapper&amp;#x5BF9;&amp;#x8C61;&amp;#x8FC7;&amp;#x7A0B;&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/2016/04/27/mybatis-and-spring-integrate-analyze/mapper_sequence.png&quot; alt=&quot;mapper_sequence&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MapperScannerConfigurer&amp;#xFF0C;Spring&amp;#x5BB9;&amp;#x5668;&amp;#x8C03;&amp;#x7528;&amp;#x8BE5;&amp;#x7C7B;postProcessBeanDefinitionRegistry&amp;#x65B9;&amp;#x6CD5;&amp;#xFF0C;&amp;#x521B;&amp;#x5EFA;ClassPathMapperScanner&amp;#x5B9E;&amp;#x4F8B;&amp;#xFF0C;&amp;#x6839;&amp;#x636E;&amp;#x914D;&amp;#x7F6E;&amp;#x8BBE;&amp;#x7F6E;&amp;#x8BE5;&amp;#x5B9E;&amp;#x4F8B;&amp;#xFF0C;&amp;#x8C03;&amp;#x7528;ClassPathMapperScanner scan&amp;#x65B9;&amp;#x6CD5;&lt;/li&gt;
&lt;li&gt;ClassPathMapperScanner&amp;#x626B;&amp;#x63CF;basePackage&amp;#x5305;&amp;#x4E0B;&amp;#x7684;&amp;#x63A5;&amp;#x53E3;&amp;#xFF0C;&amp;#x751F;&amp;#x6210;BeanDefinition&amp;#xFF0C;&amp;#x8BBE;&amp;#x7F6E;BeanClass&amp;#x4E3A;MapperFactoryBean&amp;#xFF0C;&amp;#x5E76;&amp;#x81EA;&amp;#x52A8;&amp;#x6CE8;&amp;#x5165;SqlSessionFactory&amp;#x5B9E;&amp;#x4F8B;&amp;#xFF0C;&amp;#x5728;&amp;#x6CE8;&amp;#x5165;SqlSessionFactory&amp;#x5B9E;&amp;#x4F8B;&amp;#x65F6;&amp;#x521B;&amp;#x5EFA;SqlSessionTemplate&amp;#x5B9E;&amp;#x4F8B;&amp;#x3002;&lt;/li&gt;
&lt;li&gt;Spring&amp;#x6CE8;&amp;#x5165;&amp;#x63A5;&amp;#x53E3;Mapper&amp;#x65F6;&amp;#xFF0C;&amp;#x5219;&amp;#x8C03;&amp;#x7528;&amp;#x4E0A;&amp;#x4E00;&amp;#x6B65;&amp;#x521B;&amp;#x5EFA;MapperFactoryBean&amp;#x7684;getObject&amp;#x65B9;&amp;#x6CD5;&amp;#x3002;&lt;/li&gt;
&lt;li&gt;&amp;#x8C03;&amp;#x7528;SqlSessionTemplate&amp;#x7684;getMapper&amp;#x65B9;&amp;#x6CD5;&amp;#x3002;&lt;/li&gt;
&lt;li&gt;&amp;#x8C03;&amp;#x7528;Mybatis&amp;#x7684;MapperRegistry&amp;#x7684;getMapper&amp;#x65B9;&amp;#x6CD5;&amp;#x3002;&lt;/li&gt;
&lt;li&gt;&amp;#x521B;&amp;#x5EFA;MapperProxy&amp;#x4EE3;&amp;#x7406;&amp;#x7C7B;&amp;#x5B9E;&amp;#x4F8B;&amp;#xFF0C;&amp;#x8FD4;&amp;#x56DE;&amp;#x8BE5;&amp;#x5B9E;&amp;#x4F8B;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;&amp;#x63A5;&amp;#x53E3;Mapper&amp;#x67E5;&amp;#x8BE2;&amp;#x65B9;&amp;#x6CD5;&amp;#x6267;&amp;#x884C;&amp;#x8FC7;&amp;#x7A0B;&quot;&gt;&lt;a href=&quot;#&amp;#x63A5;&amp;#x53E3;Mapper&amp;#x67E5;&amp;#x8BE2;&amp;#x65B9;&amp;#x6CD5;&amp;#x6267;&amp;#x884C;&amp;#x8FC7;&amp;#x7A0B;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x63A5;&amp;#x53E3;Mapper&amp;#x67E5;&amp;#x8BE2;&amp;#x65B9;&amp;#x6CD5;&amp;#x6267;&amp;#x884C;&amp;#x8FC7;&amp;#x7A0B;&quot;&gt;&lt;/a&gt;&amp;#x63A5;&amp;#x53E3;Mapper&amp;#x67E5;&amp;#x8BE2;&amp;#x65B9;&amp;#x6CD5;&amp;#x6267;&amp;#x884C;&amp;#x8FC7;&amp;#x7A0B;&lt;/h1&gt;&lt;p&gt;&amp;#x6211;&amp;#x4EEC;&amp;#x4EE5;selectByExample&amp;#x4E3A;&amp;#x4F8B;&lt;br&gt;&lt;img src=&quot;/2016/04/27/mybatis-and-spring-integrate-analyze/mapper_selectByExample.png&quot; alt=&quot;mapper_selectByExample&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&amp;#x8C03;&amp;#x7528;&amp;#x6211;&amp;#x4EEC;Mapper&amp;#x63A5;&amp;#x53E3;select&amp;#x65B9;&amp;#x6CD5;&amp;#xFF08;&amp;#x65B9;&amp;#x6CD5;&amp;#x540D;&amp;#x5BF9;&amp;#x5E94;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;SQL Mapper&amp;#x914D;&amp;#x7F6E;&amp;#x6587;&amp;#x4EF6;&amp;#x7684;id&amp;#xFF09;&lt;/li&gt;
&lt;li&gt;MapperProxy&amp;#x5BF9;&amp;#x8C61;&amp;#x4EE3;&amp;#x7406;&amp;#x6211;&amp;#x4EEC;&amp;#x7684;&amp;#x65B9;&amp;#x6CD5;&amp;#xFF0C;&amp;#x521B;&amp;#x5EFA;MapperMethod&lt;/li&gt;
&lt;li&gt;MapperMethod&amp;#x4E2D;&amp;#x751F;&amp;#x6210;SqlCommand&amp;#x4FDD;&amp;#x5B58;SQL&amp;#x547D;&amp;#x4EE4;&amp;#x7C7B;&amp;#x578B;&amp;#x4E0E;MappedStatement&amp;#x7C7B;&amp;#x578B;&amp;#xFF0C;MethodSignature&amp;#x4FDD;&amp;#x5B58;&amp;#x65B9;&amp;#x6CD5;&amp;#x7B7E;&amp;#x540D;&amp;#x4FE1;&amp;#x606F;&amp;#x3002;&lt;/li&gt;
&lt;li&gt;&amp;#x8C03;&amp;#x7528;SqlSessionTemplate&amp;#x6267;&amp;#x884C;selectList&amp;#x65B9;&amp;#x6CD5;&amp;#xFF0C;&amp;#x6539;&amp;#x65B9;&amp;#x6CD5;&amp;#x4F1A;&amp;#x5148;&amp;#x6839;&amp;#x636E;&amp;#x662F;&amp;#x5426;&amp;#x914D;&amp;#x7F6E;&amp;#x6709;&amp;#x4E8B;&amp;#x52A1;&amp;#x83B7;&amp;#x53D6;&amp;#x6216;&amp;#x521B;&amp;#x5EFA;Mybatis SQLSession&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;DefaultSqlSession selectList&lt;br&gt;&lt;img src=&quot;/2016/04/27/mybatis-and-spring-integrate-analyze/defaultSqlSession_selectList.png&quot; alt=&quot;defaultSqlSession_selectList&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&amp;#x6839;&amp;#x636E;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;&amp;#x6267;&amp;#x884C;&amp;#x7C7B;&amp;#x578B;&amp;#x521B;&amp;#x5EFA;&amp;#x6267;&amp;#x884C;&amp;#x5668;&amp;#xFF0C;eg&amp;#xFF1A;Batch&amp;#x3001;Simple&amp;#x4EE5;&amp;#x53CA;Reuse&amp;#x6267;&amp;#x884C;&amp;#x5668;&lt;/li&gt;
&lt;li&gt;&amp;#x521B;&amp;#x5EFA;RoutingStatementHander&amp;#x8BED;&amp;#x53E5;&amp;#x5904;&amp;#x7406;&amp;#x5668;&lt;/li&gt;
&lt;li&gt;&amp;#x521B;&amp;#x5EFA;DefaultParameterHandler&amp;#x8BBE;&amp;#x7F6E;&amp;#x6267;&amp;#x884C;&amp;#x7684;sql&amp;#x53C2;&amp;#x6570;&lt;/li&gt;
&lt;li&gt;&amp;#x521B;&amp;#x5EFA;DefaultResultSetHandler&amp;#x5904;&amp;#x7406;JDBC&amp;#x67E5;&amp;#x8BE2;&amp;#x7684;&amp;#x7ED3;&amp;#x679C;&amp;#x96C6;&lt;/li&gt;
&lt;/ul&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Mybatis&amp;#x4E0E;Spring&amp;#x96C6;&amp;#x6210;&quot;&gt;&lt;a href=&quot;#Mybatis&amp;#x4E0E;Spring&amp;#x96C6;&amp;#x6210;&quot; class=&quot;headerlink&quot; title=&quot;Mybatis&amp;#x4E0E;Spr
    
    </summary>
    
      <category term="Java" scheme="https://qiufanghua.github.io/categories/Java/"/>
    
      <category term="Mybatis" scheme="https://qiufanghua.github.io/categories/Java/Mybatis/"/>
    
    
      <category term="Mybatis" scheme="https://qiufanghua.github.io/tags/Mybatis/"/>
    
      <category term="Spring" scheme="https://qiufanghua.github.io/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>Netty Resource Leak Detector</title>
    <link href="https://qiufanghua.github.io/2016/04/27/Netty-Resource-Leak-Detector/"/>
    <id>https://qiufanghua.github.io/2016/04/27/Netty-Resource-Leak-Detector/</id>
    <published>2016-04-26T22:54:37.000Z</published>
    <updated>2016-04-26T23:24:30.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;Netty-Resources&amp;#x6CC4;&amp;#x6F0F;&amp;#x68C0;&amp;#x6D4B;&quot;&gt;&lt;a href=&quot;#Netty-Resources&amp;#x6CC4;&amp;#x6F0F;&amp;#x68C0;&amp;#x6D4B;&quot; class=&quot;headerlink&quot; title=&quot;Netty Resources&amp;#x6CC4;&amp;#x6F0F;&amp;#x68C0;&amp;#x6D4B;&quot;&gt;&lt;/a&gt;Netty Resources&amp;#x6CC4;&amp;#x6F0F;&amp;#x68C0;&amp;#x6D4B;&lt;/h1&gt;&lt;p&gt;&amp;#x65E9;&amp;#x524D;&amp;#x6709;&amp;#x770B;&amp;#x5230;&amp;#x6587;&amp;#x7AE0;&amp;#x4ECB;&amp;#x7ECD;Java PhantomReferences(&amp;#x865A;&amp;#x5F15;&amp;#x7528;)&amp;#x53EF;&amp;#x4EE5;&amp;#x7528;&amp;#x6765;&amp;#x68C0;&amp;#x6D4B;&amp;#x8D44;&amp;#x6E90;&amp;#x662F;&amp;#x5426;&amp;#x6CC4;&amp;#x6F0F;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x4E00;&amp;#x76F4;&amp;#x6CA1;&amp;#x6709;&amp;#x627E;&amp;#x5230;&amp;#x5B9E;&amp;#x9645;&amp;#x7684;&amp;#x4F8B;&amp;#x5B50;&amp;#xFF0C;&amp;#x6700;&amp;#x8FD1;&amp;#x770B;&amp;#x5230;Netty&amp;#x6E90;&amp;#x7801;&amp;#x65F6;&amp;#x53D1;&amp;#x73B0;&amp;#x6709;&amp;#x7528;&amp;#x5230;&amp;#x4ED6;&amp;#x68C0;&amp;#x6D4B;&amp;#x8D44;&amp;#x6E90;&amp;#x662F;&amp;#x5426;&amp;#x6CC4;&amp;#x6F0F;&amp;#xFF0C;&amp;#x521A;&amp;#x597D;&amp;#x6700;&amp;#x8FD1;&amp;#x4E5F;&amp;#x5728;&amp;#x5F3A;&amp;#x8FEB;&amp;#x81EA;&amp;#x5DF1;&amp;#x5199;&amp;#x535A;&amp;#x5BA2;&amp;#xFF0C;&amp;#x5E0C;&amp;#x671B;&amp;#x8FD9;&amp;#x53EA;&amp;#x662F;&amp;#x4E2A;&amp;#x5F00;&amp;#x59CB;&amp;#x3002;&amp;#x4E0B;&amp;#x9762;&amp;#x6211;&amp;#x6309;&amp;#x4E09;&amp;#x4E2A;&amp;#x65B9;&amp;#x9762;&amp;#x6765;&amp;#x8FDB;&amp;#x884C;&amp;#x9610;&amp;#x8FF0;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;&amp;#x603B;&amp;#x4F53;&amp;#x63CF;&amp;#x53D9;&quot;&gt;&lt;a href=&quot;#&amp;#x603B;&amp;#x4F53;&amp;#x63CF;&amp;#x53D9;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x603B;&amp;#x4F53;&amp;#x63CF;&amp;#x53D9;&quot;&gt;&lt;/a&gt;&amp;#x603B;&amp;#x4F53;&amp;#x63CF;&amp;#x53D9;&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/2016/04/27/Netty-Resource-Leak-Detector/resource_leak_class_diagram.png&quot; alt=&quot;resources leak detector&quot;&gt;&lt;/p&gt;
&lt;p&gt;Netty DefaultResourceLeak&amp;#x901A;&amp;#x8FC7;&amp;#x7EE7;&amp;#x627F;Java PhantomReference&amp;#x63D0;&amp;#x4F9B;&amp;#x989D;&amp;#x5916;&amp;#x63A5;&amp;#x53E3;record()&amp;#x8BB0;&amp;#x5F55;&amp;#x8BBF;&amp;#x95EE;&amp;#x8D44;&amp;#x6E90;&amp;#x7684;&amp;#x5806;&amp;#x6808;&amp;#x4FE1;&amp;#x606F;&amp;#x4EE5;&amp;#x53CA;&amp;#x63D0;&amp;#x4F9B;close()&amp;#x8BBE;&amp;#x7F6E;&amp;#x5F15;&amp;#x7528;&amp;#x7684;&amp;#x8D44;&amp;#x6E90;&amp;#x662F;&amp;#x5426;&amp;#x91CA;&amp;#x653E;&amp;#xFF0C;&amp;#x5728;&amp;#x8D44;&amp;#x6E90;&amp;#x6CA1;&amp;#x6709;&amp;#x5F3A;&amp;#x5F15;&amp;#x7528;&amp;#x65F6;&amp;#x8BE5;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x7531;&amp;#x5783;&amp;#x573E;&amp;#x6536;&amp;#x96C6;&amp;#x5668;&amp;#x51B3;&amp;#x5B9A;&amp;#x4F55;&amp;#x65F6;&amp;#x6DFB;&amp;#x52A0;&amp;#x8BE5;&amp;#x8D44;&amp;#x6E90;&amp;#x5F15;&amp;#x7528;&amp;#x5230;&amp;#x5F15;&amp;#x7528;&amp;#x961F;&amp;#x5217;&amp;#xFF0C;&amp;#x901A;&amp;#x8FC7;&amp;#x904D;&amp;#x5386;&amp;#x5F15;&amp;#x7528;&amp;#x961F;&amp;#x5217;&amp;#xFF0C;&amp;#x5224;&amp;#x65AD;&amp;#x5F15;&amp;#x7528;&amp;#x7684;&amp;#x8D44;&amp;#x6E90;&amp;#x662F;&amp;#x5426;&amp;#x5DF2;&amp;#x7ECF;&amp;#x91CA;&amp;#x653E;&amp;#x3002;&lt;/p&gt;
&lt;h3 id=&quot;ResourceLeak&quot;&gt;&lt;a href=&quot;#ResourceLeak&quot; class=&quot;headerlink&quot; title=&quot;ResourceLeak&quot;&gt;&lt;/a&gt;ResourceLeak&lt;/h3&gt;&lt;p&gt;&amp;#x63D0;&amp;#x4F9B;&amp;#x65B9;&amp;#x6CD5;record()&amp;#x8BB0;&amp;#x5F55;&amp;#x5F53;&amp;#x524D;&amp;#x65B9;&amp;#x6CD5;&amp;#x5806;&amp;#x6808;&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x5728;&amp;#x8BBF;&amp;#x95EE;&amp;#x8D44;&amp;#x6E90;&amp;#x524D;&amp;#x8C03;&amp;#x7528;&amp;#x6B64;&amp;#x65B9;&amp;#x6CD5;&amp;#x8BB0;&amp;#x5F55;&amp;#x5F53;&amp;#x524D;&amp;#x65B9;&amp;#x6CD5;&amp;#x8C03;&amp;#x7528;&amp;#x5806;&amp;#x6808;&amp;#x4FE1;&amp;#x606F;&amp;#xFF0C;&amp;#x901A;&amp;#x8FC7;&amp;#x5DE5;&amp;#x5382;&amp;#x65B9;&amp;#x6CD5;&amp;#x83B7;&amp;#x53D6;&amp;#x8D44;&amp;#x6E90;&amp;#x65F6;&amp;#xFF0C;&amp;#x83B7;&amp;#x53D6;&amp;#x5230;&amp;#x7684;&amp;#x662F;&amp;#x8BE5;&amp;#x8D44;&amp;#x6E90;&amp;#x7684;&amp;#x5305;&amp;#x88C5;&amp;#x5BF9;&amp;#x8C61;&amp;#xFF0C;&amp;#x5728;&amp;#x5305;&amp;#x88C5;&amp;#x5BF9;&amp;#x8C61;&amp;#x4E2D;&amp;#x6709;&amp;#x9009;&amp;#x62E9;&amp;#x7684;&amp;#x8C03;&amp;#x7528;ResourceLeak&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;record&amp;#x65B9;&amp;#x6CD5;&amp;#xFF1B;&amp;#x5728;&amp;#x8D44;&amp;#x6E90;&amp;#x91CA;&amp;#x653E;&amp;#x65F6;&amp;#x8C03;&amp;#x7528;close()&amp;#x65B9;&amp;#x6CD5;&amp;#xFF0C;&amp;#x505C;&amp;#x6B62;&amp;#x5BF9;&amp;#x8BE5;&amp;#x8D44;&amp;#x6E90;&amp;#x7684;&amp;#x76D1;&amp;#x63A7;&amp;#x3002;&lt;/p&gt;
&lt;h3 id=&quot;DefaultResourceLeak&quot;&gt;&lt;a href=&quot;#DefaultResourceLeak&quot; class=&quot;headerlink&quot; title=&quot;DefaultResourceLeak&quot;&gt;&lt;/a&gt;DefaultResourceLeak&lt;/h3&gt;&lt;p&gt;ResourceLeak&amp;#x7684;&amp;#x9ED8;&amp;#x8BA4;&amp;#x5B9E;&amp;#x73B0;&amp;#xFF0C;&amp;#x540C;&amp;#x65F6;&amp;#x4E5F;&amp;#x7EE7;&amp;#x627F;&amp;#x4E86;Java PhantomReference&amp;#x3002;&amp;#x8BE5;&amp;#x5BF9;&amp;#x8C61;&amp;#x5BF9;&amp;#x5E94;&amp;#x4E8E;&amp;#x53CC;&amp;#x5411;&amp;#x94FE;&amp;#x8868;&amp;#x7684;&amp;#x8282;&amp;#x70B9;&amp;#xFF0C;&amp;#x5305;&amp;#x542B;&amp;#x524D;&amp;#x3001;&amp;#x540E;&amp;#x8282;&amp;#x70B9;&amp;#x7684;&amp;#x5F15;&amp;#x7528;&amp;#xFF0C;&amp;#x68C0;&amp;#x6D4B;&amp;#x8D44;&amp;#x6E90;&amp;#x662F;&amp;#x5426;&amp;#x91CA;&amp;#x653E;&amp;#x6807;&amp;#x8BC6;freed&amp;#x4EE5;&amp;#x53CA;&amp;#x6700;&amp;#x8FD1;&amp;#x8BB0;&amp;#x5F55;&amp;#x7684;&amp;#x68C0;&amp;#x6D4B;&amp;#x8D44;&amp;#x6E90;&amp;#x7684;&amp;#x65B9;&amp;#x6CD5;&amp;#x8C03;&amp;#x7528;&amp;#x5806;&amp;#x6808;&amp;#x4FE1;&amp;#x606F;&amp;#x3002;&lt;/p&gt;
&lt;h3 id=&quot;ResourceLeakDetector&quot;&gt;&lt;a href=&quot;#ResourceLeakDetector&quot; class=&quot;headerlink&quot; title=&quot;ResourceLeakDetector&quot;&gt;&lt;/a&gt;ResourceLeakDetector&lt;/h3&gt;&lt;p&gt;&amp;#x8D44;&amp;#x6E90;&amp;#x6CC4;&amp;#x6F0F;&amp;#x68C0;&amp;#x6D4B;&amp;#xFF0C;&amp;#x7EF4;&amp;#x62A4;&amp;#x4E86;ResourceLeak&amp;#x7684;&amp;#x53CC;&amp;#x5411;&amp;#x94FE;&amp;#x8868;&amp;#xFF0C;&amp;#x901A;&amp;#x8FC7;&amp;#x8BE5;&amp;#x5BF9;&amp;#x8C61;open(T obj)&amp;#x65B9;&amp;#x6CD5;&amp;#x65B0;&amp;#x589E;DefaultResourceLeak&amp;#x5BF9;&amp;#x8C61;&amp;#x8DDF;&amp;#x8E2A;&amp;#x4F20;&amp;#x5165;&amp;#x7684;&amp;#x8D44;&amp;#x6E90;&amp;#xFF0C;&amp;#x540C;&amp;#x65F6;&amp;#x904D;&amp;#x5386;&amp;#x5F15;&amp;#x7528;&amp;#x961F;&amp;#x5217;ReferenceQueue&lt;object&gt; refQueue&amp;#x83B7;&amp;#x53D6;DefaultResourceLeak&amp;#x5BF9;&amp;#x8C61;&amp;#x68C0;&amp;#x6D4B;&amp;#x8D44;&amp;#x6E90;&amp;#x662F;&amp;#x5426;&amp;#x91CA;&amp;#x653E;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x6CA1;&amp;#x6709;&amp;#x91CA;&amp;#x653E;&amp;#x6253;&amp;#x5370;&amp;#x8D44;&amp;#x6E90;&amp;#x6CC4;&amp;#x6F0F;&amp;#x65E5;&amp;#x5FD7;&amp;#x5E76;&amp;#x7F6E;ConcurrentMap&lt;string, boolean=&quot;&quot;&gt; reportedLeaks&amp;#x6807;&amp;#x8BC6;&lt;/string,&gt;&lt;/object&gt;&lt;/p&gt;
&lt;h2 id=&quot;&amp;#x6D41;&amp;#x7A0B;&amp;#x63CF;&amp;#x53D9;&quot;&gt;&lt;a href=&quot;#&amp;#x6D41;&amp;#x7A0B;&amp;#x63CF;&amp;#x53D9;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x6D41;&amp;#x7A0B;&amp;#x63CF;&amp;#x53D9;&quot;&gt;&lt;/a&gt;&amp;#x6D41;&amp;#x7A0B;&amp;#x63CF;&amp;#x53D9;&lt;/h2&gt;&lt;h2 id=&quot;&amp;#x5B9E;&amp;#x73B0;&amp;#x7EC6;&amp;#x8282;&quot;&gt;&lt;a href=&quot;#&amp;#x5B9E;&amp;#x73B0;&amp;#x7EC6;&amp;#x8282;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x5B9E;&amp;#x73B0;&amp;#x7EC6;&amp;#x8282;&quot;&gt;&lt;/a&gt;&amp;#x5B9E;&amp;#x73B0;&amp;#x7EC6;&amp;#x8282;&lt;/h2&gt;&lt;h2 id=&quot;&amp;#x6613;&amp;#x5FFD;&amp;#x7565;&amp;#x70B9;&quot;&gt;&lt;a href=&quot;#&amp;#x6613;&amp;#x5FFD;&amp;#x7565;&amp;#x70B9;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x6613;&amp;#x5FFD;&amp;#x7565;&amp;#x70B9;&quot;&gt;&lt;/a&gt;&amp;#x6613;&amp;#x5FFD;&amp;#x7565;&amp;#x70B9;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&amp;#x5F53;&amp;#x5BF9;&amp;#x8C61;&amp;#x6CA1;&amp;#x6709;&amp;#x5F3A;&amp;#x5F15;&amp;#x7528;&amp;#x65F6;&amp;#xFF0C;&amp;#x8BE5;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x5F15;&amp;#x7528;&amp;#x5BF9;&amp;#x8C61;Reference&amp;#x4F1A;&amp;#x6DFB;&amp;#x52A0;&amp;#x5230;&amp;#x5F15;&amp;#x7528;&amp;#x961F;&amp;#x5217;&amp;#xFF0C;&amp;#x5F15;&amp;#x7528;&amp;#x5BF9;&amp;#x8C61;Reference&amp;#x7684;&amp;#x5177;&amp;#x4F53;&amp;#x7C7B;&amp;#x578B;&amp;#x662F;&amp;#x7531;&amp;#x521B;&amp;#x5EFA;&amp;#x8BE5;&amp;#x5BF9;&amp;#x8C61;&amp;#x7684;&amp;#x5F15;&amp;#x7528;&amp;#x65F6;&amp;#x51B3;&amp;#x5B9A;&amp;#x7684;eg : new DefaultResourceLeak(obj);&amp;#x904D;&amp;#x5386;&amp;#x5F15;&amp;#x7528;&amp;#x961F;&amp;#x5217;&amp;#x65F6;&amp;#x5219;&amp;#x8FD4;&amp;#x56DE;&amp;#x7684;&amp;#x7C7B;&amp;#x578B;&amp;#x662F;DefaultResourceLeak&amp;#x5BF9;&amp;#x8C61;&lt;/li&gt;
&lt;li&gt;DefaultResourceLeak(Object referent)&amp;#x6784;&amp;#x9020;&amp;#x65B9;&amp;#x6CD5;&amp;#x6709;&amp;#x5224;&amp;#x65AD;referent&amp;#x662F;&amp;#x5426;&amp;#x4E3A;&amp;#x7A7A;&amp;#xFF0C;&amp;#x4E3A;&amp;#x7A7A;&amp;#x5219;&amp;#x4E0D;&amp;#x4F1A;&amp;#x88AB;&amp;#x6DFB;&amp;#x52A0;&amp;#x5230;&amp;#x5F15;&amp;#x7528;&amp;#x961F;&amp;#x5217;&amp;#xFF1A;super(referent, referent != null? refQueue : null);&lt;/li&gt;
&lt;li&gt;&amp;#x4F55;&amp;#x65F6;&amp;#x6765;&amp;#x62A5;&amp;#x9053;&amp;#x8D44;&amp;#x6E90;&amp;#x662F;&amp;#x5426;&amp;#x6709;&amp;#x6CC4;&amp;#x6F0F;&amp;#x3002;&amp;#x8C03;&amp;#x7528;ResourceLeakDetector open(T obj)&amp;#x65B9;&amp;#x6CD5;&amp;#x65F6;&amp;#xFF0C;&amp;#x904D;&amp;#x5386;&amp;#x5F15;&amp;#x7528;&amp;#x961F;&amp;#x5217;&amp;#x3002;&lt;/li&gt;
&lt;li&gt;&amp;#x4F55;&amp;#x65F6;&amp;#x4ECE;&amp;#x5F15;&amp;#x7528;&amp;#x961F;&amp;#x5217;&amp;#x4E2D;&amp;#x5220;&amp;#x9664;&amp;#x5F15;&amp;#x7528;&amp;#x3002;&amp;#x8D44;&amp;#x6E90;&amp;#x91CA;&amp;#x653E;&amp;#x65F6;&amp;#x4F1A;&amp;#x8C03;&amp;#x7528;DefaultResourceLeak close()&amp;#x65B9;&amp;#x6CD5;&amp;#xFF0C;&amp;#x4F1A;&amp;#x4ECE;&amp;#x94FE;&amp;#x8868;&amp;#x4E2D;&amp;#x5220;&amp;#x9664;&amp;#x8BE5;&amp;#x8282;&amp;#x70B9;&amp;#x3002;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (freed.compareAndSet(&lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;)) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;synchronized&lt;/span&gt; (head) {&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            active --;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            prev.next = next;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            next.prev = prev;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            prev = &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            next = &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ol&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Netty-Resources&amp;#x6CC4;&amp;#x6F0F;&amp;#x68C0;&amp;#x6D4B;&quot;&gt;&lt;a href=&quot;#Netty-Resources&amp;#x6CC4;&amp;#x6F0F;&amp;#x68C0;&amp;#x6D4B;&quot; class=&quot;headerlink&quot; title
    
    </summary>
    
      <category term="Java" scheme="https://qiufanghua.github.io/categories/Java/"/>
    
      <category term="Netty" scheme="https://qiufanghua.github.io/categories/Java/Netty/"/>
    
    
      <category term="Netty" scheme="https://qiufanghua.github.io/tags/Netty/"/>
    
      <category term="Java Reference" scheme="https://qiufanghua.github.io/tags/Java-Reference/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="https://qiufanghua.github.io/2016/04/24/hello-world/"/>
    <id>https://qiufanghua.github.io/2016/04/24/hello-world/</id>
    <published>2016-04-24T02:29:32.000Z</published>
    <updated>2016-04-24T02:29:32.000Z</updated>
    
    <content type="html">&lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;documentation&lt;/a&gt; for more info. If you get any problems when using Hexo, you can find the answer in &lt;a href=&quot;https://hexo.io/docs/troubleshooting.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;troubleshooting&lt;/a&gt; or you can ask me on &lt;a href=&quot;https://github.com/hexojs/hexo/issues&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GitHub&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;Quick-Start&quot;&gt;&lt;a href=&quot;#Quick-Start&quot; class=&quot;headerlink&quot; title=&quot;Quick Start&quot;&gt;&lt;/a&gt;Quick Start&lt;/h2&gt;&lt;h3 id=&quot;Create-a-new-post&quot;&gt;&lt;a href=&quot;#Create-a-new-post&quot; class=&quot;headerlink&quot; title=&quot;Create a new post&quot;&gt;&lt;/a&gt;Create a new post&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ hexo new &lt;span class=&quot;string&quot;&gt;&amp;quot;My New Post&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;More info: &lt;a href=&quot;https://hexo.io/docs/writing.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Writing&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Run-server&quot;&gt;&lt;a href=&quot;#Run-server&quot; class=&quot;headerlink&quot; title=&quot;Run server&quot;&gt;&lt;/a&gt;Run server&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ hexo server&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;More info: &lt;a href=&quot;https://hexo.io/docs/server.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Server&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Generate-static-files&quot;&gt;&lt;a href=&quot;#Generate-static-files&quot; class=&quot;headerlink&quot; title=&quot;Generate static files&quot;&gt;&lt;/a&gt;Generate static files&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ hexo generate&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;More info: &lt;a href=&quot;https://hexo.io/docs/generating.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Generating&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Deploy-to-remote-sites&quot;&gt;&lt;a href=&quot;#Deploy-to-remote-sites&quot; class=&quot;headerlink&quot; title=&quot;Deploy to remote sites&quot;&gt;&lt;/a&gt;Deploy to remote sites&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ hexo deploy&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;More info: &lt;a href=&quot;https://hexo.io/docs/deployment.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Deployment&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.
    
    </summary>
    
    
  </entry>
  
</feed>
